import{a as yi}from"./chunk-QXBV4OOZ.js";import{a as Ft}from"./chunk-AAS3MA3C.js";import{b as Ni,c as qe,d as Er}from"./chunk-E36SNTQA.js";import{a as oe,b as Mt}from"./chunk-DZI5S33S.js";import{a as x}from"./chunk-D7WMKMTL.js";function G(t){return typeof t>"u"||t===void 0}function k(t){return typeof t=="string"}function Wr(t){return typeof t=="number"}function ot(t){return typeof t=="boolean"}function st(t){return t===null}function y(t){return typeof t=="function"}function T(t){return typeof t=="object"&&t!==null}function r(t){return Object.freeze(t)}function L(t){return Array.isArray(t)}function le(t){return t}var w=r({is(t){return t.kind==="AlterTableNode"},create(t){return r({kind:"AlterTableNode",table:t})},cloneWithTableProps(t,e){return r({...t,...e})},cloneWithColumnAlteration(t,e){return r({...t,columnAlterations:t.columnAlterations?[...t.columnAlterations,e]:[e]})}});var u=r({is(t){return t.kind==="IdentifierNode"},create(t){return r({kind:"IdentifierNode",name:t})}});var Z=r({is(t){return t.kind==="CreateIndexNode"},create(t){return r({kind:"CreateIndexNode",name:u.create(t)})},cloneWith(t,e){return r({...t,...e})},cloneWithColumns(t,e){return r({...t,columns:[...t.columns||[],...e]})}});var Qt=r({is(t){return t.kind==="CreateSchemaNode"},create(t,e){return r({kind:"CreateSchemaNode",schema:u.create(t),...e})},cloneWith(t,e){return r({...t,...e})}});var xi=["preserve rows","delete rows","drop"],F=r({is(t){return t.kind==="CreateTableNode"},create(t){return r({kind:"CreateTableNode",table:t,columns:r([])})},cloneWithColumn(t,e){return r({...t,columns:r([...t.columns,e])})},cloneWithConstraint(t,e){return r({...t,constraints:t.constraints?r([...t.constraints,e]):r([e])})},cloneWithFrontModifier(t,e){return r({...t,frontModifiers:t.frontModifiers?r([...t.frontModifiers,e]):r([e])})},cloneWithEndModifier(t,e){return r({...t,endModifiers:t.endModifiers?r([...t.endModifiers,e]):r([e])})},cloneWith(t,e){return r({...t,...e})}});var P=r({is(t){return t.kind==="SchemableIdentifierNode"},create(t){return r({kind:"SchemableIdentifierNode",identifier:u.create(t)})},createWithSchema(t,e){return r({kind:"SchemableIdentifierNode",schema:u.create(t),identifier:u.create(e)})}});var Re=r({is(t){return t.kind==="DropIndexNode"},create(t,e){return r({kind:"DropIndexNode",name:P.create(t),...e})},cloneWith(t,e){return r({...t,...e})}});var at=r({is(t){return t.kind==="DropSchemaNode"},create(t,e){return r({kind:"DropSchemaNode",schema:u.create(t),...e})},cloneWith(t,e){return r({...t,...e})}});var ut=r({is(t){return t.kind==="DropTableNode"},create(t,e){return r({kind:"DropTableNode",table:t,...e})},cloneWith(t,e){return r({...t,...e})}});var q=r({is(t){return t.kind==="AliasNode"},create(t,e){return r({kind:"AliasNode",node:t,alias:e})}});var J=r({is(t){return t.kind==="TableNode"},create(t){return r({kind:"TableNode",table:P.create(t)})},createWithSchema(t,e){return r({kind:"TableNode",table:P.createWithSchema(t,e)})}});function C(t){return T(t)&&y(t.toOperationNode)}function gi(t){return T(t)&&"expressionType"in t&&C(t)}function wi(t){return T(t)&&"expression"in t&&k(t.alias)&&C(t)}var X=r({is(t){return t.kind==="SelectModifierNode"},create(t){return r({kind:"SelectModifierNode",modifier:t})},createWithExpression(t){return r({kind:"SelectModifierNode",rawModifier:t})}});var _=r({is(t){return t.kind==="AndNode"},create(t,e){return r({kind:"AndNode",left:t,right:e})}});var H=r({is(t){return t.kind==="OrNode"},create(t,e){return r({kind:"OrNode",left:t,right:e})}});var $t=r({is(t){return t.kind==="OnNode"},create(t){return r({kind:"OnNode",on:t})},cloneWithOperation(t,e,i){return r({...t,on:e==="And"?_.create(t.on,i):H.create(t.on,i)})}});var fe=r({is(t){return t.kind==="JoinNode"},create(t,e){return r({kind:"JoinNode",joinType:t,table:e,on:void 0})},createWithOn(t,e,i){return r({kind:"JoinNode",joinType:t,table:e,on:$t.create(i)})},cloneWithOn(t,e){return r({...t,on:t.on?$t.cloneWithOperation(t.on,"And",e):$t.create(e)})}});var ve=r({is(t){return t.kind==="BinaryOperationNode"},create(t,e,i){return r({kind:"BinaryOperationNode",leftOperand:t,operator:e,rightOperand:i})}});var gn=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","&&","?","?&","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->","regexp"],wn=["+","-","*","/","%","^","&","|","#","<<",">>"],Oi=["->","->>"],On=[...gn,...wn,"&&","||"],bn=["exists","not exists"],Cn=["not","-",...bn],bi=[...On,...Oi,...Cn,"between","between symmetric"],Y=r({is(t){return t.kind==="OperatorNode"},create(t){return r({kind:"OperatorNode",operator:t})}});function Dr(t){return k(t)&&Oi.includes(t)}var m=r({is(t){return t.kind==="ColumnNode"},create(t){return r({kind:"ColumnNode",column:u.create(t)})}});var Le=r({is(t){return t.kind==="SelectAllNode"},create(){return r({kind:"SelectAllNode"})}});var Be=r({is(t){return t.kind==="ReferenceNode"},create(t,e){return r({kind:"ReferenceNode",table:e,column:t})},createSelectAll(t){return r({kind:"ReferenceNode",table:t,column:Le.create()})}});var Ut=class{#e;get dynamicReference(){return this.#e}get refType(){}constructor(e){this.#e=e}toOperationNode(){return Ar(this.#e)}};function Vt(t){return T(t)&&C(t)&&k(t.dynamicReference)}var zt=r({is(t){return t.kind==="OrderByItemNode"},create(t,e){return r({kind:"OrderByItemNode",orderBy:t,direction:e})}});var S=r({is(t){return t.kind==="RawNode"},create(t,e){return r({kind:"RawNode",sqlFragments:r(t),parameters:r(e)})},createWithSql(t){return S.create([t],[])},createWithChild(t){return S.create(["",""],[t])},createWithChildren(t){return S.create(new Array(t.length+1).fill(""),t)}});function Rr(t){return t==="asc"||t==="desc"}function Ne(t){if(t.length===2)return[qr(t[0],t[1])];if(t.length===1){let[e]=t;return Array.isArray(e)?e.map(i=>qr(i)):[qr(e)]}throw new Error(`Invalid number of arguments at order by! expected 1-2, received ${t.length}`)}function qr(t,e){let i=vn(t);if(zt.is(i)){if(e)throw new Error("Cannot specify direction twice!");return i}return zt.create(i,Ci(e))}function vn(t){if(se(t))return K(t);if(Vt(t))return t.toOperationNode();let[e,i]=t.split(" ");if(i){if(!Rr(i))throw new Error(`Invalid order by direction: ${i}`);return zt.create(Q(e),Ci(i))}return Q(t)}function Ci(t){if(t)return t==="asc"||t==="desc"?S.createWithSql(t):t.toOperationNode()}var dt=r({is(t){return t.kind==="JSONReferenceNode"},create(t,e){return r({kind:"JSONReferenceNode",reference:t,traversal:e})},cloneWithTraversal(t,e){return r({...t,traversal:e})}});var Jt=r({is(t){return t.kind==="JSONOperatorChainNode"},create(t){return r({kind:"JSONOperatorChainNode",operator:t,values:r([])})},cloneWithValue(t,e){return r({...t,values:r([...t.values,e])})}});var ct=r({is(t){return t.kind==="JSONPathNode"},create(t){return r({kind:"JSONPathNode",inOperator:t,pathLegs:r([])})},cloneWithLeg(t,e){return r({...t,pathLegs:r([...t.pathLegs,e])})}});function Ar(t){return k(t)?Q(t):t.toOperationNode()}function ae(t){return L(t)?t.map(e=>M(e)):[M(t)]}function M(t){return se(t)?K(t):Ar(t)}function vi(t,e){let i=Q(t);if(Dr(e))return dt.create(i,Jt.create(Y.create(e)));let n=e.slice(0,-1);if(Dr(n))return dt.create(i,ct.create(Y.create(n)));throw new Error(`Invalid JSON operator: ${e}`)}function Q(t){let e=".";if(!t.includes(e))return Be.create(m.create(t));let i=t.split(e).map(Pr);if(i.length===3)return Tn(i);if(i.length===2)return Sn(i);throw new Error(`invalid column reference ${t}`)}function Ti(t){let e=" as ";if(t.includes(e)){let[i,n]=t.split(e).map(Pr);return q.create(Q(i),u.create(n))}else return Q(t)}function Lr(t){return m.create(t)}function Br(t){let e=" ";if(t.includes(e)){let[i,n]=t.split(e).map(Pr);if(!Rr(n))throw new Error(`invalid order direction "${n}" next to "${i}"`);return Ne([i,n])[0]}else return Lr(t)}function Tn(t){let[e,i,n]=t;return Be.create(m.create(n),J.createWithSchema(e,i))}function Sn(t){let[e,i]=t;return Be.create(m.create(i),J.create(e))}function Pr(t){return t.trim()}var Kt=r({is(t){return t.kind==="PrimitiveValueListNode"},create(t){return r({kind:"PrimitiveValueListNode",values:r([...t])})}});var Pe=r({is(t){return t.kind==="ValueListNode"},create(t){return r({kind:"ValueListNode",values:r(t)})}});var E=r({is(t){return t.kind==="ValueNode"},create(t){return r({kind:"ValueNode",value:t})},createImmediate(t){return r({kind:"ValueNode",value:t,immediate:!0})}});function jt(t){return L(t)?kn(t):v(t)}function v(t){return se(t)?K(t):E.create(t)}function Gt(t){return Wr(t)||ot(t)||st(t)}function mt(t){if(!Gt(t))throw new Error(`unsafe immediate value ${JSON.stringify(t)}`);return E.createImmediate(t)}function kn(t){return t.some(se)?Pe.create(t.map(e=>v(e))):Kt.create(t)}var ue=r({is(t){return t.kind==="ParensNode"},create(t){return r({kind:"ParensNode",node:t})}});function g(t){if(t.length===3)return _e(t[0],t[1],t[2]);if(t.length===1)return v(t[0]);throw new Error(`invalid arguments: ${JSON.stringify(t)}`)}function _e(t,e,i){return In(e)&&ki(i)?ve.create(M(t),_r(e),E.createImmediate(i)):ve.create(M(t),_r(e),jt(i))}function R(t,e,i){return ve.create(M(t),_r(e),M(i))}function Mr(t,e){return Ht(Object.entries(t).filter(([,i])=>!G(i)).map(([i,n])=>_e(i,ki(n)?"is":"=",n)),e)}function Ht(t,e){let i=e==="and"?_.create:H.create;if(t.length===0)return E.createImmediate(e==="and");let n=Si(t[0]);for(let o=1;o<t.length;++o)n=i(n,Si(t[o]));return t.length>1?ue.create(n):n}function In(t){return t==="is"||t==="is not"}function ki(t){return st(t)||ot(t)}function _r(t){if(k(t)&&bi.includes(t))return Y.create(t);if(C(t))return t.toOperationNode();throw new Error(`invalid operator ${JSON.stringify(t)}`)}function Si(t){return C(t)?t.toOperationNode():t}var de=r({is(t){return t.kind==="OrderByNode"},create(t){return r({kind:"OrderByNode",items:r([...t])})},cloneWithItems(t,e){return r({...t,items:r([...t.items,...e])})}});var Fr=r({is(t){return t.kind==="PartitionByNode"},create(t){return r({kind:"PartitionByNode",items:r(t)})},cloneWithItems(t,e){return r({...t,items:r([...t.items,...e])})}});var pt=r({is(t){return t.kind==="OverNode"},create(){return r({kind:"OverNode"})},cloneWithOrderByItems(t,e){return r({...t,orderBy:t.orderBy?de.cloneWithItems(t.orderBy,e):de.create(e)})},cloneWithPartitionByItems(t,e){return r({...t,partitionBy:t.partitionBy?Fr.cloneWithItems(t.partitionBy,e):Fr.create(e)})}});var Te=r({is(t){return t.kind==="FromNode"},create(t){return r({kind:"FromNode",froms:r(t)})},cloneWithFroms(t,e){return r({...t,froms:r([...t.froms,...e])})}});var Qr=r({is(t){return t.kind==="GroupByNode"},create(t){return r({kind:"GroupByNode",items:r(t)})},cloneWithItems(t,e){return r({...t,items:r([...t.items,...e])})}});var $r=r({is(t){return t.kind==="HavingNode"},create(t){return r({kind:"HavingNode",having:t})},cloneWithOperation(t,e,i){return r({...t,having:e==="And"?_.create(t.having,i):H.create(t.having,i)})}});var d=r({is(t){return t.kind==="SelectQueryNode"},create(t){return r({kind:"SelectQueryNode",...t&&{with:t}})},createFrom(t,e){return r({kind:"SelectQueryNode",from:Te.create(t),...e&&{with:e}})},cloneWithSelections(t,e){return r({...t,selections:t.selections?r([...t.selections,...e]):r(e)})},cloneWithDistinctOn(t,e){return r({...t,distinctOn:t.distinctOn?r([...t.distinctOn,...e]):r(e)})},cloneWithFrontModifier(t,e){return r({...t,frontModifiers:t.frontModifiers?r([...t.frontModifiers,e]):r([e])})},cloneWithEndModifier(t,e){return r({...t,endModifiers:t.endModifiers?r([...t.endModifiers,e]):r([e])})},cloneWithOrderByItems(t,e){return r({...t,orderBy:t.orderBy?de.cloneWithItems(t.orderBy,e):de.create(e)})},cloneWithGroupByItems(t,e){return r({...t,groupBy:t.groupBy?Qr.cloneWithItems(t.groupBy,e):Qr.create(e)})},cloneWithLimit(t,e){return r({...t,limit:e})},cloneWithOffset(t,e){return r({...t,offset:e})},cloneWithHaving(t,e){return r({...t,having:t.having?$r.cloneWithOperation(t.having,"And",e):$r.create(e)})},cloneWithSetOperations(t,e){return r({...t,setOperations:t.setOperations?r([...t.setOperations,...e]):r([...e])})},cloneWithoutSelections(t){return r({...t,selections:[]})},cloneWithoutLimit(t){return r({...t,limit:void 0})},cloneWithoutOffset(t){return r({...t,offset:void 0})},cloneWithoutOrderBy(t){return r({...t,orderBy:void 0})}});function s(t,e){Object.defineProperties(t.prototype,{then:{enumerable:!1,value:()=>{throw new Error(e)}}})}var ht=class t{#e;constructor(e){this.#e=r(e)}on(...e){return new t({...this.#e,joinNode:fe.cloneWithOn(this.#e.joinNode,g(e))})}onRef(e,i,n){return new t({...this.#e,joinNode:fe.cloneWithOn(this.#e.joinNode,R(e,i,n))})}onTrue(){return new t({...this.#e,joinNode:fe.cloneWithOn(this.#e.joinNode,S.createWithSql("true"))})}$call(e){return e(this)}toOperationNode(){return this.#e.joinNode}};s(ht,"don't await JoinBuilder instances. They are never executed directly and are always just a part of a query.");var Ii=r({is(t){return t.kind==="PartitionByItemNode"},create(t){return r({kind:"PartitionByItemNode",partitionBy:t})}});function Ei(t){return ae(t).map(Ii.create)}var lt=class t{#e;constructor(e){this.#e=r(e)}orderBy(e,i){return new t({overNode:pt.cloneWithOrderByItems(this.#e.overNode,Ne([e,i]))})}partitionBy(e){return new t({overNode:pt.cloneWithPartitionByItems(this.#e.overNode,Ei(e))})}$call(e){return e(this)}toOperationNode(){return this.#e.overNode}};s(lt,"don't await OverBuilder instances. They are never executed directly and are always just a part of a query.");var Me=r({is(t){return t.kind==="SelectionNode"},create(t){return r({kind:"SelectionNode",selection:t})},createSelectAll(){return r({kind:"SelectionNode",selection:Le.create()})},createSelectAllFromTable(t){return r({kind:"SelectionNode",selection:Be.createSelectAll(t)})}});function $(t){return y(t)?$(t(U())):L(t)?t.map(e=>Wi(e)):[Wi(t)]}function Wi(t){return k(t)?Me.create(Ti(t)):Vt(t)?Me.create(t.toOperationNode()):Me.create(Yt(t))}function ee(t){return t?Array.isArray(t)?t.map(Di):[Di(t)]:[Me.createSelectAll()]}function Di(t){if(k(t))return Me.createSelectAllFromTable(b(t));throw new Error(`invalid value selectAll expression: ${JSON.stringify(t)}`)}var Ai=r({is(t){return t.kind==="ValuesNode"},create(t){return r({kind:"ValuesNode",values:r(t)})}});var qi=r({is(t){return t.kind==="DefaultInsertValueNode"},create(){return r({kind:"DefaultInsertValueNode"})}});function Ri(t){let e=y(t)?t(U()):t,i=L(e)?e:r([e]);return En(i)}function En(t){let e=Wn(t);return[r([...e.keys()].map(m.create)),Ai.create(t.map(i=>Dn(i,e)))]}function Wn(t){let e=new Map;for(let i of t){let n=Object.keys(i);for(let o of n)!e.has(o)&&i[o]!==void 0&&e.set(o,e.size)}return e}function Dn(t,e){let i=Object.keys(t),n=Array.from({length:e.size}),o=!1;for(let N of i){let I=e.get(N);if(G(I))continue;let W=t[N];(G(W)||se(W))&&(o=!0),n[I]=W}if(i.length<e.size||o){let N=qi.create();return Pe.create(n.map(I=>G(I)?N:v(I)))}return Kt.create(n)}var V=r({is(t){return t.kind==="InsertQueryNode"},create(t,e,i){return r({kind:"InsertQueryNode",into:t,...e&&{with:e},replace:i})},cloneWith(t,e){return r({...t,...e})}});var Se=r({is(t){return t.kind==="UpdateQueryNode"},create(t,e){return r({kind:"UpdateQueryNode",table:t,...e&&{with:e}})},cloneWithFromItems(t,e){return r({...t,from:t.from?Te.cloneWithFroms(t.from,e):Te.create(e)})},cloneWithUpdates(t,e){return r({...t,updates:t.updates?r([...t.updates,...e]):e})}});var Ur=r({is(t){return t.kind==="UsingNode"},create(t){return r({kind:"UsingNode",tables:r(t)})},cloneWithTables(t,e){return r({...t,tables:r([...t.tables,...e])})}});var ye=r({is(t){return t.kind==="DeleteQueryNode"},create(t,e){return r({kind:"DeleteQueryNode",from:Te.create(t),...e&&{with:e}})},cloneWithOrderByItems(t,e){return r({...t,orderBy:t.orderBy?de.cloneWithItems(t.orderBy,e):de.create(e)})},cloneWithLimit(t,e){return r({...t,limit:e})},cloneWithUsing(t,e){return r({...t,using:t.using!==void 0?Ur.cloneWithTables(t.using,e):Ur.create(e)})}});var D=r({is(t){return t.kind==="WhereNode"},create(t){return r({kind:"WhereNode",where:t})},cloneWithOperation(t,e,i){return r({...t,where:e==="And"?_.create(t.where,i):H.create(t.where,i)})}});var Vr=r({is(t){return t.kind==="ReturningNode"},create(t){return r({kind:"ReturningNode",selections:r(t)})},cloneWithSelections(t,e){return r({...t,selections:t.selections?r([...t.selections,...e]):r(e)})}});var Li=r({is(t){return t.kind==="ExplainNode"},create(t,e){return r({kind:"ExplainNode",format:t,options:e})}});var c=r({is(t){return d.is(t)||V.is(t)||Se.is(t)||ye.is(t)},cloneWithWhere(t,e){return r({...t,where:t.where?D.cloneWithOperation(t.where,"And",e):D.create(e)})},cloneWithJoin(t,e){return r({...t,joins:t.joins?r([...t.joins,e]):r([e])})},cloneWithReturning(t,e){return r({...t,returning:t.returning?Vr.cloneWithSelections(t.returning,e):Vr.create(e)})},cloneWithoutWhere(t){return r({...t,where:void 0})},cloneWithExplain(t,e,i){return r({...t,explain:Li.create(e,i?.toOperationNode())})}});var Bi=r({is(t){return t.kind==="ColumnUpdateNode"},create(t,e){return r({kind:"ColumnUpdateNode",column:t,value:e})}});function Fe(t){let e=y(t)?t(U()):t;return Object.entries(e).filter(([i,n])=>n!==void 0).map(([i,n])=>Bi.create(m.create(i),v(n)))}var Pi=r({is(t){return t.kind==="OnDuplicateKeyNode"},create(t){return r({kind:"OnDuplicateKeyNode",updates:t})}});var Zt=class{insertId;numInsertedOrUpdatedRows;constructor(e,i){this.insertId=e,this.numInsertedOrUpdatedRows=i}};var te=class extends Error{node;constructor(e){super("no result"),this.node=e}};function xe(t){return Object.prototype.hasOwnProperty.call(t,"prototype")}var B=r({is(t){return t.kind==="OnConflictNode"},create(){return r({kind:"OnConflictNode"})},cloneWith(t,e){return r({...t,...e})},cloneWithIndexWhere(t,e){return r({...t,indexWhere:t.indexWhere?D.cloneWithOperation(t.indexWhere,"And",e):D.create(e)})},cloneWithIndexOrWhere(t,e){return r({...t,indexWhere:t.indexWhere?D.cloneWithOperation(t.indexWhere,"Or",e):D.create(e)})},cloneWithUpdateWhere(t,e){return r({...t,updateWhere:t.updateWhere?D.cloneWithOperation(t.updateWhere,"And",e):D.create(e)})},cloneWithUpdateOrWhere(t,e){return r({...t,updateWhere:t.updateWhere?D.cloneWithOperation(t.updateWhere,"Or",e):D.create(e)})},cloneWithoutIndexWhere(t){return r({...t,indexWhere:void 0})},cloneWithoutUpdateWhere(t){return r({...t,updateWhere:void 0})}});var ft=class t{#e;constructor(e){this.#e=r(e)}column(e){let i=m.create(e);return new t({...this.#e,onConflictNode:B.cloneWith(this.#e.onConflictNode,{columns:this.#e.onConflictNode.columns?r([...this.#e.onConflictNode.columns,i]):r([i])})})}columns(e){let i=e.map(m.create);return new t({...this.#e,onConflictNode:B.cloneWith(this.#e.onConflictNode,{columns:this.#e.onConflictNode.columns?r([...this.#e.onConflictNode.columns,...i]):r(i)})})}constraint(e){return new t({...this.#e,onConflictNode:B.cloneWith(this.#e.onConflictNode,{constraint:u.create(e)})})}expression(e){return new t({...this.#e,onConflictNode:B.cloneWith(this.#e.onConflictNode,{indexExpression:e.toOperationNode()})})}where(...e){return new t({...this.#e,onConflictNode:B.cloneWithIndexWhere(this.#e.onConflictNode,g(e))})}whereRef(e,i,n){return new t({...this.#e,onConflictNode:B.cloneWithIndexWhere(this.#e.onConflictNode,R(e,i,n))})}clearWhere(){return new t({...this.#e,onConflictNode:B.cloneWithoutIndexWhere(this.#e.onConflictNode)})}doNothing(){return new Xt({...this.#e,onConflictNode:B.cloneWith(this.#e.onConflictNode,{doNothing:!0})})}doUpdateSet(e){return new er({...this.#e,onConflictNode:B.cloneWith(this.#e.onConflictNode,{updates:Fe(e)})})}$call(e){return e(this)}};s(ft,"don't await OnConflictBuilder instances.");var Xt=class{#e;constructor(e){this.#e=r(e)}toOperationNode(){return this.#e.onConflictNode}};s(Xt,"don't await OnConflictDoNothingBuilder instances.");var er=class t{#e;constructor(e){this.#e=r(e)}where(...e){return new t({...this.#e,onConflictNode:B.cloneWithUpdateWhere(this.#e.onConflictNode,g(e))})}whereRef(e,i,n){return new t({...this.#e,onConflictNode:B.cloneWithUpdateWhere(this.#e.onConflictNode,R(e,i,n))})}clearWhere(){return new t({...this.#e,onConflictNode:B.cloneWithoutUpdateWhere(this.#e.onConflictNode)})}$call(e){return e(this)}toOperationNode(){return this.#e.onConflictNode}};s(er,"don't await OnConflictUpdateBuilder instances.");var Qe=class t{#e;constructor(e){this.#e=r(e)}values(e){let[i,n]=Ri(e);return new t({...this.#e,queryNode:V.cloneWith(this.#e.queryNode,{columns:i,values:n})})}columns(e){return new t({...this.#e,queryNode:V.cloneWith(this.#e.queryNode,{columns:r(e.map(m.create))})})}expression(e){return new t({...this.#e,queryNode:V.cloneWith(this.#e.queryNode,{values:K(e)})})}ignore(){return new t({...this.#e,queryNode:V.cloneWith(this.#e.queryNode,{ignore:!0})})}onConflict(e){return new t({...this.#e,queryNode:V.cloneWith(this.#e.queryNode,{onConflict:e(new ft({onConflictNode:B.create()})).toOperationNode()})})}onDuplicateKeyUpdate(e){return new t({...this.#e,queryNode:V.cloneWith(this.#e.queryNode,{onDuplicateKey:Pi.create(Fe(e))})})}returning(e){return new t({...this.#e,queryNode:c.cloneWithReturning(this.#e.queryNode,$(e))})}returningAll(){return new t({...this.#e,queryNode:c.cloneWithReturning(this.#e.queryNode,ee())})}$call(e){return e(this)}$if(e,i){return e?i(this):new t({...this.#e})}$castTo(){return new t(this.#e)}$narrowType(){return new t(this.#e)}$assertType(){return new t(this.#e)}withPlugin(e){return new t({...this.#e,executor:this.#e.executor.withPlugin(e)})}toOperationNode(){return this.#e.executor.transformQuery(this.#e.queryNode,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){let e=this.compile(),i=e.query,n=await this.#e.executor.executeQuery(e,this.#e.queryId);return this.#e.executor.adapter.supportsReturning&&i.returning?n.rows:[new Zt(n.insertId,n.numAffectedRows??n.numUpdatedOrDeletedRows)]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=te){let i=await this.executeTakeFirst();if(i===void 0)throw xe(e)?new e(this.toOperationNode()):e(this.toOperationNode());return i}async*stream(e=100){let i=this.compile(),n=this.#e.executor.stream(i,e,this.#e.queryId);for await(let o of n)yield*o.rows}async explain(e,i){return await new t({...this.#e,queryNode:c.cloneWithExplain(this.#e.queryNode,e,i)}).execute()}};s(Qe,"don't await InsertQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");var tr=class{numDeletedRows;constructor(e){this.numDeletedRows=e}};var rr=r({is(t){return t.kind==="LimitNode"},create(t){return r({kind:"LimitNode",limit:E.create(t)})}});var Nt=class t{#e;constructor(e){this.#e=r(e)}where(...e){return new t({...this.#e,queryNode:c.cloneWithWhere(this.#e.queryNode,g(e))})}whereRef(e,i,n){return new t({...this.#e,queryNode:c.cloneWithWhere(this.#e.queryNode,R(e,i,n))})}clearWhere(){return new t({...this.#e,queryNode:c.cloneWithoutWhere(this.#e.queryNode)})}using(e){return new t({...this.#e,queryNode:ye.cloneWithUsing(this.#e.queryNode,re(e))})}innerJoin(...e){return new t({...this.#e,queryNode:c.cloneWithJoin(this.#e.queryNode,A("InnerJoin",e))})}leftJoin(...e){return new t({...this.#e,queryNode:c.cloneWithJoin(this.#e.queryNode,A("LeftJoin",e))})}rightJoin(...e){return new t({...this.#e,queryNode:c.cloneWithJoin(this.#e.queryNode,A("RightJoin",e))})}fullJoin(...e){return new t({...this.#e,queryNode:c.cloneWithJoin(this.#e.queryNode,A("FullJoin",e))})}returning(e){return new t({...this.#e,queryNode:c.cloneWithReturning(this.#e.queryNode,$(e))})}returningAll(e){return new t({...this.#e,queryNode:c.cloneWithReturning(this.#e.queryNode,ee(e))})}orderBy(e,i){return new t({...this.#e,queryNode:ye.cloneWithOrderByItems(this.#e.queryNode,Ne([e,i]))})}limit(e){return new t({...this.#e,queryNode:ye.cloneWithLimit(this.#e.queryNode,rr.create(e))})}$call(e){return e(this)}$if(e,i){return e?i(this):new t({...this.#e})}$castTo(){return new t(this.#e)}$narrowType(){return new t(this.#e)}$assertType(){return new t(this.#e)}withPlugin(e){return new t({...this.#e,executor:this.#e.executor.withPlugin(e)})}toOperationNode(){return this.#e.executor.transformQuery(this.#e.queryNode,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){let e=this.compile(),i=e.query,n=await this.#e.executor.executeQuery(e,this.#e.queryId);return this.#e.executor.adapter.supportsReturning&&i.returning?n.rows:[new tr(n.numAffectedRows??n.numUpdatedOrDeletedRows??BigInt(0))]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=te){let i=await this.executeTakeFirst();if(i===void 0)throw xe(e)?new e(this.toOperationNode()):e(this.toOperationNode());return i}async*stream(e=100){let i=this.compile(),n=this.#e.executor.stream(i,e,this.#e.queryId);for await(let o of n)yield*o.rows}async explain(e,i){return await new t({...this.#e,queryNode:c.cloneWithExplain(this.#e.queryNode,e,i)}).execute()}};s(Nt,"don't await DeleteQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");var ir=class{numUpdatedRows;numChangedRows;constructor(e,i){this.numUpdatedRows=e,this.numChangedRows=i}};var yt=class t{#e;constructor(e){this.#e=r(e)}where(...e){return new t({...this.#e,queryNode:c.cloneWithWhere(this.#e.queryNode,g(e))})}whereRef(e,i,n){return new t({...this.#e,queryNode:c.cloneWithWhere(this.#e.queryNode,R(e,i,n))})}clearWhere(){return new t({...this.#e,queryNode:c.cloneWithoutWhere(this.#e.queryNode)})}from(e){return new t({...this.#e,queryNode:Se.cloneWithFromItems(this.#e.queryNode,re(e))})}innerJoin(...e){return new t({...this.#e,queryNode:c.cloneWithJoin(this.#e.queryNode,A("InnerJoin",e))})}leftJoin(...e){return new t({...this.#e,queryNode:c.cloneWithJoin(this.#e.queryNode,A("LeftJoin",e))})}rightJoin(...e){return new t({...this.#e,queryNode:c.cloneWithJoin(this.#e.queryNode,A("RightJoin",e))})}fullJoin(...e){return new t({...this.#e,queryNode:c.cloneWithJoin(this.#e.queryNode,A("FullJoin",e))})}set(e){return new t({...this.#e,queryNode:Se.cloneWithUpdates(this.#e.queryNode,Fe(e))})}returning(e){return new t({...this.#e,queryNode:c.cloneWithReturning(this.#e.queryNode,$(e))})}returningAll(){return new t({...this.#e,queryNode:c.cloneWithReturning(this.#e.queryNode,ee())})}$call(e){return e(this)}$if(e,i){return e?i(this):new t({...this.#e})}$castTo(){return new t(this.#e)}$narrowType(){return new t(this.#e)}$assertType(){return new t(this.#e)}withPlugin(e){return new t({...this.#e,executor:this.#e.executor.withPlugin(e)})}toOperationNode(){return this.#e.executor.transformQuery(this.#e.queryNode,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){let e=this.compile(),i=e.query,n=await this.#e.executor.executeQuery(e,this.#e.queryId);return this.#e.executor.adapter.supportsReturning&&i.returning?n.rows:[new ir(n.numAffectedRows??n.numUpdatedOrDeletedRows??BigInt(0),n.numChangedRows)]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=te){let i=await this.executeTakeFirst();if(i===void 0)throw xe(e)?new e(this.toOperationNode()):e(this.toOperationNode());return i}async*stream(e=100){let i=this.compile(),n=this.#e.executor.stream(i,e,this.#e.queryId);for await(let o of n)yield*o.rows}async explain(e,i){return await new t({...this.#e,queryNode:c.cloneWithExplain(this.#e.queryNode,e,i)}).execute()}};s(yt,"don't await UpdateQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");var zr=r({is(t){return t.kind==="CommonTableExpressionNameNode"},create(t,e){return r({kind:"CommonTableExpressionNameNode",table:J.create(t),columns:e?r(e.map(m.create)):void 0})}});var $e=r({is(t){return t.kind==="CommonTableExpressionNode"},create(t,e){return r({kind:"CommonTableExpressionNode",name:t,expression:e})},cloneWith(t,e){return r({...t,...e})}});var xt=class t{#e;constructor(e){this.#e=r(e)}materialized(){return new t({...this.#e,node:$e.cloneWith(this.#e.node,{materialized:!0})})}notMaterialized(){return new t({...this.#e,node:$e.cloneWith(this.#e.node,{materialized:!1})})}toOperationNode(){return this.#e.node}};s(xt,"don't await CTEBuilder instances. They are never executed directly and are always just a part of a query.");function Jr(t,e){let i=e(Mi()).toOperationNode();return y(t)?t(An(i)).toOperationNode():$e.create(_i(t),i)}function An(t){return e=>new xt({node:$e.create(_i(e),t)})}function _i(t){if(t.includes("(")){let e=t.split(/[\(\)]/),i=e[0],n=e[1].split(",").map(o=>o.trim());return zr.create(i,n)}else return zr.create(t)}var gt=r({is(t){return t.kind==="WithNode"},create(t,e){return r({kind:"WithNode",expressions:r([t]),...e})},cloneWithExpression(t,e){return r({...t,expressions:r([...t.expressions,e])})}});var Fi=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function Qi(t){let e="";for(let i=0;i<t;++i)e+=qn();return e}function qn(){return Fi[~~(Math.random()*Fi.length)]}function p(){return new Kr}var Kr=class{#e;get queryId(){return this.#e===void 0&&(this.#e=Qi(8)),this.#e}};var ge=class{nodeStack=[];#e=r({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this),TupleNode:this.transformTuple.bind(this)});transformNode(e){if(!e)return e;this.nodeStack.push(e);let i=this.transformNodeImpl(e);return this.nodeStack.pop(),r(i)}transformNodeImpl(e){return this.#e[e.kind](e)}transformNodeList(e){return e&&r(e.map(i=>this.transformNode(i)))}transformSelectQuery(e){return{kind:"SelectQueryNode",from:this.transformNode(e.from),selections:this.transformNodeList(e.selections),distinctOn:this.transformNodeList(e.distinctOn),joins:this.transformNodeList(e.joins),groupBy:this.transformNode(e.groupBy),orderBy:this.transformNode(e.orderBy),where:this.transformNode(e.where),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),limit:this.transformNode(e.limit),offset:this.transformNode(e.offset),with:this.transformNode(e.with),having:this.transformNode(e.having),explain:this.transformNode(e.explain),setOperations:this.transformNodeList(e.setOperations)}}transformSelection(e){return{kind:"SelectionNode",selection:this.transformNode(e.selection)}}transformColumn(e){return{kind:"ColumnNode",column:this.transformNode(e.column)}}transformAlias(e){return{kind:"AliasNode",node:this.transformNode(e.node),alias:this.transformNode(e.alias)}}transformTable(e){return{kind:"TableNode",table:this.transformNode(e.table)}}transformFrom(e){return{kind:"FromNode",froms:this.transformNodeList(e.froms)}}transformReference(e){return{kind:"ReferenceNode",column:this.transformNode(e.column),table:this.transformNode(e.table)}}transformAnd(e){return{kind:"AndNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformOr(e){return{kind:"OrNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformValueList(e){return{kind:"ValueListNode",values:this.transformNodeList(e.values)}}transformParens(e){return{kind:"ParensNode",node:this.transformNode(e.node)}}transformJoin(e){return{kind:"JoinNode",joinType:e.joinType,table:this.transformNode(e.table),on:this.transformNode(e.on)}}transformRaw(e){return{kind:"RawNode",sqlFragments:r([...e.sqlFragments]),parameters:this.transformNodeList(e.parameters)}}transformWhere(e){return{kind:"WhereNode",where:this.transformNode(e.where)}}transformInsertQuery(e){return{kind:"InsertQueryNode",into:this.transformNode(e.into),columns:this.transformNodeList(e.columns),values:this.transformNode(e.values),returning:this.transformNode(e.returning),onConflict:this.transformNode(e.onConflict),onDuplicateKey:this.transformNode(e.onDuplicateKey),with:this.transformNode(e.with),ignore:e.ignore,replace:e.replace,explain:this.transformNode(e.explain)}}transformValues(e){return{kind:"ValuesNode",values:this.transformNodeList(e.values)}}transformDeleteQuery(e){return{kind:"DeleteQueryNode",from:this.transformNode(e.from),using:this.transformNode(e.using),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),returning:this.transformNode(e.returning),with:this.transformNode(e.with),orderBy:this.transformNode(e.orderBy),limit:this.transformNode(e.limit),explain:this.transformNode(e.explain)}}transformReturning(e){return{kind:"ReturningNode",selections:this.transformNodeList(e.selections)}}transformCreateTable(e){return{kind:"CreateTableNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),constraints:this.transformNodeList(e.constraints),temporary:e.temporary,ifNotExists:e.ifNotExists,onCommit:e.onCommit,frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers)}}transformColumnDefinition(e){return{kind:"ColumnDefinitionNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),references:this.transformNode(e.references),primaryKey:e.primaryKey,autoIncrement:e.autoIncrement,unique:e.unique,notNull:e.notNull,unsigned:e.unsigned,defaultTo:this.transformNode(e.defaultTo),check:this.transformNode(e.check),generated:this.transformNode(e.generated),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers)}}transformAddColumn(e){return{kind:"AddColumnNode",column:this.transformNode(e.column)}}transformDropTable(e){return{kind:"DropTableNode",table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformOrderBy(e){return{kind:"OrderByNode",items:this.transformNodeList(e.items)}}transformOrderByItem(e){return{kind:"OrderByItemNode",orderBy:this.transformNode(e.orderBy),direction:this.transformNode(e.direction)}}transformGroupBy(e){return{kind:"GroupByNode",items:this.transformNodeList(e.items)}}transformGroupByItem(e){return{kind:"GroupByItemNode",groupBy:this.transformNode(e.groupBy)}}transformUpdateQuery(e){return{kind:"UpdateQueryNode",table:this.transformNode(e.table),from:this.transformNode(e.from),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),updates:this.transformNodeList(e.updates),returning:this.transformNode(e.returning),with:this.transformNode(e.with),explain:this.transformNode(e.explain)}}transformColumnUpdate(e){return{kind:"ColumnUpdateNode",column:this.transformNode(e.column),value:this.transformNode(e.value)}}transformLimit(e){return{kind:"LimitNode",limit:this.transformNode(e.limit)}}transformOffset(e){return{kind:"OffsetNode",offset:this.transformNode(e.offset)}}transformOnConflict(e){return{kind:"OnConflictNode",columns:this.transformNodeList(e.columns),constraint:this.transformNode(e.constraint),indexExpression:this.transformNode(e.indexExpression),indexWhere:this.transformNode(e.indexWhere),updates:this.transformNodeList(e.updates),updateWhere:this.transformNode(e.updateWhere),doNothing:e.doNothing}}transformOnDuplicateKey(e){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(e.updates)}}transformCreateIndex(e){return{kind:"CreateIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists,where:this.transformNode(e.where)}}transformList(e){return{kind:"ListNode",items:this.transformNodeList(e.items)}}transformDropIndex(e){return{kind:"DropIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformPrimaryKeyConstraint(e){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)}}transformUniqueConstraint(e){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)}}transformForeignKeyConstraint(e){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(e.columns),references:this.transformNode(e.references),name:this.transformNode(e.name),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformSetOperation(e){return{kind:"SetOperationNode",operator:e.operator,expression:this.transformNode(e.expression),all:e.all}}transformReferences(e){return{kind:"ReferencesNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformCheckConstraint(e){return{kind:"CheckConstraintNode",expression:this.transformNode(e.expression),name:this.transformNode(e.name)}}transformWith(e){return{kind:"WithNode",expressions:this.transformNodeList(e.expressions),recursive:e.recursive}}transformCommonTableExpression(e){return{kind:"CommonTableExpressionNode",name:this.transformNode(e.name),materialized:e.materialized,expression:this.transformNode(e.expression)}}transformCommonTableExpressionName(e){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns)}}transformHaving(e){return{kind:"HavingNode",having:this.transformNode(e.having)}}transformCreateSchema(e){return{kind:"CreateSchemaNode",schema:this.transformNode(e.schema),ifNotExists:e.ifNotExists}}transformDropSchema(e){return{kind:"DropSchemaNode",schema:this.transformNode(e.schema),ifExists:e.ifExists,cascade:e.cascade}}transformAlterTable(e){return{kind:"AlterTableNode",table:this.transformNode(e.table),renameTo:this.transformNode(e.renameTo),setSchema:this.transformNode(e.setSchema),columnAlterations:this.transformNodeList(e.columnAlterations),addConstraint:this.transformNode(e.addConstraint),dropConstraint:this.transformNode(e.dropConstraint)}}transformDropColumn(e){return{kind:"DropColumnNode",column:this.transformNode(e.column)}}transformRenameColumn(e){return{kind:"RenameColumnNode",column:this.transformNode(e.column),renameTo:this.transformNode(e.renameTo)}}transformAlterColumn(e){return{kind:"AlterColumnNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),dataTypeExpression:this.transformNode(e.dataTypeExpression),setDefault:this.transformNode(e.setDefault),dropDefault:e.dropDefault,setNotNull:e.setNotNull,dropNotNull:e.dropNotNull}}transformModifyColumn(e){return{kind:"ModifyColumnNode",column:this.transformNode(e.column)}}transformAddConstraint(e){return{kind:"AddConstraintNode",constraint:this.transformNode(e.constraint)}}transformDropConstraint(e){return{kind:"DropConstraintNode",constraintName:this.transformNode(e.constraintName),ifExists:e.ifExists,modifier:e.modifier}}transformCreateView(e){return{kind:"CreateViewNode",name:this.transformNode(e.name),temporary:e.temporary,orReplace:e.orReplace,ifNotExists:e.ifNotExists,materialized:e.materialized,columns:this.transformNodeList(e.columns),as:this.transformNode(e.as)}}transformDropView(e){return{kind:"DropViewNode",name:this.transformNode(e.name),ifExists:e.ifExists,materialized:e.materialized,cascade:e.cascade}}transformGenerated(e){return{kind:"GeneratedNode",byDefault:e.byDefault,always:e.always,identity:e.identity,stored:e.stored,expression:this.transformNode(e.expression)}}transformDefaultValue(e){return{kind:"DefaultValueNode",defaultValue:this.transformNode(e.defaultValue)}}transformOn(e){return{kind:"OnNode",on:this.transformNode(e.on)}}transformSelectModifier(e){return{kind:"SelectModifierNode",modifier:e.modifier,rawModifier:this.transformNode(e.rawModifier)}}transformCreateType(e){return{kind:"CreateTypeNode",name:this.transformNode(e.name),enum:this.transformNode(e.enum)}}transformDropType(e){return{kind:"DropTypeNode",name:this.transformNode(e.name),ifExists:e.ifExists}}transformExplain(e){return{kind:"ExplainNode",format:e.format,options:this.transformNode(e.options)}}transformSchemableIdentifier(e){return{kind:"SchemableIdentifierNode",schema:this.transformNode(e.schema),identifier:this.transformNode(e.identifier)}}transformAggregateFunction(e){return{kind:"AggregateFunctionNode",aggregated:this.transformNodeList(e.aggregated),distinct:e.distinct,filter:this.transformNode(e.filter),func:e.func,over:this.transformNode(e.over)}}transformOver(e){return{kind:"OverNode",orderBy:this.transformNode(e.orderBy),partitionBy:this.transformNode(e.partitionBy)}}transformPartitionBy(e){return{kind:"PartitionByNode",items:this.transformNodeList(e.items)}}transformPartitionByItem(e){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(e.partitionBy)}}transformBinaryOperation(e){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(e.leftOperand),operator:this.transformNode(e.operator),rightOperand:this.transformNode(e.rightOperand)}}transformUnaryOperation(e){return{kind:"UnaryOperationNode",operator:this.transformNode(e.operator),operand:this.transformNode(e.operand)}}transformUsing(e){return{kind:"UsingNode",tables:this.transformNodeList(e.tables)}}transformFunction(e){return{kind:"FunctionNode",func:e.func,arguments:this.transformNodeList(e.arguments)}}transformCase(e){return{kind:"CaseNode",value:this.transformNode(e.value),when:this.transformNodeList(e.when),else:this.transformNode(e.else),isStatement:e.isStatement}}transformWhen(e){return{kind:"WhenNode",condition:this.transformNode(e.condition),result:this.transformNode(e.result)}}transformJSONReference(e){return{kind:"JSONReferenceNode",reference:this.transformNode(e.reference),traversal:this.transformNode(e.traversal)}}transformJSONPath(e){return{kind:"JSONPathNode",inOperator:this.transformNode(e.inOperator),pathLegs:this.transformNodeList(e.pathLegs)}}transformJSONPathLeg(e){return{kind:"JSONPathLegNode",type:e.type,value:e.value}}transformJSONOperatorChain(e){return{kind:"JSONOperatorChainNode",operator:this.transformNode(e.operator),values:this.transformNodeList(e.values)}}transformTuple(e){return{kind:"TupleNode",values:this.transformNodeList(e.values)}}transformDataType(e){return e}transformSelectAll(e){return e}transformIdentifier(e){return e}transformValue(e){return e}transformPrimitiveValueList(e){return e}transformOperator(e){return e}transformDefaultInsertValue(e){return e}};var Rn=r({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0}),nr=class extends ge{#e;#t=new Set;#r=new Set;constructor(e){super(),this.#e=e}transformNodeImpl(e){if(!this.#i(e))return super.transformNodeImpl(e);let i=this.#s(e);for(let a of i)this.#r.add(a);let n=this.#n(e);for(let a of n)this.#t.add(a);let o=super.transformNodeImpl(e);for(let a of n)this.#t.delete(a);for(let a of i)this.#r.delete(a);return o}transformSchemableIdentifier(e){let i=super.transformSchemableIdentifier(e);return i.schema||!this.#t.has(e.identifier.name)?i:{...i,schema:u.create(this.#e)}}transformReferences(e){let i=super.transformReferences(e);return i.table.table.schema?i:{...i,table:J.createWithSchema(this.#e,i.table.table.identifier.name)}}#i(e){return e.kind in Rn}#n(e){let i=new Set;if("name"in e&&e.name&&P.is(e.name)&&this.#a(e.name,i),"from"in e&&e.from)for(let n of e.from.froms)this.#o(n,i);if("into"in e&&e.into&&this.#o(e.into,i),"table"in e&&e.table&&this.#o(e.table,i),"joins"in e&&e.joins)for(let n of e.joins)this.#o(n.table,i);return i}#s(e){let i=new Set;return"with"in e&&e.with&&this.#u(e.with,i),i}#o(e,i){let n=J.is(e)?e:q.is(e)&&J.is(e.node)?e.node:null;n&&this.#a(n.table,i)}#a(e,i){let n=e.identifier.name;!this.#t.has(n)&&!this.#r.has(n)&&i.add(n)}#u(e,i){for(let n of e.expressions){let o=n.name.table.table.identifier.name;this.#r.has(o)||i.add(o)}}};var j=class{#e;constructor(e){this.#e=new nr(e)}transformQuery(e){return this.#e.transformNode(e.node)}async transformResult(e){return e.result}};var Ue=class t{#e;constructor(e){this.#e=r(e)}selectFrom(e){return ke({queryId:p(),executor:this.#e.executor,queryNode:d.createFrom(re(e),this.#e.withNode)})}selectNoFrom(e){return ke({queryId:p(),executor:this.#e.executor,queryNode:d.cloneWithSelections(d.create(this.#e.withNode),$(e))})}insertInto(e){return new Qe({queryId:p(),executor:this.#e.executor,queryNode:V.create(b(e),this.#e.withNode)})}replaceInto(e){return new Qe({queryId:p(),executor:this.#e.executor,queryNode:V.create(b(e),this.#e.withNode,!0)})}deleteFrom(e){return new Nt({queryId:p(),executor:this.#e.executor,queryNode:ye.create(re(e),this.#e.withNode)})}updateTable(e){return new yt({queryId:p(),executor:this.#e.executor,queryNode:Se.create(we(e),this.#e.withNode)})}with(e,i){let n=Jr(e,i);return new t({...this.#e,withNode:this.#e.withNode?gt.cloneWithExpression(this.#e.withNode,n):gt.create(n)})}withRecursive(e,i){let n=Jr(e,i);return new t({...this.#e,withNode:this.#e.withNode?gt.cloneWithExpression(this.#e.withNode,n):gt.create(n,{recursive:!0})})}withPlugin(e){return new t({...this.#e,executor:this.#e.executor.withPlugin(e)})}withoutPlugins(){return new t({...this.#e,executor:this.#e.executor.withoutPlugins()})}withSchema(e){return new t({...this.#e,executor:this.#e.executor.withPluginAtFront(new j(e))})}};var wt=class{#e;#t;#r;constructor(){this.#e=new Promise((e,i)=>{this.#r=i,this.#t=e})}get promise(){return this.#e}resolve=e=>{this.#t&&this.#t(e)};reject=e=>{this.#r&&this.#r(e)}};var $i=new Set;function jr(t){$i.has(t)||($i.add(t),console.log(t))}var Ln=r([]),Ve=class{#e;constructor(e=Ln){this.#e=e}get plugins(){return this.#e}transformQuery(e,i){for(let n of this.#e){let o=n.transformQuery({node:e,queryId:i});if(o.kind===e.kind)e=o;else throw new Error(["KyselyPlugin.transformQuery must return a node","of the same kind that was given to it.",`The plugin was given a ${e.kind}`,`but it returned a ${o.kind}`].join(" "))}return e}async executeQuery(e,i){return await this.provideConnection(async n=>{let o=await n.executeQuery(e),a=await this.#t(o,i);return Bn(o,a),a})}async*stream(e,i,n){let o=new wt,a=new wt;this.provideConnection(async I=>(o.resolve(I),await a.promise)).catch(I=>o.reject(I));let N=await o.promise;try{for await(let I of N.streamQuery(e,i))yield await this.#t(I,n)}finally{a.resolve()}}async#t(e,i){for(let n of this.#e)e=await n.transformResult({result:e,queryId:i});return e}};function Bn(t,e){let{numAffectedRows:i}=t;i===void 0&&t.numUpdatedOrDeletedRows===void 0||i!==void 0&&e.numAffectedRows!==void 0||jr("kysely:warning: outdated driver/plugin detected! QueryResult.numUpdatedOrDeletedRows is deprecated and will be removed in a future release.")}var Gr=class t extends Ve{get adapter(){throw new Error("this query cannot be compiled to SQL")}compileQuery(){throw new Error("this query cannot be compiled to SQL")}provideConnection(){throw new Error("this query cannot be executed")}withConnectionProvider(){throw new Error("this query cannot have a connection provider")}withPlugin(e){return new t([...this.plugins,e])}withPlugins(e){return new t([...this.plugins,...e])}withPluginAtFront(e){return new t([e,...this.plugins])}withoutPlugins(){return new t([])}},ze=new Gr;function Mi(){return new Ue({executor:ze})}function Ui(t,e){return new ht({joinNode:fe.create(t,we(e))})}function Vi(){return new lt({overNode:pt.create()})}function A(t,e){if(e.length===3)return _n(t,e[0],e[1],e[2]);if(e.length===2)return Pn(t,e[0],e[1]);throw new Error("not implemented")}function Pn(t,e,i){return i(Ui(t,e)).toOperationNode()}function _n(t,e,i,n){return fe.createWithOn(t,we(e),R(i,"=",n))}var zi=r({is(t){return t.kind==="OffsetNode"},create(t){return r({kind:"OffsetNode",offset:E.create(t)})}});var Ji=r({is(t){return t.kind==="GroupByItemNode"},create(t){return r({kind:"GroupByItemNode",groupBy:t})}});function Ki(t){return t=y(t)?t(U()):t,ae(t).map(Ji.create)}var Hr=r({is(t){return t.kind==="SetOperationNode"},create(t,e,i){return r({kind:"SetOperationNode",operator:t,expression:e,all:i})}});function Ie(t,e,i){return y(e)&&(e=e(or())),L(e)||(e=[e]),e.map(n=>Hr.create(t,K(n),i))}var f=class t{#e;constructor(e){this.#e=e}get expressionType(){}as(e){return new Ot(this,e)}or(...e){return new Yr(H.create(this.#e,g(e)))}and(...e){return new Zr(_.create(this.#e,g(e)))}$castTo(){return new t(this.#e)}toOperationNode(){return this.#e}},Ot=class{#e;#t;constructor(e,i){this.#e=e,this.#t=i}get expression(){return this.#e}get alias(){return this.#t}toOperationNode(){return q.create(this.#e.toOperationNode(),C(this.#t)?this.#t.toOperationNode():u.create(this.#t))}},Yr=class t{#e;constructor(e){this.#e=e}get expressionType(){}as(e){return new Ot(this,e)}or(...e){return new t(H.create(this.#e,g(e)))}$castTo(){return new t(this.#e)}toOperationNode(){return ue.create(this.#e)}},Zr=class t{#e;constructor(e){this.#e=e}get expressionType(){}as(e){return new Ot(this,e)}and(...e){return new t(_.create(this.#e,g(e)))}$castTo(){return new t(this.#e)}toOperationNode(){return ue.create(this.#e)}};var sr=class t{#e;constructor(e){this.#e=r(e)}get expressionType(){}get isSelectQueryBuilder(){return!0}where(...e){return new t({...this.#e,queryNode:c.cloneWithWhere(this.#e.queryNode,g(e))})}whereRef(e,i,n){return new t({...this.#e,queryNode:c.cloneWithWhere(this.#e.queryNode,R(e,i,n))})}having(...e){return new t({...this.#e,queryNode:d.cloneWithHaving(this.#e.queryNode,g(e))})}havingRef(e,i,n){return new t({...this.#e,queryNode:d.cloneWithHaving(this.#e.queryNode,R(e,i,n))})}select(e){return new t({...this.#e,queryNode:d.cloneWithSelections(this.#e.queryNode,$(e))})}distinctOn(e){return new t({...this.#e,queryNode:d.cloneWithDistinctOn(this.#e.queryNode,ae(e))})}modifyFront(e){return new t({...this.#e,queryNode:d.cloneWithFrontModifier(this.#e.queryNode,X.createWithExpression(e.toOperationNode()))})}modifyEnd(e){return new t({...this.#e,queryNode:d.cloneWithEndModifier(this.#e.queryNode,X.createWithExpression(e.toOperationNode()))})}distinct(){return new t({...this.#e,queryNode:d.cloneWithFrontModifier(this.#e.queryNode,X.create("Distinct"))})}forUpdate(){return new t({...this.#e,queryNode:d.cloneWithEndModifier(this.#e.queryNode,X.create("ForUpdate"))})}forShare(){return new t({...this.#e,queryNode:d.cloneWithEndModifier(this.#e.queryNode,X.create("ForShare"))})}forKeyShare(){return new t({...this.#e,queryNode:d.cloneWithEndModifier(this.#e.queryNode,X.create("ForKeyShare"))})}forNoKeyUpdate(){return new t({...this.#e,queryNode:d.cloneWithEndModifier(this.#e.queryNode,X.create("ForNoKeyUpdate"))})}skipLocked(){return new t({...this.#e,queryNode:d.cloneWithEndModifier(this.#e.queryNode,X.create("SkipLocked"))})}noWait(){return new t({...this.#e,queryNode:d.cloneWithEndModifier(this.#e.queryNode,X.create("NoWait"))})}selectAll(e){return new t({...this.#e,queryNode:d.cloneWithSelections(this.#e.queryNode,ee(e))})}innerJoin(...e){return new t({...this.#e,queryNode:c.cloneWithJoin(this.#e.queryNode,A("InnerJoin",e))})}leftJoin(...e){return new t({...this.#e,queryNode:c.cloneWithJoin(this.#e.queryNode,A("LeftJoin",e))})}rightJoin(...e){return new t({...this.#e,queryNode:c.cloneWithJoin(this.#e.queryNode,A("RightJoin",e))})}fullJoin(...e){return new t({...this.#e,queryNode:c.cloneWithJoin(this.#e.queryNode,A("FullJoin",e))})}innerJoinLateral(...e){return new t({...this.#e,queryNode:c.cloneWithJoin(this.#e.queryNode,A("LateralInnerJoin",e))})}leftJoinLateral(...e){return new t({...this.#e,queryNode:c.cloneWithJoin(this.#e.queryNode,A("LateralLeftJoin",e))})}orderBy(...e){return new t({...this.#e,queryNode:d.cloneWithOrderByItems(this.#e.queryNode,Ne(e))})}groupBy(e){return new t({...this.#e,queryNode:d.cloneWithGroupByItems(this.#e.queryNode,Ki(e))})}limit(e){return new t({...this.#e,queryNode:d.cloneWithLimit(this.#e.queryNode,rr.create(e))})}offset(e){return new t({...this.#e,queryNode:d.cloneWithOffset(this.#e.queryNode,zi.create(e))})}union(e){return new t({...this.#e,queryNode:d.cloneWithSetOperations(this.#e.queryNode,Ie("union",e,!1))})}unionAll(e){return new t({...this.#e,queryNode:d.cloneWithSetOperations(this.#e.queryNode,Ie("union",e,!0))})}intersect(e){return new t({...this.#e,queryNode:d.cloneWithSetOperations(this.#e.queryNode,Ie("intersect",e,!1))})}intersectAll(e){return new t({...this.#e,queryNode:d.cloneWithSetOperations(this.#e.queryNode,Ie("intersect",e,!0))})}except(e){return new t({...this.#e,queryNode:d.cloneWithSetOperations(this.#e.queryNode,Ie("except",e,!1))})}exceptAll(e){return new t({...this.#e,queryNode:d.cloneWithSetOperations(this.#e.queryNode,Ie("except",e,!0))})}as(e){return new ar(this,e)}clearSelect(){return new t({...this.#e,queryNode:d.cloneWithoutSelections(this.#e.queryNode)})}clearWhere(){return new t({...this.#e,queryNode:c.cloneWithoutWhere(this.#e.queryNode)})}clearLimit(){return new t({...this.#e,queryNode:d.cloneWithoutLimit(this.#e.queryNode)})}clearOffset(){return new t({...this.#e,queryNode:d.cloneWithoutOffset(this.#e.queryNode)})}clearOrderBy(){return new t({...this.#e,queryNode:d.cloneWithoutOrderBy(this.#e.queryNode)})}$call(e){return e(this)}$if(e,i){return e?i(this):new t({...this.#e})}$castTo(){return new t(this.#e)}$narrowType(){return new t(this.#e)}$assertType(){return new t(this.#e)}$asTuple(){return new f(this.toOperationNode())}withPlugin(e){return new t({...this.#e,executor:this.#e.executor.withPlugin(e)})}toOperationNode(){return this.#e.executor.transformQuery(this.#e.queryNode,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){let e=this.compile();return(await this.#e.executor.executeQuery(e,this.#e.queryId)).rows}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=te){let i=await this.executeTakeFirst();if(i===void 0)throw xe(e)?new e(this.toOperationNode()):e(this.toOperationNode());return i}async*stream(e=100){let i=this.compile(),n=this.#e.executor.stream(i,e,this.#e.queryId);for await(let o of n)yield*o.rows}async explain(e,i){return await new t({...this.#e,queryNode:c.cloneWithExplain(this.#e.queryNode,e,i)}).execute()}};s(sr,"don't await SelectQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");function ke(t){return new sr(t)}var ar=class{#e;#t;constructor(e,i){this.#e=e,this.#t=i}get expression(){return this.#e}get alias(){return this.#t}get isAliasedSelectQueryBuilder(){return!0}toOperationNode(){return q.create(this.#e.toOperationNode(),u.create(this.#t))}};s(ar,"don't await AliasedSelectQueryBuilder instances directly. AliasedSelectQueryBuilder should never be executed directly since it's always a part of another query.");var Oe=r({is(t){return t.kind==="AggregateFunctionNode"},create(t,e=[]){return r({kind:"AggregateFunctionNode",func:t,aggregated:e})},cloneWithDistinct(t){return r({...t,distinct:!0})},cloneWithFilter(t,e){return r({...t,filter:t.filter?D.cloneWithOperation(t.filter,"And",e):D.create(e)})},cloneWithOrFilter(t,e){return r({...t,filter:t.filter?D.cloneWithOperation(t.filter,"Or",e):D.create(e)})},cloneWithOver(t,e){return r({...t,over:e})}});var ji=r({is(t){return t.kind==="FunctionNode"},create(t,e){return r({kind:"FunctionNode",func:t,arguments:e})}});var Je=class t{#e;constructor(e){this.#e=r(e)}get expressionType(){}as(e){return new Xr(this,e)}distinct(){return new t({...this.#e,aggregateFunctionNode:Oe.cloneWithDistinct(this.#e.aggregateFunctionNode)})}filterWhere(...e){return new t({...this.#e,aggregateFunctionNode:Oe.cloneWithFilter(this.#e.aggregateFunctionNode,g(e))})}filterWhereRef(e,i,n){return new t({...this.#e,aggregateFunctionNode:Oe.cloneWithFilter(this.#e.aggregateFunctionNode,R(e,i,n))})}over(e){let i=Vi();return new t({...this.#e,aggregateFunctionNode:Oe.cloneWithOver(this.#e.aggregateFunctionNode,(e?e(i):i).toOperationNode())})}$call(e){return e(this)}toOperationNode(){return this.#e.aggregateFunctionNode}};s(Je,"don't await AggregateFunctionBuilder instances. They are never executed directly and are always just a part of a query.");var Xr=class{#e;#t;constructor(e,i){this.#e=e,this.#t=i}get expression(){return this.#e}get alias(){return this.#t}toOperationNode(){return q.create(this.#e.toOperationNode(),u.create(this.#t))}};function ur(){let t=(i,n)=>new f(ji.create(i,ae(n))),e=(i,n)=>new Je({aggregateFunctionNode:Oe.create(i,n?ae(n):void 0)});return Object.assign(t,{agg:e,avg(i){return e("avg",[i])},coalesce(i,...n){return t("coalesce",[i,...n])},count(i){return e("count",[i])},countAll(i){return new Je({aggregateFunctionNode:Oe.create("count",ee(i))})},max(i){return e("max",[i])},min(i){return e("min",[i])},sum(i){return e("sum",[i])},any(i){return t("any",[i])}})}var Gi=r({is(t){return t.kind==="UnaryOperationNode"},create(t,e){return r({kind:"UnaryOperationNode",operator:t,operand:e})}});function Hi(t,e){return Gi.create(Y.create(t),M(e))}var bt=r({is(t){return t.kind==="WhenNode"},create(t){return r({kind:"WhenNode",condition:t})},cloneWithResult(t,e){return r({...t,result:e})}});var z=r({is(t){return t.kind==="CaseNode"},create(t){return r({kind:"CaseNode",value:t})},cloneWithWhen(t,e){return r({...t,when:r(t.when?[...t.when,e]:[e])})},cloneWithThen(t,e){return r({...t,when:t.when?r([...t.when.slice(0,-1),bt.cloneWithResult(t.when[t.when.length-1],e)]):void 0})},cloneWith(t,e){return r({...t,...e})}});var Ke=class{#e;constructor(e){this.#e=r(e)}when(...e){return new dr({...this.#e,node:z.cloneWithWhen(this.#e.node,bt.create(g(e)))})}},dr=class{#e;constructor(e){this.#e=r(e)}then(e){return new ei({...this.#e,node:z.cloneWithThen(this.#e.node,Gt(e)?mt(e):v(e))})}},ei=class{#e;constructor(e){this.#e=r(e)}when(...e){return new dr({...this.#e,node:z.cloneWithWhen(this.#e.node,bt.create(g(e)))})}else(e){return new ti({...this.#e,node:z.cloneWith(this.#e.node,{else:Gt(e)?mt(e):v(e)})})}end(){return new f(z.cloneWith(this.#e.node,{isStatement:!1}))}endCase(){return new f(z.cloneWith(this.#e.node,{isStatement:!0}))}},ti=class{#e;constructor(e){this.#e=r(e)}end(){return new f(z.cloneWith(this.#e.node,{isStatement:!1}))}endCase(){return new f(z.cloneWith(this.#e.node,{isStatement:!0}))}};var Yi=r({is(t){return t.kind==="JSONPathLegNode"},create(t,e){return r({kind:"JSONPathLegNode",type:t,value:e})}});var je=class{#e;constructor(e){this.#e=e}at(e){return this.#t("ArrayLocation",e)}key(e){return this.#t("Member",e)}#t(e,i){return new ri(dt.cloneWithTraversal(this.#e,ct.is(this.#e.traversal)?ct.cloneWithLeg(this.#e.traversal,Yi.create(e,i)):Jt.cloneWithValue(this.#e.traversal,E.createImmediate(i))))}},ri=class extends je{#e;constructor(e){super(e),this.#e=e}get expressionType(){}as(e){return new ii(this,e)}$castTo(){return new je(this.#e)}toOperationNode(){return this.#e}},ii=class{#e;#t;constructor(e,i){this.#e=e,this.#t=i}get expression(){return this.#e}get alias(){return this.#t}toOperationNode(){return q.create(this.#e.toOperationNode(),C(this.#t)?this.#t.toOperationNode():u.create(this.#t))}};var ni=r({is(t){return t.kind==="TupleNode"},create(t){return r({kind:"TupleNode",values:r(t)})}});function or(t=ze){function e(o,a,N){return new f(_e(o,a,N))}function i(o,a){return new f(Hi(o,a))}let n=Object.assign(e,{fn:void 0,eb:void 0,selectFrom(o){return ke({queryId:p(),executor:t,queryNode:d.createFrom(re(o))})},selectNoFrom(o){return ke({queryId:p(),executor:t,queryNode:d.cloneWithSelections(d.create(),$(o))})},case(o){return new Ke({node:z.create(G(o)?void 0:M(o))})},ref(o,a){return G(a)?new f(Q(o)):new je(vi(o,a))},val(o){return new f(jt(o))},refTuple(...o){return new f(ni.create(o.map(M)))},tuple(...o){return new f(ni.create(o.map(v)))},lit(o){return new f(mt(o))},cmpr(o,a,N){return new f(_e(o,a,N))},bxp(o,a,N){return new f(_e(o,a,N))},unary:i,not(o){return i("not",o)},exists(o){return i("exists",o)},neg(o){return i("-",o)},between(o,a,N){return new f(ve.create(M(o),Y.create("between"),_.create(v(a),v(N))))},betweenSymmetric(o,a,N){return new f(ve.create(M(o),Y.create("between symmetric"),_.create(v(a),v(N))))},and(o){return L(o)?new f(Ht(o,"and")):new f(Mr(o,"and"))},or(o){return L(o)?new f(Ht(o,"or")):new f(Mr(o,"or"))},parens(...o){let a=g(o);return ue.is(a)?new f(a):new f(ue.create(a))},withSchema(o){return or(t.withPluginAtFront(new j(o)))}});return n.fn=ur(),n.eb=n,n}function U(t){return or()}function K(t){if(C(t))return t.toOperationNode();if(y(t))return t(U()).toOperationNode();throw new Error(`invalid expression: ${JSON.stringify(t)}`)}function Yt(t){if(C(t))return t.toOperationNode();if(y(t))return t(U()).toOperationNode();throw new Error(`invalid aliased expression: ${JSON.stringify(t)}`)}function se(t){return gi(t)||wi(t)||y(t)}function re(t){return L(t)?t.map(e=>we(e)):[we(t)]}function we(t){return k(t)?Mn(t):Yt(t)}function Mn(t){let e=" as ";if(t.includes(e)){let[i,n]=t.split(e).map(Zi);return q.create(b(i),u.create(n))}else return b(t)}function b(t){let e=".";if(t.includes(e)){let[i,n]=t.split(e).map(Zi);return J.createWithSchema(i,n)}else return J.create(t)}function Zi(t){return t.trim()}var oi=r({is(t){return t.kind==="AddColumnNode"},create(t){return r({kind:"AddColumnNode",column:t})}});var O=r({is(t){return t.kind==="ColumnDefinitionNode"},create(t,e){return r({kind:"ColumnDefinitionNode",column:m.create(t),dataType:e})},cloneWithFrontModifier(t,e){return r({...t,frontModifiers:t.frontModifiers?r([...t.frontModifiers,e]):[e]})},cloneWithEndModifier(t,e){return r({...t,endModifiers:t.endModifiers?r([...t.endModifiers,e]):[e]})},cloneWith(t,e){return r({...t,...e})}});var si=r({is(t){return t.kind==="DropColumnNode"},create(t){return r({kind:"DropColumnNode",column:m.create(t)})}});var ai=r({is(t){return t.kind==="RenameColumnNode"},create(t,e){return r({kind:"RenameColumnNode",column:m.create(t),renameTo:m.create(e)})}});var Ge=r({is(t){return t.kind==="CheckConstraintNode"},create(t,e){return r({kind:"CheckConstraintNode",expression:t,name:e?u.create(e):void 0})}});var Xi=["no action","restrict","cascade","set null","set default"],He=r({is(t){return t.kind==="ReferencesNode"},create(t,e){return r({kind:"ReferencesNode",table:t,columns:r([...e])})},cloneWithOnDelete(t,e){return r({...t,onDelete:e})},cloneWithOnUpdate(t,e){return r({...t,onUpdate:e})}});function cr(t){return C(t)?t.toOperationNode():E.createImmediate(t)}var Ct=r({is(t){return t.kind==="GeneratedNode"},create(t){return r({kind:"GeneratedNode",...t})},createWithExpression(t){return r({kind:"GeneratedNode",always:!0,expression:t})},cloneWith(t,e){return r({...t,...e})}});var en=r({is(t){return t.kind==="DefaultValueNode"},create(t){return r({kind:"DefaultValueNode",defaultValue:t})}});function Ye(t){if(Xi.includes(t))return t;throw new Error(`invalid OnModifyForeignAction ${t}`)}var ie=class t{#e;constructor(e){this.#e=e}autoIncrement(){return new t(O.cloneWith(this.#e,{autoIncrement:!0}))}primaryKey(){return new t(O.cloneWith(this.#e,{primaryKey:!0}))}references(e){let i=Q(e);if(!i.table||Le.is(i.column))throw new Error(`invalid call references('${e}'). The reference must have format table.column or schema.table.column`);return new t(O.cloneWith(this.#e,{references:He.create(i.table,[i.column])}))}onDelete(e){if(!this.#e.references)throw new Error("on delete constraint can only be added for foreign keys");return new t(O.cloneWith(this.#e,{references:He.cloneWithOnDelete(this.#e.references,Ye(e))}))}onUpdate(e){if(!this.#e.references)throw new Error("on update constraint can only be added for foreign keys");return new t(O.cloneWith(this.#e,{references:He.cloneWithOnUpdate(this.#e.references,Ye(e))}))}unique(){return new t(O.cloneWith(this.#e,{unique:!0}))}notNull(){return new t(O.cloneWith(this.#e,{notNull:!0}))}unsigned(){return new t(O.cloneWith(this.#e,{unsigned:!0}))}defaultTo(e){return new t(O.cloneWith(this.#e,{defaultTo:en.create(cr(e))}))}check(e){return new t(O.cloneWith(this.#e,{check:Ge.create(e.toOperationNode())}))}generatedAlwaysAs(e){return new t(O.cloneWith(this.#e,{generated:Ct.createWithExpression(e.toOperationNode())}))}generatedAlwaysAsIdentity(){return new t(O.cloneWith(this.#e,{generated:Ct.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new t(O.cloneWith(this.#e,{generated:Ct.create({identity:!0,byDefault:!0})}))}stored(){if(!this.#e.generated)throw new Error("stored() can only be called after generatedAlwaysAs");return new t(O.cloneWith(this.#e,{generated:Ct.cloneWith(this.#e.generated,{stored:!0})}))}modifyFront(e){return new t(O.cloneWithFrontModifier(this.#e,e.toOperationNode()))}modifyEnd(e){return new t(O.cloneWithEndModifier(this.#e,e.toOperationNode()))}$call(e){return e(this)}toOperationNode(){return this.#e}};s(ie,"don't await ColumnDefinitionBuilder instances directly.");var ui=r({is(t){return t.kind==="ModifyColumnNode"},create(t){return r({kind:"ModifyColumnNode",column:t})}});var tn=r({is(t){return t.kind==="DataTypeNode"},create(t){return r({kind:"DataTypeNode",dataType:t})}});function ce(t){return C(t)?t.toOperationNode():tn.create(t)}var Ee=r({is(t){return t.kind==="ForeignKeyConstraintNode"},create(t,e,i,n){return r({kind:"ForeignKeyConstraintNode",columns:t,references:He.create(e,i),name:n?u.create(n):void 0})},cloneWith(t,e){return r({...t,...e})}});var We=class t{#e;constructor(e){this.#e=e}onDelete(e){return new t(Ee.cloneWith(this.#e,{onDelete:Ye(e)}))}onUpdate(e){return new t(Ee.cloneWith(this.#e,{onUpdate:Ye(e)}))}$call(e){return e(this)}toOperationNode(){return this.#e}};s(We,"don't await ForeignKeyConstraintBuilder instances directly.");var Ze=r({is(t){return t.kind==="AddConstraintNode"},create(t){return r({kind:"AddConstraintNode",constraint:t})}});var mr=r({is(t){return t.kind==="UniqueConstraintNode"},create(t,e){return r({kind:"UniqueConstraintNode",columns:r(t.map(m.create)),name:e?u.create(e):void 0})}});var Xe=r({is(t){return t.kind==="DropConstraintNode"},create(t){return r({kind:"DropConstraintNode",constraintName:u.create(t)})},cloneWith(t,e){return r({...t,...e})}});var et=r({is(t){return t.kind==="AlterColumnNode"},create(t,e,i){return r({kind:"AlterColumnNode",column:m.create(t),[e]:i})}});var tt=class{#e;constructor(e){this.#e=e}setDataType(e){return new De(et.create(this.#e,"dataType",ce(e)))}setDefault(e){return new De(et.create(this.#e,"setDefault",cr(e)))}dropDefault(){return new De(et.create(this.#e,"dropDefault",!0))}setNotNull(){return new De(et.create(this.#e,"setNotNull",!0))}dropNotNull(){return new De(et.create(this.#e,"dropNotNull",!0))}$call(e){return e(this)}},De=class{#e;constructor(e){this.#e=e}toOperationNode(){return this.#e}};var me=class{#e;constructor(e){this.#e=r(e)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};s(me,"don't await AlterTableExecutor instances directly. To execute the query you need to call `execute`");var vt=class t{#e;constructor(e){this.#e=r(e)}onDelete(e){return new t({...this.#e,constraintBuilder:this.#e.constraintBuilder.onDelete(e)})}onUpdate(e){return new t({...this.#e,constraintBuilder:this.#e.constraintBuilder.onUpdate(e)})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(w.cloneWithTableProps(this.#e.node,{addConstraint:Ze.create(this.#e.constraintBuilder.toOperationNode())}),this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};s(vt,"don't await AlterTableAddForeignKeyConstraintBuilder instances directly. To execute the query you need to call `execute`");var Tt=class t{#e;constructor(e){this.#e=r(e)}ifExists(){return new t({...this.#e,node:w.cloneWithTableProps(this.#e.node,{dropConstraint:Xe.cloneWith(this.#e.node.dropConstraint,{ifExists:!0})})})}cascade(){return new t({...this.#e,node:w.cloneWithTableProps(this.#e.node,{dropConstraint:Xe.cloneWith(this.#e.node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new t({...this.#e,node:w.cloneWithTableProps(this.#e.node,{dropConstraint:Xe.cloneWith(this.#e.node.dropConstraint,{modifier:"restrict"})})})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};s(Tt,"don't await AlterTableDropConstraintBuilder instances directly. To execute the query you need to call `execute`");var pr=r({is(t){return t.kind==="PrimaryKeyConstraintNode"},create(t,e){return r({kind:"PrimaryKeyConstraintNode",columns:r(t.map(m.create)),name:e?u.create(e):void 0})}});var St=class{#e;constructor(e){this.#e=r(e)}renameTo(e){return new me({...this.#e,node:w.cloneWithTableProps(this.#e.node,{renameTo:b(e)})})}setSchema(e){return new me({...this.#e,node:w.cloneWithTableProps(this.#e.node,{setSchema:u.create(e)})})}alterColumn(e,i){let n=i(new tt(e));return new be({...this.#e,node:w.cloneWithColumnAlteration(this.#e.node,n.toOperationNode())})}dropColumn(e){return new be({...this.#e,node:w.cloneWithColumnAlteration(this.#e.node,si.create(e))})}renameColumn(e,i){return new be({...this.#e,node:w.cloneWithColumnAlteration(this.#e.node,ai.create(e,i))})}addColumn(e,i,n=le){let o=n(new ie(O.create(e,ce(i))));return new be({...this.#e,node:w.cloneWithColumnAlteration(this.#e.node,oi.create(o.toOperationNode()))})}modifyColumn(e,i,n=le){let o=n(new ie(O.create(e,ce(i))));return new be({...this.#e,node:w.cloneWithColumnAlteration(this.#e.node,ui.create(o.toOperationNode()))})}addUniqueConstraint(e,i){return new me({...this.#e,node:w.cloneWithTableProps(this.#e.node,{addConstraint:Ze.create(mr.create(i,e))})})}addCheckConstraint(e,i){return new me({...this.#e,node:w.cloneWithTableProps(this.#e.node,{addConstraint:Ze.create(Ge.create(i.toOperationNode(),e))})})}addForeignKeyConstraint(e,i,n,o){return new vt({...this.#e,constraintBuilder:new We(Ee.create(i.map(m.create),b(n),o.map(m.create),e))})}addPrimaryKeyConstraint(e,i){return new me({...this.#e,node:w.cloneWithTableProps(this.#e.node,{addConstraint:Ze.create(pr.create(i,e))})})}dropConstraint(e){return new Tt({...this.#e,node:w.cloneWithTableProps(this.#e.node,{dropConstraint:Xe.create(e)})})}$call(e){return e(this)}},be=class t{#e;constructor(e){this.#e=r(e)}alterColumn(e,i){let n=i(new tt(e));return new t({...this.#e,node:w.cloneWithColumnAlteration(this.#e.node,n.toOperationNode())})}dropColumn(e){return new t({...this.#e,node:w.cloneWithColumnAlteration(this.#e.node,si.create(e))})}renameColumn(e,i){return new t({...this.#e,node:w.cloneWithColumnAlteration(this.#e.node,ai.create(e,i))})}addColumn(e,i,n=le){let o=n(new ie(O.create(e,ce(i))));return new t({...this.#e,node:w.cloneWithColumnAlteration(this.#e.node,oi.create(o.toOperationNode()))})}modifyColumn(e,i,n=le){let o=n(new ie(O.create(e,ce(i))));return new t({...this.#e,node:w.cloneWithColumnAlteration(this.#e.node,ui.create(o.toOperationNode()))})}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};s(St,"don't await AlterTableBuilder instances");s(tt,"don't await AlterColumnBuilder instances");s(be,"don't await AlterTableColumnAlteringBuilder instances directly. To execute the query you need to call `execute`");var rt=class extends ge{transformValue(e){return{...super.transformValue(e),immediate:!0}}};var kt=class t{#e;constructor(e){this.#e=r(e)}ifNotExists(){return new t({...this.#e,node:Z.cloneWith(this.#e.node,{ifNotExists:!0})})}unique(){return new t({...this.#e,node:Z.cloneWith(this.#e.node,{unique:!0})})}on(e){return new t({...this.#e,node:Z.cloneWith(this.#e.node,{table:b(e)})})}column(e){return new t({...this.#e,node:Z.cloneWithColumns(this.#e.node,[Br(e)])})}columns(e){return new t({...this.#e,node:Z.cloneWithColumns(this.#e.node,e.map(Br))})}expression(e){return new t({...this.#e,node:Z.cloneWithColumns(this.#e.node,[e.toOperationNode()])})}using(e){return new t({...this.#e,node:Z.cloneWith(this.#e.node,{using:S.createWithSql(e)})})}where(...e){let i=new rt;return new t({...this.#e,node:c.cloneWithWhere(this.#e.node,i.transformNode(g(e)))})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};s(kt,"don't await CreateIndexBuilder instances directly. To execute the query you need to call `execute`");var It=class t{#e;constructor(e){this.#e=r(e)}ifNotExists(){return new t({...this.#e,node:Qt.cloneWith(this.#e.node,{ifNotExists:!0})})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};s(It,"don't await CreateSchemaBuilder instances directly. To execute the query you need to call `execute`");function rn(t){if(xi.includes(t))return t;throw new Error(`invalid OnCommitAction ${t}`)}var Et=class t{#e;constructor(e){this.#e=r(e)}temporary(){return new t({...this.#e,node:F.cloneWith(this.#e.node,{temporary:!0})})}onCommit(e){return new t({...this.#e,node:F.cloneWith(this.#e.node,{onCommit:rn(e)})})}ifNotExists(){return new t({...this.#e,node:F.cloneWith(this.#e.node,{ifNotExists:!0})})}addColumn(e,i,n=le){let o=n(new ie(O.create(e,ce(i))));return new t({...this.#e,node:F.cloneWithColumn(this.#e.node,o.toOperationNode())})}addPrimaryKeyConstraint(e,i){return new t({...this.#e,node:F.cloneWithConstraint(this.#e.node,pr.create(i,e))})}addUniqueConstraint(e,i){return new t({...this.#e,node:F.cloneWithConstraint(this.#e.node,mr.create(i,e))})}addCheckConstraint(e,i){return new t({...this.#e,node:F.cloneWithConstraint(this.#e.node,Ge.create(i.toOperationNode(),e))})}addForeignKeyConstraint(e,i,n,o,a=le){let N=a(new We(Ee.create(i.map(m.create),b(n),o.map(m.create),e)));return new t({...this.#e,node:F.cloneWithConstraint(this.#e.node,N.toOperationNode())})}modifyFront(e){return new t({...this.#e,node:F.cloneWithFrontModifier(this.#e.node,e.toOperationNode())})}modifyEnd(e){return new t({...this.#e,node:F.cloneWithEndModifier(this.#e.node,e.toOperationNode())})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};s(Et,"don't await CreateTableBuilder instances directly. To execute the query you need to call `execute`");var Wt=class t{#e;constructor(e){this.#e=r(e)}on(e){return new t({...this.#e,node:Re.cloneWith(this.#e.node,{table:b(e)})})}ifExists(){return new t({...this.#e,node:Re.cloneWith(this.#e.node,{ifExists:!0})})}cascade(){return new t({...this.#e,node:Re.cloneWith(this.#e.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};s(Wt,"don't await DropIndexBuilder instances directly. To execute the query you need to call `execute`");var Dt=class t{#e;constructor(e){this.#e=r(e)}ifExists(){return new t({...this.#e,node:at.cloneWith(this.#e.node,{ifExists:!0})})}cascade(){return new t({...this.#e,node:at.cloneWith(this.#e.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};s(Dt,"don't await DropSchemaBuilder instances directly. To execute the query you need to call `execute`");var At=class t{#e;constructor(e){this.#e=r(e)}ifExists(){return new t({...this.#e,node:ut.cloneWith(this.#e.node,{ifExists:!0})})}cascade(){return new t({...this.#e,node:ut.cloneWith(this.#e.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};s(At,"don't await DropTableBuilder instances directly. To execute the query you need to call `execute`");var ne=r({is(t){return t.kind==="CreateViewNode"},create(t){return r({kind:"CreateViewNode",name:P.create(t)})},cloneWith(t,e){return r({...t,...e})}});var hr=class{#e=new rt;transformQuery(e){return this.#e.transformNode(e.node)}transformResult(e){return Promise.resolve(e.result)}};var qt=class t{#e;constructor(e){this.#e=r(e)}temporary(){return new t({...this.#e,node:ne.cloneWith(this.#e.node,{temporary:!0})})}materialized(){return new t({...this.#e,node:ne.cloneWith(this.#e.node,{materialized:!0})})}ifNotExists(){return new t({...this.#e,node:ne.cloneWith(this.#e.node,{ifNotExists:!0})})}orReplace(){return new t({...this.#e,node:ne.cloneWith(this.#e.node,{orReplace:!0})})}columns(e){return new t({...this.#e,node:ne.cloneWith(this.#e.node,{columns:e.map(Lr)})})}as(e){let i=e.withPlugin(new hr).toOperationNode();return new t({...this.#e,node:ne.cloneWith(this.#e.node,{as:i})})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};s(qt,"don't await CreateViewBuilder instances directly. To execute the query you need to call `execute`");var it=r({is(t){return t.kind==="DropViewNode"},create(t){return r({kind:"DropViewNode",name:P.create(t)})},cloneWith(t,e){return r({...t,...e})}});var Rt=class t{#e;constructor(e){this.#e=r(e)}materialized(){return new t({...this.#e,node:it.cloneWith(this.#e.node,{materialized:!0})})}ifExists(){return new t({...this.#e,node:it.cloneWith(this.#e.node,{ifExists:!0})})}cascade(){return new t({...this.#e,node:it.cloneWith(this.#e.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};s(Rt,"don't await DropViewBuilder instances directly. To execute the query you need to call `execute`");var lr=r({is(t){return t.kind==="CreateTypeNode"},create(t){return r({kind:"CreateTypeNode",name:t})},cloneWithEnum(t,e){return r({...t,enum:Pe.create(e.map(i=>E.createImmediate(i)))})}});var Lt=class t{#e;constructor(e){this.#e=r(e)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}asEnum(e){return new t({...this.#e,node:lr.cloneWithEnum(this.#e.node,e)})}$call(e){return e(this)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};s(Lt,"don't await CreateTypeBuilder instances directly. To execute the query you need to call `execute`");var fr=r({is(t){return t.kind==="DropTypeNode"},create(t){return r({kind:"DropTypeNode",name:t})},cloneWith(t,e){return r({...t,...e})}});var Bt=class t{#e;constructor(e){this.#e=r(e)}ifExists(){return new t({...this.#e,node:fr.cloneWith(this.#e.node,{ifExists:!0})})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};s(Bt,"don't await DropTypeBuilder instances directly. To execute the query you need to call `execute`");function di(t){let e=".";if(t.includes(e)){let i=t.split(e).map(Fn);if(i.length===2)return P.createWithSchema(i[0],i[1]);throw new Error(`invalid schemable identifier ${t}`)}else return P.create(t)}function Fn(t){return t.trim()}var Nr=class t{#e;constructor(e){this.#e=e}createTable(e){return new Et({queryId:p(),executor:this.#e,node:F.create(b(e))})}dropTable(e){return new At({queryId:p(),executor:this.#e,node:ut.create(b(e))})}createIndex(e){return new kt({queryId:p(),executor:this.#e,node:Z.create(e)})}dropIndex(e){return new Wt({queryId:p(),executor:this.#e,node:Re.create(e)})}createSchema(e){return new It({queryId:p(),executor:this.#e,node:Qt.create(e)})}dropSchema(e){return new Dt({queryId:p(),executor:this.#e,node:at.create(e)})}alterTable(e){return new St({queryId:p(),executor:this.#e,node:w.create(b(e))})}createView(e){return new qt({queryId:p(),executor:this.#e,node:ne.create(e)})}dropView(e){return new Rt({queryId:p(),executor:this.#e,node:it.create(e)})}createType(e){return new Lt({queryId:p(),executor:this.#e,node:lr.create(di(e))})}dropType(e){return new Bt({queryId:p(),executor:this.#e,node:fr.create(di(e))})}withPlugin(e){return new t(this.#e.withPlugin(e))}withoutPlugins(){return new t(this.#e.withoutPlugins())}withSchema(e){return new t(this.#e.withPluginAtFront(new j(e)))}};var yr=class{ref(e){return new Ut(e)}};var xr=class{#e;constructor(e){this.#e=e}async provideConnection(e){let i=await this.#e.acquireConnection();try{return await e(i)}finally{await this.#e.releaseConnection(i)}}};var gr=class t extends Ve{#e;#t;#r;constructor(e,i,n,o=[]){super(o),this.#e=e,this.#t=i,this.#r=n}get adapter(){return this.#t}compileQuery(e){return this.#e.compileQuery(e)}provideConnection(e){return this.#r.provideConnection(e)}withPlugins(e){return new t(this.#e,this.#t,this.#r,[...this.plugins,...e])}withPlugin(e){return new t(this.#e,this.#t,this.#r,[...this.plugins,e])}withPluginAtFront(e){return new t(this.#e,this.#t,this.#r,[e,...this.plugins])}withConnectionProvider(e){return new t(this.#e,this.#t,e,[...this.plugins])}withoutPlugins(){return new t(this.#e,this.#t,this.#r,[])}};function ci(){return typeof performance<"u"&&y(performance.now)?performance.now():Date.now()}var wr=class{#e;#t;#r;#i;#n;#s=new WeakSet;constructor(e,i){this.#i=!1,this.#e=e,this.#t=i}async init(){if(this.#n)throw new Error("driver has already been destroyed");this.#r||(this.#r=this.#e.init().then(()=>{this.#i=!0}).catch(e=>(this.#r=void 0,Promise.reject(e)))),await this.#r}async acquireConnection(){if(this.#n)throw new Error("driver has already been destroyed");this.#i||await this.init();let e=await this.#e.acquireConnection();return this.#s.has(e)||(this.#o()&&this.#a(e),this.#s.add(e)),e}async releaseConnection(e){await this.#e.releaseConnection(e)}beginTransaction(e,i){return this.#e.beginTransaction(e,i)}commitTransaction(e){return this.#e.commitTransaction(e)}rollbackTransaction(e){return this.#e.rollbackTransaction(e)}async destroy(){this.#r&&(await this.#r,this.#n||(this.#n=this.#e.destroy().catch(e=>(this.#n=void 0,Promise.reject(e)))),await this.#n)}#o(){return this.#t.isLevelEnabled("query")||this.#t.isLevelEnabled("error")}#a(e){let i=e.executeQuery;e.executeQuery=async n=>{let o=ci();try{return await i.call(e,n)}catch(a){throw await this.#u(a,n,o),a}finally{await this.#c(n,o)}}}async#u(e,i,n){await this.#t.error(()=>({level:"error",error:e,query:i,queryDurationMillis:this.#d(n)}))}async#c(e,i){await this.#t.query(()=>({level:"query",query:e,queryDurationMillis:this.#d(i)}))}#d(e){return ci()-e}};var Pt=class{#e;#t;constructor(e){this.#e=e}async provideConnection(e){for(;this.#t;)await this.#t;let i=this.#r(e);return this.#t=i.then(()=>{this.#t=void 0}).catch(()=>{this.#t=void 0}),i}async#r(e){return await e(this.#e)}};var nn=["read uncommitted","read committed","repeatable read","serializable"];var Nx=r(["query","error"]),Or=class{#e;#t;constructor(e){y(e)?(this.#t=e,this.#e=r({query:!0,error:!0})):(this.#t=Qn,this.#e=r({query:e.includes("query"),error:e.includes("error")}))}isLevelEnabled(e){return this.#e[e]}async query(e){this.#e.query&&await this.#t(e())}async error(e){this.#e.error&&await this.#t(e())}};function Qn(t){t.level==="query"?(console.log(`kysely:query: ${t.query.sql}`),console.log(`kysely:query: duration: ${t.queryDurationMillis.toFixed(1)}ms`)):t.level==="error"&&(t.error instanceof Error?console.error(`kysely:error: ${t.error.stack??t.error.message}`):console.error(`kysely:error: ${t}`))}function on(t){return T(t)&&y(t.compile)}var br=class t extends Ue{#e;constructor(e){let i,n;if($n(e))i={executor:e.executor},n={...e};else{let o=e.dialect,a=o.createDriver(),N=o.createQueryCompiler(),I=o.createAdapter(),W=new Or(e.log??[]),Ae=new wr(a,W),Ir=new xr(Ae),_t=new gr(N,I,Ir,e.plugins??[]);i={executor:_t},n={config:e,executor:_t,dialect:o,driver:Ae}}super(i),this.#e=r(n)}get schema(){return new Nr(this.#e.executor)}get dynamic(){return new yr}get introspection(){return this.#e.dialect.createIntrospector(this.withoutPlugins())}case(e){return new Ke({node:z.create(G(e)?void 0:K(e))})}get fn(){return ur()}transaction(){return new vr({...this.#e})}connection(){return new Cr({...this.#e})}withPlugin(e){return new t({...this.#e,executor:this.#e.executor.withPlugin(e)})}withoutPlugins(){return new t({...this.#e,executor:this.#e.executor.withoutPlugins()})}withSchema(e){return new t({...this.#e,executor:this.#e.executor.withPluginAtFront(new j(e))})}withTables(){return new t({...this.#e})}async destroy(){await this.#e.driver.destroy()}get isTransaction(){return!1}getExecutor(){return this.#e.executor}executeQuery(e,i=p()){let n=on(e)?e.compile():e;return this.getExecutor().executeQuery(n,i)}},mi=class t extends br{#e;constructor(e){super(e),this.#e=e}get isTransaction(){return!0}transaction(){throw new Error("calling the transaction method for a Transaction is not supported")}connection(){throw new Error("calling the connection method for a Transaction is not supported")}async destroy(){throw new Error("calling the destroy method for a Transaction is not supported")}withPlugin(e){return new t({...this.#e,executor:this.#e.executor.withPlugin(e)})}withoutPlugins(){return new t({...this.#e,executor:this.#e.executor.withoutPlugins()})}withSchema(e){return new t({...this.#e,executor:this.#e.executor.withPluginAtFront(new j(e))})}withTables(){return new t({...this.#e})}};function $n(t){return T(t)&&T(t.config)&&T(t.driver)&&T(t.executor)&&T(t.dialect)}var Cr=class{#e;constructor(e){this.#e=r(e)}async execute(e){return this.#e.executor.provideConnection(async i=>{let n=this.#e.executor.withConnectionProvider(new Pt(i)),o=new br({...this.#e,executor:n});return await e(o)})}};s(Cr,"don't await ConnectionBuilder instances directly. To execute the query you need to call the `execute` method");var vr=class t{#e;constructor(e){this.#e=r(e)}setIsolationLevel(e){return new t({...this.#e,isolationLevel:e})}async execute(e){let{isolationLevel:i,...n}=this.#e,o={isolationLevel:i};return Un(o),this.#e.executor.provideConnection(async a=>{let N=this.#e.executor.withConnectionProvider(new Pt(a)),I=new mi({...n,executor:N});try{await this.#e.driver.beginTransaction(a,o);let W=await e(I);return await this.#e.driver.commitTransaction(a),W}catch(W){throw await this.#e.driver.rollbackTransaction(a),W}})}};s(vr,"don't await TransactionBuilder instances directly. To execute the transaction you need to call the `execute` method");function Un(t){if(t.isolationLevel&&!nn.includes(t.isolationLevel))throw new Error(`invalid transaction isolation level ${t.isolationLevel}`)}var Tr=class t{#e;constructor(e){this.#e=r(e)}get expressionType(){}get isRawBuilder(){return!0}as(e){return new Sr(this,e)}$castTo(){return new t({...this.#e})}withPlugin(e){return new t({...this.#e,plugins:this.#e.plugins!==void 0?r([...this.#e.plugins,e]):r([e])})}toOperationNode(){return this.#r(this.#t())}compile(e){return this.#i(this.#t(e))}async execute(e){let i=this.#t(e);return i.executeQuery(this.#i(i),this.#e.queryId)}#t(e){let i=e!==void 0?e.getExecutor():ze;return this.#e.plugins!==void 0?i.withPlugins(this.#e.plugins):i}#r(e){return e.transformQuery(this.#e.rawNode,this.#e.queryId)}#i(e){return e.compileQuery(this.#r(e),this.#e.queryId)}};function pe(t){return new Tr(t)}s(Tr,"don't await RawBuilder instances directly. To execute the query you need to call `execute`");var Sr=class{#e;#t;constructor(e,i){this.#e=e,this.#t=i}get expression(){return this.#e}get alias(){return this.#t}get rawBuilder(){return this.#e}toOperationNode(){return q.create(this.#e.toOperationNode(),C(this.#t)?this.#t.toOperationNode():u.create(this.#t))}};s(Sr,"don't await AliasedRawBuilder instances directly. AliasedRawBuilder should never be executed directly since it's always a part of another query.");var he=Object.assign((t,...e)=>pe({queryId:p(),rawNode:S.create(t,e?.map(v)??[])}),{ref(t){return pe({queryId:p(),rawNode:S.createWithChild(Q(t))})},val(t){return pe({queryId:p(),rawNode:S.createWithChild(v(t))})},value(t){return this.val(t)},table(t){return pe({queryId:p(),rawNode:S.createWithChild(b(t))})},id(...t){let e=new Array(t.length+1).fill(".");return e[0]="",e[e.length-1]="",pe({queryId:p(),rawNode:S.create(e,t.map(u.create))})},lit(t){return pe({queryId:p(),rawNode:S.createWithChild(E.createImmediate(t))})},literal(t){return this.lit(t)},raw(t){return pe({queryId:p(),rawNode:S.createWithSql(t)})},join(t,e=he`, `){let i=new Array(2*t.length-1),n=e.toOperationNode();for(let o=0;o<t.length;++o)i[2*o]=v(t[o]),o!==t.length-1&&(i[2*o+1]=n);return pe({queryId:p(),rawNode:S.createWithChildren(i)})}});var lg=r({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked",Distinct:"distinct"}),fg=r({ForKeyShare:1,ForNoKeyUpdate:1,ForUpdate:1,ForShare:1,NoWait:2,SkipLocked:2,Distinct:0}),Ng=r({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral"});var pi=r({raw(t,e=[]){return r({sql:t,query:S.createWithSql(t),parameters:r(e)})}});var Rg=r({__noMigrations__:!0});var nw=BigInt("3853314791062309107");function kr(t,e){if(zn(t)&&e.stack){let i=e.stack.split(`
`).slice(1).join(`
`);return t.stack+=`
${i}`,t}return t}function zn(t){return T(t)&&k(t.stack)}var Jn=Symbol();function Kn(t){return T(t)&&"insertId"in t&&"affectedRows"in t}var dn=class{#e;constructor(e){this.#e=e}async executeQuery(e){try{let i=await this.#t(e);if(Kn(i)){let{insertId:n,affectedRows:o,changedRows:a}=i,N=o!=null?BigInt(o):void 0,I=a!=null?BigInt(a):void 0;return{insertId:n!=null&&n.toString()!=="0"?BigInt(n):void 0,numUpdatedOrDeletedRows:N,numAffectedRows:N,numChangedRows:I,rows:[]}}else if(Array.isArray(i))return{rows:i};return{rows:[]}}catch(i){throw kr(i,new Error)}}#t(e){return new Promise((i,n)=>{this.#e.query(e.sql,e.parameters,(o,a)=>{o?n(o):i(a)})})}async*streamQuery(e,i){let n=this.#e.query(e.sql,e.parameters).stream({objectMode:!0});try{for await(let o of n)yield{rows:[o]}}catch(o){if(o&&typeof o=="object"&&"code"in o&&o.code==="ERR_STREAM_PREMATURE_CLOSE")return;throw o}}[Jn](){this.#e.release()}};var ww=60*60;var jn=Symbol();var cn=class{#e;#t;constructor(e,i){this.#e=e,this.#t=i}async executeQuery(e){try{let i=await this.#e.query(e.sql,[...e.parameters]);if(i.command==="INSERT"||i.command==="UPDATE"||i.command==="DELETE"){let n=BigInt(i.rowCount);return{numUpdatedOrDeletedRows:n,numAffectedRows:n,rows:i.rows??[]}}return{rows:i.rows??[]}}catch(i){throw kr(i,new Error)}}async*streamQuery(e,i){if(!this.#t.cursor)throw new Error("'cursor' is not present in your postgres dialect config. It's required to make streaming work in postgres.");if(!Number.isInteger(i)||i<=0)throw new Error("chunkSize must be a positive integer");let n=this.#e.query(new this.#t.cursor(e.sql,e.parameters.slice()));try{for(;;){let o=await n.read(i);if(o.length===0)break;yield{rows:o}}}finally{await n.close()}}[jn](){this.#e.release()}};var pO=r({is(t){return t.kind==="ListNode"},create(t){return r({kind:"ListNode",items:r(t)})}});var{Deno:pn}=globalThis,Jv=typeof pn?.noColor=="boolean"?pn.noColor:!1;var Kv=new RegExp(["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TXZcf-nq-uy=><~]))"].join("|"),"g");var DT=Intl.DateTimeFormat().resolvedOptions().timeZone;var AT={numeric:new Intl.DateTimeFormat("en-gb",{weekday:"long",month:"numeric",year:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZone:"Africa/Johannesburg"}),twoDigit:new Intl.DateTimeFormat("en-gb",{weekday:"long",month:"2-digit",year:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"Africa/Johannesburg"})};var qT=new Intl.DateTimeFormat("en-gb",{month:"long",day:"numeric",timeZone:"Africa/Johannesburg"}),RT=new Intl.DateTimeFormat("en-gb",{hour:"numeric",minute:"numeric",timeZone:"Africa/Johannesburg"});var hn=[["\xBC",.25],["\xBD",.5],["1",1],["2",2],["3",3],["4",4],["5",5],["6",6],["7",7],["8",8],["9",9],["10",10]],ln={ac:"before meals",am:"morning",bd:"2 times daily",nocte:"every night",od:"once a day",pm:"afternoon or evening",q15:"every 15 minutes",q30:"every 30 minutes",q1h:"every hour",q2h:"every 2 hours",q4h:"every 4 hours",q6h:"every 6 hours",q8h:"every 8 hours",qd:"every day",qid:"4 times a day",qod:"alternate days",qs:"sufficient enough quantity",mane:"morning",qmane:"every morning",qn:"every night",stat:"immediately, now",tds:"3 times a day",q24h:"every 24 hours",q30h:"every 30 hours",q48h:"every 48 hours",q72h:"every 72 hours",hs:"at bedtime  ",qhs:"daily at bedtime",qw:"once a week",bw:"twice a week",tw:"three times a week",qm:"once a month",bm:"twice a month",tm:"three times a month",prn:"when necessary"};function eo({name:t,value:e}){let[i,n]=oe(e?.drug||null),[o,a]=oe(e?.medication_id||null),[N,I]=oe(e?.manufactured_medication_id??null),[W,Ae]=oe(e?.strength??null),[Ir,_t]=oe(e?.intake_frequency??null),[hi,li]=oe(e?.dosage??null),[fn,Nn]=oe(e?.route??null),[to,ro]=oe(e?[e.drug]:[]),h=i?.medications.find(l=>l.medication_id===o),yn=h?.manufacturers.find(l=>l.manufactured_medication_id===N)?.strength_numerators||h?.strength_numerators,nt=h?.strength_denominator_unit,fi=h?.strength_denominator_is_units,xn=nt&&(fi?nt:nt==="SUPPOSITORY"?"SUPPOSITORIES":nt+"S");return Mt(()=>{i&&(o||i.medications.length===1&&a(i.medications[0].medication_id))},[i]),Mt(()=>{h&&(W||h.strength_numerators.length===1&&Ae(h.strength_numerators[0]))},[h]),Mt(()=>{h&&W&&(hi||li(h.strength_denominator))},[h,W]),x("div",{className:"w-full justify-normal",children:[x(Ft,{className:"w-full justify-normal",children:[x(yi,{name:t,selectedDrug:i,setSelectedDrug:n,clearSelected:()=>{n(null),a(null),Ae(null),li(null),_t(null)}}),x(qe,{name:`${t}.medication_id`,required:!0,label:"Form",disabled:!i,onChange:l=>l.currentTarget.value&&a(Number(l.currentTarget.value)),children:[x("option",{value:"",children:"Select Form"}),i&&i.medications.map(l=>x("option",{value:l.medication_id,selected:o===l.medication_id,children:l.form_route}))]}),h&&h.routes.length>1&&x(qe,{name:`${t}.route`,required:!0,label:"Route",disabled:!i,onChange:l=>l.currentTarget.value&&Nn(l.currentTarget.value),children:[x("option",{value:"",children:"Select Form"}),h.routes.map(l=>x("option",{value:l,selected:fn===l,children:l}))]}),h&&h.routes.length===1&&x("input",{name:`${t}.route`,type:"hidden",value:h.routes[0]}),x("input",{type:"hidden",className:"hidden",name:`${t}.manufactured_medication_id`,value:N||""}),x(qe,{name:`${t}.strength`,required:!0,label:"Strength",disabled:!h,onChange:l=>l.currentTarget.value&&Ae(Number(l.currentTarget.value)),children:[x("option",{value:"",children:"Select Strength"}),h&&yn?.map(l=>x("option",{value:l,selected:W===l,children:[l,h.strength_numerator_unit,"/",h.strength_denominator===1?"":h.strength_denominator,h.strength_denominator_unit]}))]})]}),x(Ft,{className:"w-full justify-normal",children:[x(qe,{name:`${t}.dosage`,label:"Dosage",disabled:!(h&&W),children:[x("option",{value:"",children:"Select Dosage"}),h&&W&&hn.map(([l,Ce])=>x("option",{value:Ce*h.strength_denominator,selected:hi===Ce*h.strength_denominator,children:[h.strength_denominator===1?l:Ce*h.strength_denominator,fi?"":" ",Ce>1?xn:nt," ","(",W*Ce,h?.strength_numerator_unit,")"]}))]}),x(qe,{name:`${t}.intake_frequency`,required:!0,label:"Frequency",disabled:!i,children:[x("option",{value:"",children:"Select Intake"}),i&&Object.entries(ln).map(([l,Ce])=>x("option",{value:l,selected:Ir===l,children:Ce}))]}),x(Er,{name:`${t}.start_date`,label:"Start Date",required:!0,value:e?.start_date}),x(Er,{name:`${t}.end_date`,label:"End Date",value:e?.end_date})]}),x(Ft,{children:x(Ni,{name:`${t}.special_instructions`,className:"w-full",label:"Special Instructions",value:e?.special_instructions})})]})}export{eo as a};
