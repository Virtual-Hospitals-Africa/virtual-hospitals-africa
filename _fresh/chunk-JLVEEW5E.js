import{a as Ai}from"./chunk-5OLI6NVV.js";import{a as jt}from"./chunk-AAS3MA3C.js";import{c as ki,d as Qe,e as Br}from"./chunk-5D2L5IOQ.js";import{a as ue,b as Kt}from"./chunk-DZI5S33S.js";import{a as w}from"./chunk-D7WMKMTL.js";function $(t){return typeof t>"u"||t===void 0}function C(t){return typeof t=="string"}function $e(t){return typeof t=="number"}function ke(t){return typeof t=="boolean"}function Ae(t){return t===null}function Mr(t){return t instanceof Date}function Fr(t){return typeof t=="bigint"}function Di(t){return typeof Buffer<"u"&&Buffer.isBuffer(t)}function x(t){return typeof t=="function"}function E(t){return typeof t=="object"&&t!==null}function r(t){return Object.freeze(t)}function L(t){return Array.isArray(t)}function X(t){return t}var l=r({is(t){return t.kind==="AlterTableNode"},create(t){return r({kind:"AlterTableNode",table:t})},cloneWithTableProps(t,e){return r({...t,...e})},cloneWithColumnAlteration(t,e){return r({...t,columnAlterations:t.columnAlterations?[...t.columnAlterations,e]:[e]})}});var u=r({is(t){return t.kind==="IdentifierNode"},create(t){return r({kind:"IdentifierNode",name:t})}});var H=r({is(t){return t.kind==="CreateIndexNode"},create(t){return r({kind:"CreateIndexNode",name:u.create(t)})},cloneWith(t,e){return r({...t,...e})},cloneWithColumns(t,e){return r({...t,columns:[...t.columns||[],...e]})}});var Gt=r({is(t){return t.kind==="CreateSchemaNode"},create(t,e){return r({kind:"CreateSchemaNode",schema:u.create(t),...e})},cloneWith(t,e){return r({...t,...e})}});var Wi=["preserve rows","delete rows","drop"],P=r({is(t){return t.kind==="CreateTableNode"},create(t){return r({kind:"CreateTableNode",table:t,columns:r([])})},cloneWithColumn(t,e){return r({...t,columns:r([...t.columns,e])})},cloneWithConstraint(t,e){return r({...t,constraints:t.constraints?r([...t.constraints,e]):r([e])})},cloneWithFrontModifier(t,e){return r({...t,frontModifiers:t.frontModifiers?r([...t.frontModifiers,e]):r([e])})},cloneWithEndModifier(t,e){return r({...t,endModifiers:t.endModifiers?r([...t.endModifiers,e]):r([e])})},cloneWith(t,e){return r({...t,...e})}});var M=r({is(t){return t.kind==="SchemableIdentifierNode"},create(t){return r({kind:"SchemableIdentifierNode",identifier:u.create(t)})},createWithSchema(t,e){return r({kind:"SchemableIdentifierNode",schema:u.create(t),identifier:u.create(e)})}});var ye=r({is(t){return t.kind==="DropIndexNode"},create(t,e){return r({kind:"DropIndexNode",name:M.create(t),...e})},cloneWith(t,e){return r({...t,...e})}});var ht=r({is(t){return t.kind==="DropSchemaNode"},create(t,e){return r({kind:"DropSchemaNode",schema:u.create(t),...e})},cloneWith(t,e){return r({...t,...e})}});var ft=r({is(t){return t.kind==="DropTableNode"},create(t,e){return r({kind:"DropTableNode",table:t,...e})},cloneWith(t,e){return r({...t,...e})}});var q=r({is(t){return t.kind==="AliasNode"},create(t,e){return r({kind:"AliasNode",node:t,alias:e})}});var K=r({is(t){return t.kind==="TableNode"},create(t){return r({kind:"TableNode",table:M.create(t)})},createWithSchema(t,e){return r({kind:"TableNode",table:M.createWithSchema(t,e)})}});function I(t){return E(t)&&x(t.toOperationNode)}function qi(t){return E(t)&&"expressionType"in t&&I(t)}function _i(t){return E(t)&&"expression"in t&&C(t.alias)&&I(t)}var ee=r({is(t){return t.kind==="SelectModifierNode"},create(t){return r({kind:"SelectModifierNode",modifier:t})},createWithExpression(t){return r({kind:"SelectModifierNode",rawModifier:t})}});var F=r({is(t){return t.kind==="AndNode"},create(t,e){return r({kind:"AndNode",left:t,right:e})}});var Y=r({is(t){return t.kind==="OrNode"},create(t,e){return r({kind:"OrNode",left:t,right:e})}});var Ht=r({is(t){return t.kind==="OnNode"},create(t){return r({kind:"OnNode",on:t})},cloneWithOperation(t,e,i){return r({...t,on:e==="And"?F.create(t.on,i):Y.create(t.on,i)})}});var Ne=r({is(t){return t.kind==="JoinNode"},create(t,e){return r({kind:"JoinNode",joinType:t,table:e,on:void 0})},createWithOn(t,e,i){return r({kind:"JoinNode",joinType:t,table:e,on:Ht.create(i)})},cloneWithOn(t,e){return r({...t,on:t.on?Ht.cloneWithOperation(t.on,"And",e):Ht.create(e)})}});var xe=r({is(t){return t.kind==="BinaryOperationNode"},create(t,e,i){return r({kind:"BinaryOperationNode",leftOperand:t,operator:e,rightOperand:i})}});var kn=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","&&","?","?&","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->","regexp","is distinct from","is not distinct from"],An=["+","-","*","/","%","^","&","|","#","<<",">>"],Ri=["->","->>"],Dn=[...kn,...An,"&&","||"],Wn=["exists","not exists"],qn=["not","-",...Wn],Li=[...Dn,...Ri,...qn,"between","between symmetric"],j=r({is(t){return t.kind==="OperatorNode"},create(t){return r({kind:"OperatorNode",operator:t})}});function Qr(t){return C(t)&&Ri.includes(t)}var m=r({is(t){return t.kind==="ColumnNode"},create(t){return r({kind:"ColumnNode",column:u.create(t)})}});var Ue=r({is(t){return t.kind==="SelectAllNode"},create(){return r({kind:"SelectAllNode"})}});var Ve=r({is(t){return t.kind==="ReferenceNode"},create(t,e){return r({kind:"ReferenceNode",table:e,column:t})},createSelectAll(t){return r({kind:"ReferenceNode",table:t,column:Ue.create()})}});var Yt=class{#e;get dynamicReference(){return this.#e}get refType(){}constructor(e){this.#e=e}toOperationNode(){return $r(this.#e)}};function Zt(t){return E(t)&&I(t)&&C(t.dynamicReference)}var Xt=r({is(t){return t.kind==="OrderByItemNode"},create(t,e){return r({kind:"OrderByItemNode",orderBy:t,direction:e})}});var v=r({is(t){return t.kind==="RawNode"},create(t,e){return r({kind:"RawNode",sqlFragments:r(t),parameters:r(e)})},createWithSql(t){return v.create([t],[])},createWithChild(t){return v.create(["",""],[t])},createWithChildren(t){return v.create(new Array(t.length+1).fill(""),t)}});function Vr(t){return t==="asc"||t==="desc"}function we(t){if(t.length===2)return[Ur(t[0],t[1])];if(t.length===1){let[e]=t;return Array.isArray(e)?e.map(i=>Ur(i)):[Ur(e)]}throw new Error(`Invalid number of arguments at order by! expected 1-2, received ${t.length}`)}function Ur(t,e){let i=_n(t);if(Xt.is(i)){if(e)throw new Error("Cannot specify direction twice!");return i}return Xt.create(i,Pi(e))}function _n(t){if(de(t))return Q(t);if(Zt(t))return t.toOperationNode();let[e,i]=t.split(" ");if(i){if(!Vr(i))throw new Error(`Invalid order by direction: ${i}`);return Xt.create(U(e),Pi(i))}return U(t)}function Pi(t){if(t)return t==="asc"||t==="desc"?v.createWithSql(t):t.toOperationNode()}var ze=r({is(t){return t.kind==="JSONReferenceNode"},create(t,e){return r({kind:"JSONReferenceNode",reference:t,traversal:e})},cloneWithTraversal(t,e){return r({...t,traversal:e})}});var er=r({is(t){return t.kind==="JSONOperatorChainNode"},create(t){return r({kind:"JSONOperatorChainNode",operator:t,values:r([])})},cloneWithValue(t,e){return r({...t,values:r([...t.values,e])})}});var ge=r({is(t){return t.kind==="JSONPathNode"},create(t){return r({kind:"JSONPathNode",inOperator:t,pathLegs:r([])})},cloneWithLeg(t,e){return r({...t,pathLegs:r([...t.pathLegs,e])})}});function $r(t){return C(t)?U(t):t.toOperationNode()}function ce(t){return L(t)?t.map(e=>_(e)):[_(t)]}function _(t){return de(t)?Q(t):$r(t)}function Bi(t,e){let i=U(t);if(Qr(e))return ze.create(i,er.create(j.create(e)));let n=e.slice(0,-1);if(Qr(n))return ze.create(i,ge.create(j.create(n)));throw new Error(`Invalid JSON operator: ${e}`)}function U(t){let e=".";if(!t.includes(e))return Ve.create(m.create(t));let i=t.split(e).map(Jr);if(i.length===3)return Rn(i);if(i.length===2)return Ln(i);throw new Error(`invalid column reference ${t}`)}function Mi(t){let e=" as ";if(t.includes(e)){let[i,n]=t.split(e).map(Jr);return q.create(U(i),u.create(n))}else return U(t)}function zr(t){return m.create(t)}function Je(t){let e=" ";if(t.includes(e)){let[i,n]=t.split(e).map(Jr);if(!Vr(n))throw new Error(`invalid order direction "${n}" next to "${i}"`);return we([i,n])[0]}else return zr(t)}function Rn(t){let[e,i,n]=t;return Ve.create(m.create(n),K.createWithSchema(e,i))}function Ln(t){let[e,i]=t;return Ve.create(m.create(i),K.create(e))}function Jr(t){return t.trim()}var tr=r({is(t){return t.kind==="PrimitiveValueListNode"},create(t){return r({kind:"PrimitiveValueListNode",values:r([...t])})}});var Ke=r({is(t){return t.kind==="ValueListNode"},create(t){return r({kind:"ValueListNode",values:r(t)})}});var k=r({is(t){return t.kind==="ValueNode"},create(t){return r({kind:"ValueNode",value:t})},createImmediate(t){return r({kind:"ValueNode",value:t,immediate:!0})}});function Fi(t){return L(t)?Pn(t):T(t)}function T(t){return de(t)?Q(t):k.create(t)}function rr(t){return $e(t)||ke(t)||Ae(t)}function yt(t){if(!rr(t))throw new Error(`unsafe immediate value ${JSON.stringify(t)}`);return k.createImmediate(t)}function Pn(t){return t.some(de)?Ke.create(t.map(e=>T(e))):tr.create(t)}var me=r({is(t){return t.kind==="ParensNode"},create(t){return r({kind:"ParensNode",node:t})}});function b(t){if(t.length===3)return ir(t[0],t[1],t[2]);if(t.length===1)return T(t[0]);throw new Error(`invalid arguments: ${JSON.stringify(t)}`)}function ir(t,e,i){return Bn(e)&&$i(i)?xe.create(_(t),Kr(e),k.createImmediate(i)):xe.create(_(t),Kr(e),Fi(i))}function R(t,e,i){return xe.create(_(t),Kr(e),_(i))}function jr(t,e){return nr(Object.entries(t).filter(([,i])=>!$(i)).map(([i,n])=>ir(i,$i(n)?"is":"=",n)),e)}function nr(t,e){let i=e==="and"?F.create:Y.create;if(t.length===0)return xe.create(k.createImmediate(1),j.create("="),k.createImmediate(e==="and"?1:0));let n=Qi(t[0]);for(let o=1;o<t.length;++o)n=i(n,Qi(t[o]));return t.length>1?me.create(n):n}function Bn(t){return t==="is"||t==="is not"}function $i(t){return Ae(t)||ke(t)}function Kr(t){if(C(t)&&Li.includes(t))return j.create(t);if(I(t))return t.toOperationNode();throw new Error(`invalid operator ${JSON.stringify(t)}`)}function Qi(t){return I(t)?t.toOperationNode():t}var pe=r({is(t){return t.kind==="OrderByNode"},create(t){return r({kind:"OrderByNode",items:r([...t])})},cloneWithItems(t,e){return r({...t,items:r([...t.items,...e])})}});var Gr=r({is(t){return t.kind==="PartitionByNode"},create(t){return r({kind:"PartitionByNode",items:r(t)})},cloneWithItems(t,e){return r({...t,items:r([...t.items,...e])})}});var Nt=r({is(t){return t.kind==="OverNode"},create(){return r({kind:"OverNode"})},cloneWithOrderByItems(t,e){return r({...t,orderBy:t.orderBy?pe.cloneWithItems(t.orderBy,e):pe.create(e)})},cloneWithPartitionByItems(t,e){return r({...t,partitionBy:t.partitionBy?Gr.cloneWithItems(t.partitionBy,e):Gr.create(e)})}});var De=r({is(t){return t.kind==="FromNode"},create(t){return r({kind:"FromNode",froms:r(t)})},cloneWithFroms(t,e){return r({...t,froms:r([...t.froms,...e])})}});var Hr=r({is(t){return t.kind==="GroupByNode"},create(t){return r({kind:"GroupByNode",items:r(t)})},cloneWithItems(t,e){return r({...t,items:r([...t.items,...e])})}});var Yr=r({is(t){return t.kind==="HavingNode"},create(t){return r({kind:"HavingNode",having:t})},cloneWithOperation(t,e,i){return r({...t,having:e==="And"?F.create(t.having,i):Y.create(t.having,i)})}});var c=r({is(t){return t.kind==="SelectQueryNode"},create(t){return r({kind:"SelectQueryNode",...t&&{with:t}})},createFrom(t,e){return r({kind:"SelectQueryNode",from:De.create(t),...e&&{with:e}})},cloneWithSelections(t,e){return r({...t,selections:t.selections?r([...t.selections,...e]):r(e)})},cloneWithDistinctOn(t,e){return r({...t,distinctOn:t.distinctOn?r([...t.distinctOn,...e]):r(e)})},cloneWithFrontModifier(t,e){return r({...t,frontModifiers:t.frontModifiers?r([...t.frontModifiers,e]):r([e])})},cloneWithEndModifier(t,e){return r({...t,endModifiers:t.endModifiers?r([...t.endModifiers,e]):r([e])})},cloneWithOrderByItems(t,e){return r({...t,orderBy:t.orderBy?pe.cloneWithItems(t.orderBy,e):pe.create(e)})},cloneWithGroupByItems(t,e){return r({...t,groupBy:t.groupBy?Hr.cloneWithItems(t.groupBy,e):Hr.create(e)})},cloneWithLimit(t,e){return r({...t,limit:e})},cloneWithOffset(t,e){return r({...t,offset:e})},cloneWithHaving(t,e){return r({...t,having:t.having?Yr.cloneWithOperation(t.having,"And",e):Yr.create(e)})},cloneWithSetOperations(t,e){return r({...t,setOperations:t.setOperations?r([...t.setOperations,...e]):r([...e])})},cloneWithoutSelections(t){return r({...t,selections:[]})},cloneWithoutLimit(t){return r({...t,limit:void 0})},cloneWithoutOffset(t){return r({...t,offset:void 0})},cloneWithoutOrderBy(t){return r({...t,orderBy:void 0})}});function s(t,e){Object.defineProperties(t.prototype,{then:{enumerable:!1,value:()=>{throw new Error(e)}}})}var xt=class t{#e;constructor(e){this.#e=r(e)}on(...e){return new t({...this.#e,joinNode:Ne.cloneWithOn(this.#e.joinNode,b(e))})}onRef(e,i,n){return new t({...this.#e,joinNode:Ne.cloneWithOn(this.#e.joinNode,R(e,i,n))})}onTrue(){return new t({...this.#e,joinNode:Ne.cloneWithOn(this.#e.joinNode,v.createWithSql("true"))})}$call(e){return e(this)}toOperationNode(){return this.#e.joinNode}};s(xt,"don't await JoinBuilder instances. They are never executed directly and are always just a part of a query.");var Ui=r({is(t){return t.kind==="PartitionByItemNode"},create(t){return r({kind:"PartitionByItemNode",partitionBy:t})}});function Vi(t){return ce(t).map(Ui.create)}var wt=class t{#e;constructor(e){this.#e=r(e)}orderBy(e,i){return new t({overNode:Nt.cloneWithOrderByItems(this.#e.overNode,we([e,i]))})}partitionBy(e){return new t({overNode:Nt.cloneWithPartitionByItems(this.#e.overNode,Vi(e))})}$call(e){return e(this)}toOperationNode(){return this.#e.overNode}};s(wt,"don't await OverBuilder instances. They are never executed directly and are always just a part of a query.");var je=r({is(t){return t.kind==="SelectionNode"},create(t){return r({kind:"SelectionNode",selection:t})},createSelectAll(){return r({kind:"SelectionNode",selection:Ue.create()})},createSelectAllFromTable(t){return r({kind:"SelectionNode",selection:Ve.createSelectAll(t)})}});function Z(t){return x(t)?Z(t(V())):L(t)?t.map(e=>zi(e)):[zi(t)]}function zi(t){return C(t)?je.create(Mi(t)):Zt(t)?je.create(t.toOperationNode()):je.create(or(t))}function te(t){return t?Array.isArray(t)?t.map(Ji):[Ji(t)]:[je.createSelectAll()]}function Ji(t){if(C(t))return je.createSelectAllFromTable(g(t));throw new Error(`invalid value selectAll expression: ${JSON.stringify(t)}`)}var Ki=r({is(t){return t.kind==="ValuesNode"},create(t){return r({kind:"ValuesNode",values:r(t)})}});var ji=r({is(t){return t.kind==="DefaultInsertValueNode"},create(){return r({kind:"DefaultInsertValueNode"})}});function Gi(t){let e=x(t)?t(V()):t,i=L(e)?e:r([e]);return Mn(i)}function Mn(t){let e=Fn(t);return[r([...e.keys()].map(m.create)),Ki.create(t.map(i=>Qn(i,e)))]}function Fn(t){let e=new Map;for(let i of t){let n=Object.keys(i);for(let o of n)!e.has(o)&&i[o]!==void 0&&e.set(o,e.size)}return e}function Qn(t,e){let i=Object.keys(t),n=Array.from({length:e.size}),o=!1;for(let p of i){let S=e.get(p);if($(S))continue;let A=t[p];($(A)||de(A))&&(o=!0),n[S]=A}if(i.length<e.size||o){let p=ji.create();return Ke.create(n.map(S=>$(S)?p:T(S)))}return tr.create(n)}var z=r({is(t){return t.kind==="InsertQueryNode"},create(t,e,i){return r({kind:"InsertQueryNode",into:t,...e&&{with:e},replace:i})},cloneWith(t,e){return r({...t,...e})}});var We=r({is(t){return t.kind==="UpdateQueryNode"},create(t,e){return r({kind:"UpdateQueryNode",table:t,...e&&{with:e}})},cloneWithFromItems(t,e){return r({...t,from:t.from?De.cloneWithFroms(t.from,e):De.create(e)})},cloneWithUpdates(t,e){return r({...t,updates:t.updates?r([...t.updates,...e]):e})}});var Zr=r({is(t){return t.kind==="UsingNode"},create(t){return r({kind:"UsingNode",tables:r(t)})},cloneWithTables(t,e){return r({...t,tables:r([...t.tables,...e])})}});var be=r({is(t){return t.kind==="DeleteQueryNode"},create(t,e){return r({kind:"DeleteQueryNode",from:De.create(t),...e&&{with:e}})},cloneWithOrderByItems(t,e){return r({...t,orderBy:t.orderBy?pe.cloneWithItems(t.orderBy,e):pe.create(e)})},cloneWithLimit(t,e){return r({...t,limit:e})},cloneWithUsing(t,e){return r({...t,using:t.using!==void 0?Zr.cloneWithTables(t.using,e):Zr.create(e)})}});var D=r({is(t){return t.kind==="WhereNode"},create(t){return r({kind:"WhereNode",where:t})},cloneWithOperation(t,e,i){return r({...t,where:e==="And"?F.create(t.where,i):Y.create(t.where,i)})}});var Xr=r({is(t){return t.kind==="ReturningNode"},create(t){return r({kind:"ReturningNode",selections:r(t)})},cloneWithSelections(t,e){return r({...t,selections:t.selections?r([...t.selections,...e]):r(e)})}});var Hi=r({is(t){return t.kind==="ExplainNode"},create(t,e){return r({kind:"ExplainNode",format:t,options:e})}});var d=r({is(t){return c.is(t)||z.is(t)||We.is(t)||be.is(t)},cloneWithWhere(t,e){return r({...t,where:t.where?D.cloneWithOperation(t.where,"And",e):D.create(e)})},cloneWithJoin(t,e){return r({...t,joins:t.joins?r([...t.joins,e]):r([e])})},cloneWithReturning(t,e){return r({...t,returning:t.returning?Xr.cloneWithSelections(t.returning,e):Xr.create(e)})},cloneWithoutWhere(t){return r({...t,where:void 0})},cloneWithExplain(t,e,i){return r({...t,explain:Hi.create(e,i?.toOperationNode())})}});var ei=r({is(t){return t.kind==="ColumnUpdateNode"},create(t,e){return r({kind:"ColumnUpdateNode",column:t,value:e})}});function Yi(...t){return t.length===2?[ei.create(_(t[0]),T(t[1]))]:gt(t[0])}function gt(t){let e=x(t)?t(V()):t;return Object.entries(e).filter(([i,n])=>n!==void 0).map(([i,n])=>ei.create(m.create(i),T(n)))}var Zi=r({is(t){return t.kind==="OnDuplicateKeyNode"},create(t){return r({kind:"OnDuplicateKeyNode",updates:t})}});var sr=class{insertId;numInsertedOrUpdatedRows;constructor(e,i){this.insertId=e,this.numInsertedOrUpdatedRows=i}};var re=class extends Error{node;constructor(e){super("no result"),this.node=e}};function Oe(t){return Object.prototype.hasOwnProperty.call(t,"prototype")}var B=r({is(t){return t.kind==="OnConflictNode"},create(){return r({kind:"OnConflictNode"})},cloneWith(t,e){return r({...t,...e})},cloneWithIndexWhere(t,e){return r({...t,indexWhere:t.indexWhere?D.cloneWithOperation(t.indexWhere,"And",e):D.create(e)})},cloneWithIndexOrWhere(t,e){return r({...t,indexWhere:t.indexWhere?D.cloneWithOperation(t.indexWhere,"Or",e):D.create(e)})},cloneWithUpdateWhere(t,e){return r({...t,updateWhere:t.updateWhere?D.cloneWithOperation(t.updateWhere,"And",e):D.create(e)})},cloneWithUpdateOrWhere(t,e){return r({...t,updateWhere:t.updateWhere?D.cloneWithOperation(t.updateWhere,"Or",e):D.create(e)})},cloneWithoutIndexWhere(t){return r({...t,indexWhere:void 0})},cloneWithoutUpdateWhere(t){return r({...t,updateWhere:void 0})}});var bt=class t{#e;constructor(e){this.#e=r(e)}column(e){let i=m.create(e);return new t({...this.#e,onConflictNode:B.cloneWith(this.#e.onConflictNode,{columns:this.#e.onConflictNode.columns?r([...this.#e.onConflictNode.columns,i]):r([i])})})}columns(e){let i=e.map(m.create);return new t({...this.#e,onConflictNode:B.cloneWith(this.#e.onConflictNode,{columns:this.#e.onConflictNode.columns?r([...this.#e.onConflictNode.columns,...i]):r(i)})})}constraint(e){return new t({...this.#e,onConflictNode:B.cloneWith(this.#e.onConflictNode,{constraint:u.create(e)})})}expression(e){return new t({...this.#e,onConflictNode:B.cloneWith(this.#e.onConflictNode,{indexExpression:e.toOperationNode()})})}where(...e){return new t({...this.#e,onConflictNode:B.cloneWithIndexWhere(this.#e.onConflictNode,b(e))})}whereRef(e,i,n){return new t({...this.#e,onConflictNode:B.cloneWithIndexWhere(this.#e.onConflictNode,R(e,i,n))})}clearWhere(){return new t({...this.#e,onConflictNode:B.cloneWithoutIndexWhere(this.#e.onConflictNode)})}doNothing(){return new ar({...this.#e,onConflictNode:B.cloneWith(this.#e.onConflictNode,{doNothing:!0})})}doUpdateSet(e){return new ur({...this.#e,onConflictNode:B.cloneWith(this.#e.onConflictNode,{updates:gt(e)})})}$call(e){return e(this)}};s(bt,"don't await OnConflictBuilder instances.");var ar=class{#e;constructor(e){this.#e=r(e)}toOperationNode(){return this.#e.onConflictNode}};s(ar,"don't await OnConflictDoNothingBuilder instances.");var ur=class t{#e;constructor(e){this.#e=r(e)}where(...e){return new t({...this.#e,onConflictNode:B.cloneWithUpdateWhere(this.#e.onConflictNode,b(e))})}whereRef(e,i,n){return new t({...this.#e,onConflictNode:B.cloneWithUpdateWhere(this.#e.onConflictNode,R(e,i,n))})}clearWhere(){return new t({...this.#e,onConflictNode:B.cloneWithoutUpdateWhere(this.#e.onConflictNode)})}$call(e){return e(this)}toOperationNode(){return this.#e.onConflictNode}};s(ur,"don't await OnConflictUpdateBuilder instances.");var Ge=class t{#e;constructor(e){this.#e=r(e)}values(e){let[i,n]=Gi(e);return new t({...this.#e,queryNode:z.cloneWith(this.#e.queryNode,{columns:i,values:n})})}columns(e){return new t({...this.#e,queryNode:z.cloneWith(this.#e.queryNode,{columns:r(e.map(m.create))})})}expression(e){return new t({...this.#e,queryNode:z.cloneWith(this.#e.queryNode,{values:Q(e)})})}ignore(){return new t({...this.#e,queryNode:z.cloneWith(this.#e.queryNode,{ignore:!0})})}onConflict(e){return new t({...this.#e,queryNode:z.cloneWith(this.#e.queryNode,{onConflict:e(new bt({onConflictNode:B.create()})).toOperationNode()})})}onDuplicateKeyUpdate(e){return new t({...this.#e,queryNode:z.cloneWith(this.#e.queryNode,{onDuplicateKey:Zi.create(gt(e))})})}returning(e){return new t({...this.#e,queryNode:d.cloneWithReturning(this.#e.queryNode,Z(e))})}returningAll(){return new t({...this.#e,queryNode:d.cloneWithReturning(this.#e.queryNode,te())})}$call(e){return e(this)}$if(e,i){return e?i(this):new t({...this.#e})}$castTo(){return new t(this.#e)}$narrowType(){return new t(this.#e)}$assertType(){return new t(this.#e)}withPlugin(e){return new t({...this.#e,executor:this.#e.executor.withPlugin(e)})}toOperationNode(){return this.#e.executor.transformQuery(this.#e.queryNode,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){let e=this.compile(),i=e.query,n=await this.#e.executor.executeQuery(e,this.#e.queryId);return this.#e.executor.adapter.supportsReturning&&i.returning?n.rows:[new sr(n.insertId,n.numAffectedRows??n.numUpdatedOrDeletedRows)]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=re){let i=await this.executeTakeFirst();if(i===void 0)throw Oe(e)?new e(this.toOperationNode()):e(this.toOperationNode());return i}async*stream(e=100){let i=this.compile(),n=this.#e.executor.stream(i,e,this.#e.queryId);for await(let o of n)yield*o.rows}async explain(e,i){return await new t({...this.#e,queryNode:d.cloneWithExplain(this.#e.queryNode,e,i)}).execute()}};s(Ge,"don't await InsertQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");var dr=class{numDeletedRows;constructor(e){this.numDeletedRows=e}};var cr=r({is(t){return t.kind==="LimitNode"},create(t){return r({kind:"LimitNode",limit:k.create(t)})}});var Ot=class t{#e;constructor(e){this.#e=r(e)}where(...e){return new t({...this.#e,queryNode:d.cloneWithWhere(this.#e.queryNode,b(e))})}whereRef(e,i,n){return new t({...this.#e,queryNode:d.cloneWithWhere(this.#e.queryNode,R(e,i,n))})}clearWhere(){return new t({...this.#e,queryNode:d.cloneWithoutWhere(this.#e.queryNode)})}using(e){return new t({...this.#e,queryNode:be.cloneWithUsing(this.#e.queryNode,ie(e))})}innerJoin(...e){return new t({...this.#e,queryNode:d.cloneWithJoin(this.#e.queryNode,W("InnerJoin",e))})}leftJoin(...e){return new t({...this.#e,queryNode:d.cloneWithJoin(this.#e.queryNode,W("LeftJoin",e))})}rightJoin(...e){return new t({...this.#e,queryNode:d.cloneWithJoin(this.#e.queryNode,W("RightJoin",e))})}fullJoin(...e){return new t({...this.#e,queryNode:d.cloneWithJoin(this.#e.queryNode,W("FullJoin",e))})}returning(e){return new t({...this.#e,queryNode:d.cloneWithReturning(this.#e.queryNode,Z(e))})}returningAll(e){return new t({...this.#e,queryNode:d.cloneWithReturning(this.#e.queryNode,te(e))})}orderBy(e,i){return new t({...this.#e,queryNode:be.cloneWithOrderByItems(this.#e.queryNode,we([e,i]))})}limit(e){return new t({...this.#e,queryNode:be.cloneWithLimit(this.#e.queryNode,cr.create(e))})}$call(e){return e(this)}$if(e,i){return e?i(this):new t({...this.#e})}$castTo(){return new t(this.#e)}$narrowType(){return new t(this.#e)}$assertType(){return new t(this.#e)}withPlugin(e){return new t({...this.#e,executor:this.#e.executor.withPlugin(e)})}toOperationNode(){return this.#e.executor.transformQuery(this.#e.queryNode,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){let e=this.compile(),i=e.query,n=await this.#e.executor.executeQuery(e,this.#e.queryId);return this.#e.executor.adapter.supportsReturning&&i.returning?n.rows:[new dr(n.numAffectedRows??n.numUpdatedOrDeletedRows??BigInt(0))]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=re){let i=await this.executeTakeFirst();if(i===void 0)throw Oe(e)?new e(this.toOperationNode()):e(this.toOperationNode());return i}async*stream(e=100){let i=this.compile(),n=this.#e.executor.stream(i,e,this.#e.queryId);for await(let o of n)yield*o.rows}async explain(e,i){return await new t({...this.#e,queryNode:d.cloneWithExplain(this.#e.queryNode,e,i)}).execute()}};s(Ot,"don't await DeleteQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");var mr=class{numUpdatedRows;numChangedRows;constructor(e,i){this.numUpdatedRows=e,this.numChangedRows=i}};var Ct=class t{#e;constructor(e){this.#e=r(e)}where(...e){return new t({...this.#e,queryNode:d.cloneWithWhere(this.#e.queryNode,b(e))})}whereRef(e,i,n){return new t({...this.#e,queryNode:d.cloneWithWhere(this.#e.queryNode,R(e,i,n))})}clearWhere(){return new t({...this.#e,queryNode:d.cloneWithoutWhere(this.#e.queryNode)})}from(e){return new t({...this.#e,queryNode:We.cloneWithFromItems(this.#e.queryNode,ie(e))})}innerJoin(...e){return new t({...this.#e,queryNode:d.cloneWithJoin(this.#e.queryNode,W("InnerJoin",e))})}leftJoin(...e){return new t({...this.#e,queryNode:d.cloneWithJoin(this.#e.queryNode,W("LeftJoin",e))})}rightJoin(...e){return new t({...this.#e,queryNode:d.cloneWithJoin(this.#e.queryNode,W("RightJoin",e))})}fullJoin(...e){return new t({...this.#e,queryNode:d.cloneWithJoin(this.#e.queryNode,W("FullJoin",e))})}set(...e){return new t({...this.#e,queryNode:We.cloneWithUpdates(this.#e.queryNode,Yi(...e))})}returning(e){return new t({...this.#e,queryNode:d.cloneWithReturning(this.#e.queryNode,Z(e))})}returningAll(){return new t({...this.#e,queryNode:d.cloneWithReturning(this.#e.queryNode,te())})}$call(e){return e(this)}$if(e,i){return e?i(this):new t({...this.#e})}$castTo(){return new t(this.#e)}$narrowType(){return new t(this.#e)}$assertType(){return new t(this.#e)}withPlugin(e){return new t({...this.#e,executor:this.#e.executor.withPlugin(e)})}toOperationNode(){return this.#e.executor.transformQuery(this.#e.queryNode,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){let e=this.compile(),i=e.query,n=await this.#e.executor.executeQuery(e,this.#e.queryId);return this.#e.executor.adapter.supportsReturning&&i.returning?n.rows:[new mr(n.numAffectedRows??n.numUpdatedOrDeletedRows??BigInt(0),n.numChangedRows)]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=re){let i=await this.executeTakeFirst();if(i===void 0)throw Oe(e)?new e(this.toOperationNode()):e(this.toOperationNode());return i}async*stream(e=100){let i=this.compile(),n=this.#e.executor.stream(i,e,this.#e.queryId);for await(let o of n)yield*o.rows}async explain(e,i){return await new t({...this.#e,queryNode:d.cloneWithExplain(this.#e.queryNode,e,i)}).execute()}};s(Ct,"don't await UpdateQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");var ti=r({is(t){return t.kind==="CommonTableExpressionNameNode"},create(t,e){return r({kind:"CommonTableExpressionNameNode",table:K.create(t),columns:e?r(e.map(m.create)):void 0})}});var He=r({is(t){return t.kind==="CommonTableExpressionNode"},create(t,e){return r({kind:"CommonTableExpressionNode",name:t,expression:e})},cloneWith(t,e){return r({...t,...e})}});var Tt=class t{#e;constructor(e){this.#e=r(e)}materialized(){return new t({...this.#e,node:He.cloneWith(this.#e.node,{materialized:!0})})}notMaterialized(){return new t({...this.#e,node:He.cloneWith(this.#e.node,{materialized:!1})})}toOperationNode(){return this.#e.node}};s(Tt,"don't await CTEBuilder instances. They are never executed directly and are always just a part of a query.");function ri(t,e){let i=e(en()).toOperationNode();return x(t)?t($n(i)).toOperationNode():He.create(Xi(t),i)}function $n(t){return e=>new Tt({node:He.create(Xi(e),t)})}function Xi(t){if(t.includes("(")){let e=t.split(/[\(\)]/),i=e[0],n=e[1].split(",").map(o=>o.trim());return ti.create(i,n)}else return ti.create(t)}var vt=r({is(t){return t.kind==="WithNode"},create(t,e){return r({kind:"WithNode",expressions:r([t]),...e})},cloneWithExpression(t,e){return r({...t,expressions:r([...t.expressions,e])})}});var tn=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function pr(t){let e="";for(let i=0;i<t;++i)e+=Un();return e}function Un(){return tn[~~(Math.random()*tn.length)]}function h(){return new ii}var ii=class{#e;get queryId(){return this.#e===void 0&&(this.#e=pr(8)),this.#e}};var Ce=class{nodeStack=[];#e=r({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this),TupleNode:this.transformTuple.bind(this),AddIndexNode:this.transformAddIndex.bind(this)});transformNode(e){if(!e)return e;this.nodeStack.push(e);let i=this.transformNodeImpl(e);return this.nodeStack.pop(),r(i)}transformNodeImpl(e){return this.#e[e.kind](e)}transformNodeList(e){return e&&r(e.map(i=>this.transformNode(i)))}transformSelectQuery(e){return{kind:"SelectQueryNode",from:this.transformNode(e.from),selections:this.transformNodeList(e.selections),distinctOn:this.transformNodeList(e.distinctOn),joins:this.transformNodeList(e.joins),groupBy:this.transformNode(e.groupBy),orderBy:this.transformNode(e.orderBy),where:this.transformNode(e.where),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),limit:this.transformNode(e.limit),offset:this.transformNode(e.offset),with:this.transformNode(e.with),having:this.transformNode(e.having),explain:this.transformNode(e.explain),setOperations:this.transformNodeList(e.setOperations)}}transformSelection(e){return{kind:"SelectionNode",selection:this.transformNode(e.selection)}}transformColumn(e){return{kind:"ColumnNode",column:this.transformNode(e.column)}}transformAlias(e){return{kind:"AliasNode",node:this.transformNode(e.node),alias:this.transformNode(e.alias)}}transformTable(e){return{kind:"TableNode",table:this.transformNode(e.table)}}transformFrom(e){return{kind:"FromNode",froms:this.transformNodeList(e.froms)}}transformReference(e){return{kind:"ReferenceNode",column:this.transformNode(e.column),table:this.transformNode(e.table)}}transformAnd(e){return{kind:"AndNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformOr(e){return{kind:"OrNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformValueList(e){return{kind:"ValueListNode",values:this.transformNodeList(e.values)}}transformParens(e){return{kind:"ParensNode",node:this.transformNode(e.node)}}transformJoin(e){return{kind:"JoinNode",joinType:e.joinType,table:this.transformNode(e.table),on:this.transformNode(e.on)}}transformRaw(e){return{kind:"RawNode",sqlFragments:r([...e.sqlFragments]),parameters:this.transformNodeList(e.parameters)}}transformWhere(e){return{kind:"WhereNode",where:this.transformNode(e.where)}}transformInsertQuery(e){return{kind:"InsertQueryNode",into:this.transformNode(e.into),columns:this.transformNodeList(e.columns),values:this.transformNode(e.values),returning:this.transformNode(e.returning),onConflict:this.transformNode(e.onConflict),onDuplicateKey:this.transformNode(e.onDuplicateKey),with:this.transformNode(e.with),ignore:e.ignore,replace:e.replace,explain:this.transformNode(e.explain)}}transformValues(e){return{kind:"ValuesNode",values:this.transformNodeList(e.values)}}transformDeleteQuery(e){return{kind:"DeleteQueryNode",from:this.transformNode(e.from),using:this.transformNode(e.using),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),returning:this.transformNode(e.returning),with:this.transformNode(e.with),orderBy:this.transformNode(e.orderBy),limit:this.transformNode(e.limit),explain:this.transformNode(e.explain)}}transformReturning(e){return{kind:"ReturningNode",selections:this.transformNodeList(e.selections)}}transformCreateTable(e){return{kind:"CreateTableNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),constraints:this.transformNodeList(e.constraints),temporary:e.temporary,ifNotExists:e.ifNotExists,onCommit:e.onCommit,frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),selectQuery:this.transformNode(e.selectQuery)}}transformColumnDefinition(e){return{kind:"ColumnDefinitionNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),references:this.transformNode(e.references),primaryKey:e.primaryKey,autoIncrement:e.autoIncrement,unique:e.unique,notNull:e.notNull,unsigned:e.unsigned,defaultTo:this.transformNode(e.defaultTo),check:this.transformNode(e.check),generated:this.transformNode(e.generated),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),nullsNotDistinct:e.nullsNotDistinct}}transformAddColumn(e){return{kind:"AddColumnNode",column:this.transformNode(e.column)}}transformDropTable(e){return{kind:"DropTableNode",table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformOrderBy(e){return{kind:"OrderByNode",items:this.transformNodeList(e.items)}}transformOrderByItem(e){return{kind:"OrderByItemNode",orderBy:this.transformNode(e.orderBy),direction:this.transformNode(e.direction)}}transformGroupBy(e){return{kind:"GroupByNode",items:this.transformNodeList(e.items)}}transformGroupByItem(e){return{kind:"GroupByItemNode",groupBy:this.transformNode(e.groupBy)}}transformUpdateQuery(e){return{kind:"UpdateQueryNode",table:this.transformNode(e.table),from:this.transformNode(e.from),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),updates:this.transformNodeList(e.updates),returning:this.transformNode(e.returning),with:this.transformNode(e.with),explain:this.transformNode(e.explain)}}transformColumnUpdate(e){return{kind:"ColumnUpdateNode",column:this.transformNode(e.column),value:this.transformNode(e.value)}}transformLimit(e){return{kind:"LimitNode",limit:this.transformNode(e.limit)}}transformOffset(e){return{kind:"OffsetNode",offset:this.transformNode(e.offset)}}transformOnConflict(e){return{kind:"OnConflictNode",columns:this.transformNodeList(e.columns),constraint:this.transformNode(e.constraint),indexExpression:this.transformNode(e.indexExpression),indexWhere:this.transformNode(e.indexWhere),updates:this.transformNodeList(e.updates),updateWhere:this.transformNode(e.updateWhere),doNothing:e.doNothing}}transformOnDuplicateKey(e){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(e.updates)}}transformCreateIndex(e){return{kind:"CreateIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists,where:this.transformNode(e.where),nullsNotDistinct:e.nullsNotDistinct}}transformList(e){return{kind:"ListNode",items:this.transformNodeList(e.items)}}transformDropIndex(e){return{kind:"DropIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformPrimaryKeyConstraint(e){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)}}transformUniqueConstraint(e){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name),nullsNotDistinct:e.nullsNotDistinct}}transformForeignKeyConstraint(e){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(e.columns),references:this.transformNode(e.references),name:this.transformNode(e.name),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformSetOperation(e){return{kind:"SetOperationNode",operator:e.operator,expression:this.transformNode(e.expression),all:e.all}}transformReferences(e){return{kind:"ReferencesNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformCheckConstraint(e){return{kind:"CheckConstraintNode",expression:this.transformNode(e.expression),name:this.transformNode(e.name)}}transformWith(e){return{kind:"WithNode",expressions:this.transformNodeList(e.expressions),recursive:e.recursive}}transformCommonTableExpression(e){return{kind:"CommonTableExpressionNode",name:this.transformNode(e.name),materialized:e.materialized,expression:this.transformNode(e.expression)}}transformCommonTableExpressionName(e){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns)}}transformHaving(e){return{kind:"HavingNode",having:this.transformNode(e.having)}}transformCreateSchema(e){return{kind:"CreateSchemaNode",schema:this.transformNode(e.schema),ifNotExists:e.ifNotExists}}transformDropSchema(e){return{kind:"DropSchemaNode",schema:this.transformNode(e.schema),ifExists:e.ifExists,cascade:e.cascade}}transformAlterTable(e){return{kind:"AlterTableNode",table:this.transformNode(e.table),renameTo:this.transformNode(e.renameTo),setSchema:this.transformNode(e.setSchema),columnAlterations:this.transformNodeList(e.columnAlterations),addConstraint:this.transformNode(e.addConstraint),dropConstraint:this.transformNode(e.dropConstraint),addIndex:this.transformNode(e.addIndex),dropIndex:this.transformNode(e.dropIndex)}}transformDropColumn(e){return{kind:"DropColumnNode",column:this.transformNode(e.column)}}transformRenameColumn(e){return{kind:"RenameColumnNode",column:this.transformNode(e.column),renameTo:this.transformNode(e.renameTo)}}transformAlterColumn(e){return{kind:"AlterColumnNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),dataTypeExpression:this.transformNode(e.dataTypeExpression),setDefault:this.transformNode(e.setDefault),dropDefault:e.dropDefault,setNotNull:e.setNotNull,dropNotNull:e.dropNotNull}}transformModifyColumn(e){return{kind:"ModifyColumnNode",column:this.transformNode(e.column)}}transformAddConstraint(e){return{kind:"AddConstraintNode",constraint:this.transformNode(e.constraint)}}transformDropConstraint(e){return{kind:"DropConstraintNode",constraintName:this.transformNode(e.constraintName),ifExists:e.ifExists,modifier:e.modifier}}transformCreateView(e){return{kind:"CreateViewNode",name:this.transformNode(e.name),temporary:e.temporary,orReplace:e.orReplace,ifNotExists:e.ifNotExists,materialized:e.materialized,columns:this.transformNodeList(e.columns),as:this.transformNode(e.as)}}transformDropView(e){return{kind:"DropViewNode",name:this.transformNode(e.name),ifExists:e.ifExists,materialized:e.materialized,cascade:e.cascade}}transformGenerated(e){return{kind:"GeneratedNode",byDefault:e.byDefault,always:e.always,identity:e.identity,stored:e.stored,expression:this.transformNode(e.expression)}}transformDefaultValue(e){return{kind:"DefaultValueNode",defaultValue:this.transformNode(e.defaultValue)}}transformOn(e){return{kind:"OnNode",on:this.transformNode(e.on)}}transformSelectModifier(e){return{kind:"SelectModifierNode",modifier:e.modifier,rawModifier:this.transformNode(e.rawModifier)}}transformCreateType(e){return{kind:"CreateTypeNode",name:this.transformNode(e.name),enum:this.transformNode(e.enum)}}transformDropType(e){return{kind:"DropTypeNode",name:this.transformNode(e.name),ifExists:e.ifExists}}transformExplain(e){return{kind:"ExplainNode",format:e.format,options:this.transformNode(e.options)}}transformSchemableIdentifier(e){return{kind:"SchemableIdentifierNode",schema:this.transformNode(e.schema),identifier:this.transformNode(e.identifier)}}transformAggregateFunction(e){return{kind:"AggregateFunctionNode",aggregated:this.transformNodeList(e.aggregated),distinct:e.distinct,filter:this.transformNode(e.filter),func:e.func,over:this.transformNode(e.over)}}transformOver(e){return{kind:"OverNode",orderBy:this.transformNode(e.orderBy),partitionBy:this.transformNode(e.partitionBy)}}transformPartitionBy(e){return{kind:"PartitionByNode",items:this.transformNodeList(e.items)}}transformPartitionByItem(e){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(e.partitionBy)}}transformBinaryOperation(e){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(e.leftOperand),operator:this.transformNode(e.operator),rightOperand:this.transformNode(e.rightOperand)}}transformUnaryOperation(e){return{kind:"UnaryOperationNode",operator:this.transformNode(e.operator),operand:this.transformNode(e.operand)}}transformUsing(e){return{kind:"UsingNode",tables:this.transformNodeList(e.tables)}}transformFunction(e){return{kind:"FunctionNode",func:e.func,arguments:this.transformNodeList(e.arguments)}}transformCase(e){return{kind:"CaseNode",value:this.transformNode(e.value),when:this.transformNodeList(e.when),else:this.transformNode(e.else),isStatement:e.isStatement}}transformWhen(e){return{kind:"WhenNode",condition:this.transformNode(e.condition),result:this.transformNode(e.result)}}transformJSONReference(e){return{kind:"JSONReferenceNode",reference:this.transformNode(e.reference),traversal:this.transformNode(e.traversal)}}transformJSONPath(e){return{kind:"JSONPathNode",inOperator:this.transformNode(e.inOperator),pathLegs:this.transformNodeList(e.pathLegs)}}transformJSONPathLeg(e){return{kind:"JSONPathLegNode",type:e.type,value:e.value}}transformJSONOperatorChain(e){return{kind:"JSONOperatorChainNode",operator:this.transformNode(e.operator),values:this.transformNodeList(e.values)}}transformTuple(e){return{kind:"TupleNode",values:this.transformNodeList(e.values)}}transformAddIndex(e){return{kind:"AddIndexNode",name:this.transformNode(e.name),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists}}transformDataType(e){return e}transformSelectAll(e){return e}transformIdentifier(e){return e}transformValue(e){return e}transformPrimitiveValueList(e){return e}transformOperator(e){return e}transformDefaultInsertValue(e){return e}};var Vn=r({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0}),lr=class extends Ce{#e;#t=new Set;#r=new Set;constructor(e){super(),this.#e=e}transformNodeImpl(e){if(!this.#n(e))return super.transformNodeImpl(e);let i=this.#s(e);for(let a of i)this.#r.add(a);let n=this.#i(e);for(let a of n)this.#t.add(a);let o=super.transformNodeImpl(e);for(let a of n)this.#t.delete(a);for(let a of i)this.#r.delete(a);return o}transformSchemableIdentifier(e){let i=super.transformSchemableIdentifier(e);return i.schema||!this.#t.has(e.identifier.name)?i:{...i,schema:u.create(this.#e)}}transformReferences(e){let i=super.transformReferences(e);return i.table.table.schema?i:{...i,table:K.createWithSchema(this.#e,i.table.table.identifier.name)}}#n(e){return e.kind in Vn}#i(e){let i=new Set;if("name"in e&&e.name&&M.is(e.name)&&this.#a(e.name,i),"from"in e&&e.from)for(let n of e.from.froms)this.#o(n,i);if("into"in e&&e.into&&this.#o(e.into,i),"table"in e&&e.table&&this.#o(e.table,i),"joins"in e&&e.joins)for(let n of e.joins)this.#o(n.table,i);return i}#s(e){let i=new Set;return"with"in e&&e.with&&this.#u(e.with,i),i}#o(e,i){let n=K.is(e)?e:q.is(e)&&K.is(e.node)?e.node:null;n&&this.#a(n.table,i)}#a(e,i){let n=e.identifier.name;!this.#t.has(n)&&!this.#r.has(n)&&i.add(n)}#u(e,i){for(let n of e.expressions){let o=n.name.table.table.identifier.name;this.#r.has(o)||i.add(o)}}};var G=class{#e;constructor(e){this.#e=new lr(e)}transformQuery(e){return this.#e.transformNode(e.node)}async transformResult(e){return e.result}};var Ye=class t{#e;constructor(e){this.#e=r(e)}selectFrom(e){return Ze({queryId:h(),executor:this.#e.executor,queryNode:c.createFrom(ie(e),this.#e.withNode)})}selectNoFrom(e){return Ze({queryId:h(),executor:this.#e.executor,queryNode:c.cloneWithSelections(c.create(this.#e.withNode),Z(e))})}insertInto(e){return new Ge({queryId:h(),executor:this.#e.executor,queryNode:z.create(g(e),this.#e.withNode)})}replaceInto(e){return new Ge({queryId:h(),executor:this.#e.executor,queryNode:z.create(g(e),this.#e.withNode,!0)})}deleteFrom(e){return new Ot({queryId:h(),executor:this.#e.executor,queryNode:be.create(ie(e),this.#e.withNode)})}updateTable(e){return new Ct({queryId:h(),executor:this.#e.executor,queryNode:We.create(Te(e),this.#e.withNode)})}with(e,i){let n=ri(e,i);return new t({...this.#e,withNode:this.#e.withNode?vt.cloneWithExpression(this.#e.withNode,n):vt.create(n)})}withRecursive(e,i){let n=ri(e,i);return new t({...this.#e,withNode:this.#e.withNode?vt.cloneWithExpression(this.#e.withNode,n):vt.create(n,{recursive:!0})})}withPlugin(e){return new t({...this.#e,executor:this.#e.executor.withPlugin(e)})}withoutPlugins(){return new t({...this.#e,executor:this.#e.executor.withoutPlugins()})}withSchema(e){return new t({...this.#e,executor:this.#e.executor.withPluginAtFront(new G(e))})}};var ve=class{#e;#t;#r;constructor(){this.#e=new Promise((e,i)=>{this.#r=i,this.#t=e})}get promise(){return this.#e}resolve=e=>{this.#t&&this.#t(e)};reject=e=>{this.#r&&this.#r(e)}};var rn=new Set;function ni(t){rn.has(t)||(rn.add(t),console.log(t))}var zn=r([]),Xe=class{#e;constructor(e=zn){this.#e=e}get plugins(){return this.#e}transformQuery(e,i){for(let n of this.#e){let o=n.transformQuery({node:e,queryId:i});if(o.kind===e.kind)e=o;else throw new Error(["KyselyPlugin.transformQuery must return a node","of the same kind that was given to it.",`The plugin was given a ${e.kind}`,`but it returned a ${o.kind}`].join(" "))}return e}async executeQuery(e,i){return await this.provideConnection(async n=>{let o=await n.executeQuery(e),a=await this.#t(o,i);return Jn(o,a),a})}async*stream(e,i,n){let o=new ve,a=new ve;this.provideConnection(async S=>(o.resolve(S),await a.promise)).catch(S=>o.reject(S));let p=await o.promise;try{for await(let S of p.streamQuery(e,i))yield await this.#t(S,n)}finally{a.resolve()}}async#t(e,i){for(let n of this.#e)e=await n.transformResult({result:e,queryId:i});return e}};function Jn(t,e){let{numAffectedRows:i}=t;i===void 0&&t.numUpdatedOrDeletedRows===void 0||i!==void 0&&e.numAffectedRows!==void 0||ni("kysely:warning: outdated driver/plugin detected! QueryResult.numUpdatedOrDeletedRows is deprecated and will be removed in a future release.")}var oi=class t extends Xe{get adapter(){throw new Error("this query cannot be compiled to SQL")}compileQuery(){throw new Error("this query cannot be compiled to SQL")}provideConnection(){throw new Error("this query cannot be executed")}withConnectionProvider(){throw new Error("this query cannot have a connection provider")}withPlugin(e){return new t([...this.plugins,e])}withPlugins(e){return new t([...this.plugins,...e])}withPluginAtFront(e){return new t([e,...this.plugins])}withoutPlugins(){return new t([])}},et=new oi;function en(){return new Ye({executor:et})}function nn(t,e){return new xt({joinNode:Ne.create(t,Te(e))})}function on(){return new wt({overNode:Nt.create()})}function W(t,e){if(e.length===3)return jn(t,e[0],e[1],e[2]);if(e.length===2)return Kn(t,e[0],e[1]);throw new Error("not implemented")}function Kn(t,e,i){return i(nn(t,e)).toOperationNode()}function jn(t,e,i,n){return Ne.createWithOn(t,Te(e),R(i,"=",n))}var sn=r({is(t){return t.kind==="OffsetNode"},create(t){return r({kind:"OffsetNode",offset:k.create(t)})}});var an=r({is(t){return t.kind==="GroupByItemNode"},create(t){return r({kind:"GroupByItemNode",groupBy:t})}});function un(t){return t=x(t)?t(V()):t,ce(t).map(an.create)}var si=r({is(t){return t.kind==="SetOperationNode"},create(t,e,i){return r({kind:"SetOperationNode",operator:t,expression:e,all:i})}});function qe(t,e,i){return x(e)&&(e=e(hr())),L(e)||(e=[e]),e.map(n=>si.create(t,Q(n),i))}var N=class t{#e;constructor(e){this.#e=e}get expressionType(){}as(e){return new It(this,e)}or(...e){return new ai(Y.create(this.#e,b(e)))}and(...e){return new ui(F.create(this.#e,b(e)))}$castTo(){return new t(this.#e)}toOperationNode(){return this.#e}},It=class{#e;#t;constructor(e,i){this.#e=e,this.#t=i}get expression(){return this.#e}get alias(){return this.#t}toOperationNode(){return q.create(this.#e.toOperationNode(),I(this.#t)?this.#t.toOperationNode():u.create(this.#t))}},ai=class t{#e;constructor(e){this.#e=e}get expressionType(){}as(e){return new It(this,e)}or(...e){return new t(Y.create(this.#e,b(e)))}$castTo(){return new t(this.#e)}toOperationNode(){return me.create(this.#e)}},ui=class t{#e;constructor(e){this.#e=e}get expressionType(){}as(e){return new It(this,e)}and(...e){return new t(F.create(this.#e,b(e)))}$castTo(){return new t(this.#e)}toOperationNode(){return me.create(this.#e)}};var fr=class t{#e;constructor(e){this.#e=r(e)}get expressionType(){}get isSelectQueryBuilder(){return!0}where(...e){return new t({...this.#e,queryNode:d.cloneWithWhere(this.#e.queryNode,b(e))})}whereRef(e,i,n){return new t({...this.#e,queryNode:d.cloneWithWhere(this.#e.queryNode,R(e,i,n))})}having(...e){return new t({...this.#e,queryNode:c.cloneWithHaving(this.#e.queryNode,b(e))})}havingRef(e,i,n){return new t({...this.#e,queryNode:c.cloneWithHaving(this.#e.queryNode,R(e,i,n))})}select(e){return new t({...this.#e,queryNode:c.cloneWithSelections(this.#e.queryNode,Z(e))})}distinctOn(e){return new t({...this.#e,queryNode:c.cloneWithDistinctOn(this.#e.queryNode,ce(e))})}modifyFront(e){return new t({...this.#e,queryNode:c.cloneWithFrontModifier(this.#e.queryNode,ee.createWithExpression(e.toOperationNode()))})}modifyEnd(e){return new t({...this.#e,queryNode:c.cloneWithEndModifier(this.#e.queryNode,ee.createWithExpression(e.toOperationNode()))})}distinct(){return new t({...this.#e,queryNode:c.cloneWithFrontModifier(this.#e.queryNode,ee.create("Distinct"))})}forUpdate(){return new t({...this.#e,queryNode:c.cloneWithEndModifier(this.#e.queryNode,ee.create("ForUpdate"))})}forShare(){return new t({...this.#e,queryNode:c.cloneWithEndModifier(this.#e.queryNode,ee.create("ForShare"))})}forKeyShare(){return new t({...this.#e,queryNode:c.cloneWithEndModifier(this.#e.queryNode,ee.create("ForKeyShare"))})}forNoKeyUpdate(){return new t({...this.#e,queryNode:c.cloneWithEndModifier(this.#e.queryNode,ee.create("ForNoKeyUpdate"))})}skipLocked(){return new t({...this.#e,queryNode:c.cloneWithEndModifier(this.#e.queryNode,ee.create("SkipLocked"))})}noWait(){return new t({...this.#e,queryNode:c.cloneWithEndModifier(this.#e.queryNode,ee.create("NoWait"))})}selectAll(e){return new t({...this.#e,queryNode:c.cloneWithSelections(this.#e.queryNode,te(e))})}innerJoin(...e){return new t({...this.#e,queryNode:d.cloneWithJoin(this.#e.queryNode,W("InnerJoin",e))})}leftJoin(...e){return new t({...this.#e,queryNode:d.cloneWithJoin(this.#e.queryNode,W("LeftJoin",e))})}rightJoin(...e){return new t({...this.#e,queryNode:d.cloneWithJoin(this.#e.queryNode,W("RightJoin",e))})}fullJoin(...e){return new t({...this.#e,queryNode:d.cloneWithJoin(this.#e.queryNode,W("FullJoin",e))})}innerJoinLateral(...e){return new t({...this.#e,queryNode:d.cloneWithJoin(this.#e.queryNode,W("LateralInnerJoin",e))})}leftJoinLateral(...e){return new t({...this.#e,queryNode:d.cloneWithJoin(this.#e.queryNode,W("LateralLeftJoin",e))})}orderBy(...e){return new t({...this.#e,queryNode:c.cloneWithOrderByItems(this.#e.queryNode,we(e))})}groupBy(e){return new t({...this.#e,queryNode:c.cloneWithGroupByItems(this.#e.queryNode,un(e))})}limit(e){return new t({...this.#e,queryNode:c.cloneWithLimit(this.#e.queryNode,cr.create(e))})}offset(e){return new t({...this.#e,queryNode:c.cloneWithOffset(this.#e.queryNode,sn.create(e))})}union(e){return new t({...this.#e,queryNode:c.cloneWithSetOperations(this.#e.queryNode,qe("union",e,!1))})}unionAll(e){return new t({...this.#e,queryNode:c.cloneWithSetOperations(this.#e.queryNode,qe("union",e,!0))})}intersect(e){return new t({...this.#e,queryNode:c.cloneWithSetOperations(this.#e.queryNode,qe("intersect",e,!1))})}intersectAll(e){return new t({...this.#e,queryNode:c.cloneWithSetOperations(this.#e.queryNode,qe("intersect",e,!0))})}except(e){return new t({...this.#e,queryNode:c.cloneWithSetOperations(this.#e.queryNode,qe("except",e,!1))})}exceptAll(e){return new t({...this.#e,queryNode:c.cloneWithSetOperations(this.#e.queryNode,qe("except",e,!0))})}as(e){return new yr(this,e)}clearSelect(){return new t({...this.#e,queryNode:c.cloneWithoutSelections(this.#e.queryNode)})}clearWhere(){return new t({...this.#e,queryNode:d.cloneWithoutWhere(this.#e.queryNode)})}clearLimit(){return new t({...this.#e,queryNode:c.cloneWithoutLimit(this.#e.queryNode)})}clearOffset(){return new t({...this.#e,queryNode:c.cloneWithoutOffset(this.#e.queryNode)})}clearOrderBy(){return new t({...this.#e,queryNode:c.cloneWithoutOrderBy(this.#e.queryNode)})}$call(e){return e(this)}$if(e,i){return e?i(this):new t({...this.#e})}$castTo(){return new t(this.#e)}$narrowType(){return new t(this.#e)}$assertType(){return new t(this.#e)}$asTuple(){return new N(this.toOperationNode())}withPlugin(e){return new t({...this.#e,executor:this.#e.executor.withPlugin(e)})}toOperationNode(){return this.#e.executor.transformQuery(this.#e.queryNode,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){let e=this.compile();return(await this.#e.executor.executeQuery(e,this.#e.queryId)).rows}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=re){let i=await this.executeTakeFirst();if(i===void 0)throw Oe(e)?new e(this.toOperationNode()):e(this.toOperationNode());return i}async*stream(e=100){let i=this.compile(),n=this.#e.executor.stream(i,e,this.#e.queryId);for await(let o of n)yield*o.rows}async explain(e,i){return await new t({...this.#e,queryNode:d.cloneWithExplain(this.#e.queryNode,e,i)}).execute()}};s(fr,"don't await SelectQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");function Ze(t){return new fr(t)}var yr=class{#e;#t;constructor(e,i){this.#e=e,this.#t=i}get expression(){return this.#e}get alias(){return this.#t}get isAliasedSelectQueryBuilder(){return!0}toOperationNode(){return q.create(this.#e.toOperationNode(),u.create(this.#t))}};s(yr,"don't await AliasedSelectQueryBuilder instances directly. AliasedSelectQueryBuilder should never be executed directly since it's always a part of another query.");var le=r({is(t){return t.kind==="AggregateFunctionNode"},create(t,e=[]){return r({kind:"AggregateFunctionNode",func:t,aggregated:e})},cloneWithDistinct(t){return r({...t,distinct:!0})},cloneWithFilter(t,e){return r({...t,filter:t.filter?D.cloneWithOperation(t.filter,"And",e):D.create(e)})},cloneWithOrFilter(t,e){return r({...t,filter:t.filter?D.cloneWithOperation(t.filter,"Or",e):D.create(e)})},cloneWithOver(t,e){return r({...t,over:e})}});var di=r({is(t){return t.kind==="FunctionNode"},create(t,e){return r({kind:"FunctionNode",func:t,arguments:e})}});var _e=class t{#e;constructor(e){this.#e=r(e)}get expressionType(){}as(e){return new ci(this,e)}distinct(){return new t({...this.#e,aggregateFunctionNode:le.cloneWithDistinct(this.#e.aggregateFunctionNode)})}filterWhere(...e){return new t({...this.#e,aggregateFunctionNode:le.cloneWithFilter(this.#e.aggregateFunctionNode,b(e))})}filterWhereRef(e,i,n){return new t({...this.#e,aggregateFunctionNode:le.cloneWithFilter(this.#e.aggregateFunctionNode,R(e,i,n))})}over(e){let i=on();return new t({...this.#e,aggregateFunctionNode:le.cloneWithOver(this.#e.aggregateFunctionNode,(e?e(i):i).toOperationNode())})}$call(e){return e(this)}toOperationNode(){return this.#e.aggregateFunctionNode}};s(_e,"don't await AggregateFunctionBuilder instances. They are never executed directly and are always just a part of a query.");var ci=class{#e;#t;constructor(e,i){this.#e=e,this.#t=i}get expression(){return this.#e}get alias(){return this.#t}toOperationNode(){return q.create(this.#e.toOperationNode(),u.create(this.#t))}};function Nr(){let t=(i,n)=>new N(di.create(i,ce(n??[]))),e=(i,n)=>new _e({aggregateFunctionNode:le.create(i,n?ce(n):void 0)});return Object.assign(t,{agg:e,avg(i){return e("avg",[i])},coalesce(...i){return t("coalesce",i)},count(i){return e("count",[i])},countAll(i){return new _e({aggregateFunctionNode:le.create("count",te(i))})},max(i){return e("max",[i])},min(i){return e("min",[i])},sum(i){return e("sum",[i])},any(i){return t("any",[i])},jsonAgg(i){return new _e({aggregateFunctionNode:le.create("json_agg",[C(i)?g(i):i.toOperationNode()])})},toJson(i){return new N(di.create("to_json",[C(i)?g(i):i.toOperationNode()]))}})}var dn=r({is(t){return t.kind==="UnaryOperationNode"},create(t,e){return r({kind:"UnaryOperationNode",operator:t,operand:e})}});function cn(t,e){return dn.create(j.create(t),_(e))}var St=r({is(t){return t.kind==="WhenNode"},create(t){return r({kind:"WhenNode",condition:t})},cloneWithResult(t,e){return r({...t,result:e})}});var J=r({is(t){return t.kind==="CaseNode"},create(t){return r({kind:"CaseNode",value:t})},cloneWithWhen(t,e){return r({...t,when:r(t.when?[...t.when,e]:[e])})},cloneWithThen(t,e){return r({...t,when:t.when?r([...t.when.slice(0,-1),St.cloneWithResult(t.when[t.when.length-1],e)]):void 0})},cloneWith(t,e){return r({...t,...e})}});var tt=class{#e;constructor(e){this.#e=r(e)}when(...e){return new xr({...this.#e,node:J.cloneWithWhen(this.#e.node,St.create(b(e)))})}},xr=class{#e;constructor(e){this.#e=r(e)}then(e){return new mi({...this.#e,node:J.cloneWithThen(this.#e.node,rr(e)?yt(e):T(e))})}},mi=class{#e;constructor(e){this.#e=r(e)}when(...e){return new xr({...this.#e,node:J.cloneWithWhen(this.#e.node,St.create(b(e)))})}else(e){return new pi({...this.#e,node:J.cloneWith(this.#e.node,{else:rr(e)?yt(e):T(e)})})}end(){return new N(J.cloneWith(this.#e.node,{isStatement:!1}))}endCase(){return new N(J.cloneWith(this.#e.node,{isStatement:!0}))}},pi=class{#e;constructor(e){this.#e=r(e)}end(){return new N(J.cloneWith(this.#e.node,{isStatement:!1}))}endCase(){return new N(J.cloneWith(this.#e.node,{isStatement:!0}))}};var li=r({is(t){return t.kind==="JSONPathLegNode"},create(t,e){return r({kind:"JSONPathLegNode",type:t,value:e})}});var Re=class{#e;constructor(e){this.#e=e}at(e){return this.#t("ArrayLocation",e)}key(e){return this.#t("Member",e)}#t(e,i){return ze.is(this.#e)?new wr(ze.cloneWithTraversal(this.#e,ge.is(this.#e.traversal)?ge.cloneWithLeg(this.#e.traversal,li.create(e,i)):er.cloneWithValue(this.#e.traversal,k.createImmediate(i)))):new wr(ge.cloneWithLeg(this.#e,li.create(e,i)))}},wr=class extends Re{#e;constructor(e){super(e),this.#e=e}get expressionType(){}as(e){return new hi(this,e)}$castTo(){return new Re(this.#e)}toOperationNode(){return this.#e}},hi=class{#e;#t;constructor(e,i){this.#e=e,this.#t=i}get expression(){return this.#e}get alias(){return this.#t}toOperationNode(){return q.create(this.#e.toOperationNode(),I(this.#t)?this.#t.toOperationNode():u.create(this.#t))}};var fi=r({is(t){return t.kind==="TupleNode"},create(t){return r({kind:"TupleNode",values:r(t)})}});function hr(t=et){function e(o,a,p){return new N(ir(o,a,p))}function i(o,a){return new N(cn(o,a))}let n=Object.assign(e,{fn:void 0,eb:void 0,selectFrom(o){return Ze({queryId:h(),executor:t,queryNode:c.createFrom(ie(o))})},case(o){return new tt({node:J.create($(o)?void 0:_(o))})},ref(o,a){return $(a)?new N(U(o)):new Re(Bi(o,a))},jsonPath(){return new Re(ge.create())},table(o){return new N(g(o))},val(o){return new N(T(o))},refTuple(...o){return new N(fi.create(o.map(_)))},tuple(...o){return new N(fi.create(o.map(T)))},lit(o){return new N(yt(o))},unary:i,not(o){return i("not",o)},exists(o){return i("exists",o)},neg(o){return i("-",o)},between(o,a,p){return new N(xe.create(_(o),j.create("between"),F.create(T(a),T(p))))},betweenSymmetric(o,a,p){return new N(xe.create(_(o),j.create("between symmetric"),F.create(T(a),T(p))))},and(o){return L(o)?new N(nr(o,"and")):new N(jr(o,"and"))},or(o){return L(o)?new N(nr(o,"or")):new N(jr(o,"or"))},parens(...o){let a=b(o);return me.is(a)?new N(a):new N(me.create(a))},withSchema(o){return hr(t.withPluginAtFront(new G(o)))}});return n.fn=Nr(),n.eb=n,n}function V(t){return hr()}function Q(t){if(I(t))return t.toOperationNode();if(x(t))return t(V()).toOperationNode();throw new Error(`invalid expression: ${JSON.stringify(t)}`)}function or(t){if(I(t))return t.toOperationNode();if(x(t))return t(V()).toOperationNode();throw new Error(`invalid aliased expression: ${JSON.stringify(t)}`)}function de(t){return qi(t)||_i(t)||x(t)}function ie(t){return L(t)?t.map(e=>Te(e)):[Te(t)]}function Te(t){return C(t)?Gn(t):or(t)}function Gn(t){let e=" as ";if(t.includes(e)){let[i,n]=t.split(e).map(mn);return q.create(g(i),u.create(n))}else return g(t)}function g(t){let e=".";if(t.includes(e)){let[i,n]=t.split(e).map(mn);return K.createWithSchema(i,n)}else return K.create(t)}function mn(t){return t.trim()}var yi=r({is(t){return t.kind==="AddColumnNode"},create(t){return r({kind:"AddColumnNode",column:t})}});var O=r({is(t){return t.kind==="ColumnDefinitionNode"},create(t,e){return r({kind:"ColumnDefinitionNode",column:m.create(t),dataType:e})},cloneWithFrontModifier(t,e){return r({...t,frontModifiers:t.frontModifiers?r([...t.frontModifiers,e]):[e]})},cloneWithEndModifier(t,e){return r({...t,endModifiers:t.endModifiers?r([...t.endModifiers,e]):[e]})},cloneWith(t,e){return r({...t,...e})}});var Ni=r({is(t){return t.kind==="DropColumnNode"},create(t){return r({kind:"DropColumnNode",column:m.create(t)})}});var xi=r({is(t){return t.kind==="RenameColumnNode"},create(t,e){return r({kind:"RenameColumnNode",column:m.create(t),renameTo:m.create(e)})}});var rt=r({is(t){return t.kind==="CheckConstraintNode"},create(t,e){return r({kind:"CheckConstraintNode",expression:t,name:e?u.create(e):void 0})}});var pn=["no action","restrict","cascade","set null","set default"],it=r({is(t){return t.kind==="ReferencesNode"},create(t,e){return r({kind:"ReferencesNode",table:t,columns:r([...e])})},cloneWithOnDelete(t,e){return r({...t,onDelete:e})},cloneWithOnUpdate(t,e){return r({...t,onUpdate:e})}});function gr(t){return I(t)?t.toOperationNode():k.createImmediate(t)}var Et=r({is(t){return t.kind==="GeneratedNode"},create(t){return r({kind:"GeneratedNode",...t})},createWithExpression(t){return r({kind:"GeneratedNode",always:!0,expression:t})},cloneWith(t,e){return r({...t,...e})}});var ln=r({is(t){return t.kind==="DefaultValueNode"},create(t){return r({kind:"DefaultValueNode",defaultValue:t})}});function nt(t){if(pn.includes(t))return t;throw new Error(`invalid OnModifyForeignAction ${t}`)}var ne=class t{#e;constructor(e){this.#e=e}autoIncrement(){return new t(O.cloneWith(this.#e,{autoIncrement:!0}))}primaryKey(){return new t(O.cloneWith(this.#e,{primaryKey:!0}))}references(e){let i=U(e);if(!i.table||Ue.is(i.column))throw new Error(`invalid call references('${e}'). The reference must have format table.column or schema.table.column`);return new t(O.cloneWith(this.#e,{references:it.create(i.table,[i.column])}))}onDelete(e){if(!this.#e.references)throw new Error("on delete constraint can only be added for foreign keys");return new t(O.cloneWith(this.#e,{references:it.cloneWithOnDelete(this.#e.references,nt(e))}))}onUpdate(e){if(!this.#e.references)throw new Error("on update constraint can only be added for foreign keys");return new t(O.cloneWith(this.#e,{references:it.cloneWithOnUpdate(this.#e.references,nt(e))}))}unique(){return new t(O.cloneWith(this.#e,{unique:!0}))}notNull(){return new t(O.cloneWith(this.#e,{notNull:!0}))}unsigned(){return new t(O.cloneWith(this.#e,{unsigned:!0}))}defaultTo(e){return new t(O.cloneWith(this.#e,{defaultTo:ln.create(gr(e))}))}check(e){return new t(O.cloneWith(this.#e,{check:rt.create(e.toOperationNode())}))}generatedAlwaysAs(e){return new t(O.cloneWith(this.#e,{generated:Et.createWithExpression(e.toOperationNode())}))}generatedAlwaysAsIdentity(){return new t(O.cloneWith(this.#e,{generated:Et.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new t(O.cloneWith(this.#e,{generated:Et.create({identity:!0,byDefault:!0})}))}stored(){if(!this.#e.generated)throw new Error("stored() can only be called after generatedAlwaysAs");return new t(O.cloneWith(this.#e,{generated:Et.cloneWith(this.#e.generated,{stored:!0})}))}modifyFront(e){return new t(O.cloneWithFrontModifier(this.#e,e.toOperationNode()))}nullsNotDistinct(){return new t(O.cloneWith(this.#e,{nullsNotDistinct:!0}))}modifyEnd(e){return new t(O.cloneWithEndModifier(this.#e,e.toOperationNode()))}$call(e){return e(this)}toOperationNode(){return this.#e}};s(ne,"don't await ColumnDefinitionBuilder instances directly.");var wi=r({is(t){return t.kind==="ModifyColumnNode"},create(t){return r({kind:"ModifyColumnNode",column:t})}});var hn=r({is(t){return t.kind==="DataTypeNode"},create(t){return r({kind:"DataTypeNode",dataType:t})}});function he(t){return I(t)?t.toOperationNode():hn.create(t)}var Le=r({is(t){return t.kind==="ForeignKeyConstraintNode"},create(t,e,i,n){return r({kind:"ForeignKeyConstraintNode",columns:t,references:it.create(e,i),name:n?u.create(n):void 0})},cloneWith(t,e){return r({...t,...e})}});var Pe=class t{#e;constructor(e){this.#e=e}onDelete(e){return new t(Le.cloneWith(this.#e,{onDelete:nt(e)}))}onUpdate(e){return new t(Le.cloneWith(this.#e,{onUpdate:nt(e)}))}$call(e){return e(this)}toOperationNode(){return this.#e}};s(Pe,"don't await ForeignKeyConstraintBuilder instances directly.");var ot=r({is(t){return t.kind==="AddConstraintNode"},create(t){return r({kind:"AddConstraintNode",constraint:t})}});var st=r({is(t){return t.kind==="UniqueConstraintNode"},create(t,e,i){return r({kind:"UniqueConstraintNode",columns:r(t.map(m.create)),name:e?u.create(e):void 0,nullsNotDistinct:i})},cloneWith(t,e){return r({...t,...e})}});var at=r({is(t){return t.kind==="DropConstraintNode"},create(t){return r({kind:"DropConstraintNode",constraintName:u.create(t)})},cloneWith(t,e){return r({...t,...e})}});var ut=r({is(t){return t.kind==="AlterColumnNode"},create(t,e,i){return r({kind:"AlterColumnNode",column:m.create(t),[e]:i})}});var dt=class{#e;constructor(e){this.#e=e}setDataType(e){return new Be(ut.create(this.#e,"dataType",he(e)))}setDefault(e){return new Be(ut.create(this.#e,"setDefault",gr(e)))}dropDefault(){return new Be(ut.create(this.#e,"dropDefault",!0))}setNotNull(){return new Be(ut.create(this.#e,"setNotNull",!0))}dropNotNull(){return new Be(ut.create(this.#e,"dropNotNull",!0))}$call(e){return e(this)}},Be=class{#e;constructor(e){this.#e=e}toOperationNode(){return this.#e}};var oe=class{#e;constructor(e){this.#e=r(e)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};s(oe,"don't await AlterTableExecutor instances directly. To execute the query you need to call `execute`");var kt=class t{#e;constructor(e){this.#e=r(e)}onDelete(e){return new t({...this.#e,constraintBuilder:this.#e.constraintBuilder.onDelete(e)})}onUpdate(e){return new t({...this.#e,constraintBuilder:this.#e.constraintBuilder.onUpdate(e)})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(l.cloneWithTableProps(this.#e.node,{addConstraint:ot.create(this.#e.constraintBuilder.toOperationNode())}),this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};s(kt,"don't await AlterTableAddForeignKeyConstraintBuilder instances directly. To execute the query you need to call `execute`");var At=class t{#e;constructor(e){this.#e=r(e)}ifExists(){return new t({...this.#e,node:l.cloneWithTableProps(this.#e.node,{dropConstraint:at.cloneWith(this.#e.node.dropConstraint,{ifExists:!0})})})}cascade(){return new t({...this.#e,node:l.cloneWithTableProps(this.#e.node,{dropConstraint:at.cloneWith(this.#e.node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new t({...this.#e,node:l.cloneWithTableProps(this.#e.node,{dropConstraint:at.cloneWith(this.#e.node.dropConstraint,{modifier:"restrict"})})})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};s(At,"don't await AlterTableDropConstraintBuilder instances directly. To execute the query you need to call `execute`");var br=r({is(t){return t.kind==="PrimaryKeyConstraintNode"},create(t,e){return r({kind:"PrimaryKeyConstraintNode",columns:r(t.map(m.create)),name:e?u.create(e):void 0})}});var Ie=r({is(t){return t.kind==="AddIndexNode"},create(t){return r({kind:"AddIndexNode",name:u.create(t)})},cloneWith(t,e){return r({...t,...e})},cloneWithColumns(t,e){return r({...t,columns:[...t.columns||[],...e]})}});var Dt=class t{#e;constructor(e){this.#e=r(e)}unique(){return new t({...this.#e,node:l.cloneWithTableProps(this.#e.node,{addIndex:Ie.cloneWith(this.#e.node.addIndex,{unique:!0})})})}column(e){return new t({...this.#e,node:l.cloneWithTableProps(this.#e.node,{addIndex:Ie.cloneWithColumns(this.#e.node.addIndex,[Je(e)])})})}columns(e){return new t({...this.#e,node:l.cloneWithTableProps(this.#e.node,{addIndex:Ie.cloneWithColumns(this.#e.node.addIndex,e.map(Je))})})}expression(e){return new t({...this.#e,node:l.cloneWithTableProps(this.#e.node,{addIndex:Ie.cloneWithColumns(this.#e.node.addIndex,[e.toOperationNode()])})})}using(e){return new t({...this.#e,node:l.cloneWithTableProps(this.#e.node,{addIndex:Ie.cloneWith(this.#e.node.addIndex,{using:v.createWithSql(e)})})})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};s(Dt,"don't await AlterTableAddIndexBuilder instances directly. To execute the query you need to call `execute`");var Me=class t{#e;constructor(e){this.#e=e}toOperationNode(){return this.#e}nullsNotDistinct(){return new t(st.cloneWith(this.#e,{nullsNotDistinct:!0}))}};s(Me,"don't await UniqueConstraintNodeBuilder instances directly.");var Wt=class{#e;constructor(e){this.#e=r(e)}renameTo(e){return new oe({...this.#e,node:l.cloneWithTableProps(this.#e.node,{renameTo:g(e)})})}setSchema(e){return new oe({...this.#e,node:l.cloneWithTableProps(this.#e.node,{setSchema:u.create(e)})})}alterColumn(e,i){let n=i(new dt(e));return new Se({...this.#e,node:l.cloneWithColumnAlteration(this.#e.node,n.toOperationNode())})}dropColumn(e){return new Se({...this.#e,node:l.cloneWithColumnAlteration(this.#e.node,Ni.create(e))})}renameColumn(e,i){return new Se({...this.#e,node:l.cloneWithColumnAlteration(this.#e.node,xi.create(e,i))})}addColumn(e,i,n=X){let o=n(new ne(O.create(e,he(i))));return new Se({...this.#e,node:l.cloneWithColumnAlteration(this.#e.node,yi.create(o.toOperationNode()))})}modifyColumn(e,i,n=X){let o=n(new ne(O.create(e,he(i))));return new Se({...this.#e,node:l.cloneWithColumnAlteration(this.#e.node,wi.create(o.toOperationNode()))})}addUniqueConstraint(e,i,n=X){let o=n(new Me(st.create(i,e)));return new oe({...this.#e,node:l.cloneWithTableProps(this.#e.node,{addConstraint:ot.create(o.toOperationNode())})})}addCheckConstraint(e,i){return new oe({...this.#e,node:l.cloneWithTableProps(this.#e.node,{addConstraint:ot.create(rt.create(i.toOperationNode(),e))})})}addForeignKeyConstraint(e,i,n,o){return new kt({...this.#e,constraintBuilder:new Pe(Le.create(i.map(m.create),g(n),o.map(m.create),e))})}addPrimaryKeyConstraint(e,i){return new oe({...this.#e,node:l.cloneWithTableProps(this.#e.node,{addConstraint:ot.create(br.create(i,e))})})}dropConstraint(e){return new At({...this.#e,node:l.cloneWithTableProps(this.#e.node,{dropConstraint:at.create(e)})})}addIndex(e){return new Dt({...this.#e,node:l.cloneWithTableProps(this.#e.node,{addIndex:Ie.create(e)})})}dropIndex(e){return new oe({...this.#e,node:l.cloneWithTableProps(this.#e.node,{dropIndex:ye.create(e)})})}$call(e){return e(this)}},Se=class t{#e;constructor(e){this.#e=r(e)}alterColumn(e,i){let n=i(new dt(e));return new t({...this.#e,node:l.cloneWithColumnAlteration(this.#e.node,n.toOperationNode())})}dropColumn(e){return new t({...this.#e,node:l.cloneWithColumnAlteration(this.#e.node,Ni.create(e))})}renameColumn(e,i){return new t({...this.#e,node:l.cloneWithColumnAlteration(this.#e.node,xi.create(e,i))})}addColumn(e,i,n=X){let o=n(new ne(O.create(e,he(i))));return new t({...this.#e,node:l.cloneWithColumnAlteration(this.#e.node,yi.create(o.toOperationNode()))})}modifyColumn(e,i,n=X){let o=n(new ne(O.create(e,he(i))));return new t({...this.#e,node:l.cloneWithColumnAlteration(this.#e.node,wi.create(o.toOperationNode()))})}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};s(Wt,"don't await AlterTableBuilder instances");s(dt,"don't await AlterColumnBuilder instances");s(Se,"don't await AlterTableColumnAlteringBuilder instances directly. To execute the query you need to call `execute`");var ct=class extends Ce{transformValue(e){return{...super.transformValue(e),immediate:!0}}};var qt=class t{#e;constructor(e){this.#e=r(e)}ifNotExists(){return new t({...this.#e,node:H.cloneWith(this.#e.node,{ifNotExists:!0})})}unique(){return new t({...this.#e,node:H.cloneWith(this.#e.node,{unique:!0})})}nullsNotDistinct(){return new t({...this.#e,node:H.cloneWith(this.#e.node,{nullsNotDistinct:!0})})}on(e){return new t({...this.#e,node:H.cloneWith(this.#e.node,{table:g(e)})})}column(e){return new t({...this.#e,node:H.cloneWithColumns(this.#e.node,[Je(e)])})}columns(e){return new t({...this.#e,node:H.cloneWithColumns(this.#e.node,e.map(Je))})}expression(e){return new t({...this.#e,node:H.cloneWithColumns(this.#e.node,[e.toOperationNode()])})}using(e){return new t({...this.#e,node:H.cloneWith(this.#e.node,{using:v.createWithSql(e)})})}where(...e){let i=new ct;return new t({...this.#e,node:d.cloneWithWhere(this.#e.node,i.transformNode(b(e)))})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};s(qt,"don't await CreateIndexBuilder instances directly. To execute the query you need to call `execute`");var _t=class t{#e;constructor(e){this.#e=r(e)}ifNotExists(){return new t({...this.#e,node:Gt.cloneWith(this.#e.node,{ifNotExists:!0})})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};s(_t,"don't await CreateSchemaBuilder instances directly. To execute the query you need to call `execute`");function fn(t){if(Wi.includes(t))return t;throw new Error(`invalid OnCommitAction ${t}`)}var Rt=class t{#e;constructor(e){this.#e=r(e)}temporary(){return new t({...this.#e,node:P.cloneWith(this.#e.node,{temporary:!0})})}onCommit(e){return new t({...this.#e,node:P.cloneWith(this.#e.node,{onCommit:fn(e)})})}ifNotExists(){return new t({...this.#e,node:P.cloneWith(this.#e.node,{ifNotExists:!0})})}addColumn(e,i,n=X){let o=n(new ne(O.create(e,he(i))));return new t({...this.#e,node:P.cloneWithColumn(this.#e.node,o.toOperationNode())})}addPrimaryKeyConstraint(e,i){return new t({...this.#e,node:P.cloneWithConstraint(this.#e.node,br.create(i,e))})}addUniqueConstraint(e,i,n=X){let o=n(new Me(st.create(i,e)));return new t({...this.#e,node:P.cloneWithConstraint(this.#e.node,o.toOperationNode())})}addCheckConstraint(e,i){return new t({...this.#e,node:P.cloneWithConstraint(this.#e.node,rt.create(i.toOperationNode(),e))})}addForeignKeyConstraint(e,i,n,o,a=X){let p=a(new Pe(Le.create(i.map(m.create),g(n),o.map(m.create),e)));return new t({...this.#e,node:P.cloneWithConstraint(this.#e.node,p.toOperationNode())})}modifyFront(e){return new t({...this.#e,node:P.cloneWithFrontModifier(this.#e.node,e.toOperationNode())})}modifyEnd(e){return new t({...this.#e,node:P.cloneWithEndModifier(this.#e.node,e.toOperationNode())})}as(e){return new t({...this.#e,node:P.cloneWith(this.#e.node,{selectQuery:Q(e)})})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};s(Rt,"don't await CreateTableBuilder instances directly. To execute the query you need to call `execute`");var Lt=class t{#e;constructor(e){this.#e=r(e)}on(e){return new t({...this.#e,node:ye.cloneWith(this.#e.node,{table:g(e)})})}ifExists(){return new t({...this.#e,node:ye.cloneWith(this.#e.node,{ifExists:!0})})}cascade(){return new t({...this.#e,node:ye.cloneWith(this.#e.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};s(Lt,"don't await DropIndexBuilder instances directly. To execute the query you need to call `execute`");var Pt=class t{#e;constructor(e){this.#e=r(e)}ifExists(){return new t({...this.#e,node:ht.cloneWith(this.#e.node,{ifExists:!0})})}cascade(){return new t({...this.#e,node:ht.cloneWith(this.#e.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};s(Pt,"don't await DropSchemaBuilder instances directly. To execute the query you need to call `execute`");var Bt=class t{#e;constructor(e){this.#e=r(e)}ifExists(){return new t({...this.#e,node:ft.cloneWith(this.#e.node,{ifExists:!0})})}cascade(){return new t({...this.#e,node:ft.cloneWith(this.#e.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};s(Bt,"don't await DropTableBuilder instances directly. To execute the query you need to call `execute`");var se=r({is(t){return t.kind==="CreateViewNode"},create(t){return r({kind:"CreateViewNode",name:M.create(t)})},cloneWith(t,e){return r({...t,...e})}});var Or=class{#e=new ct;transformQuery(e){return this.#e.transformNode(e.node)}transformResult(e){return Promise.resolve(e.result)}};var Mt=class t{#e;constructor(e){this.#e=r(e)}temporary(){return new t({...this.#e,node:se.cloneWith(this.#e.node,{temporary:!0})})}materialized(){return new t({...this.#e,node:se.cloneWith(this.#e.node,{materialized:!0})})}ifNotExists(){return new t({...this.#e,node:se.cloneWith(this.#e.node,{ifNotExists:!0})})}orReplace(){return new t({...this.#e,node:se.cloneWith(this.#e.node,{orReplace:!0})})}columns(e){return new t({...this.#e,node:se.cloneWith(this.#e.node,{columns:e.map(zr)})})}as(e){let i=e.withPlugin(new Or).toOperationNode();return new t({...this.#e,node:se.cloneWith(this.#e.node,{as:i})})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};s(Mt,"don't await CreateViewBuilder instances directly. To execute the query you need to call `execute`");var mt=r({is(t){return t.kind==="DropViewNode"},create(t){return r({kind:"DropViewNode",name:M.create(t)})},cloneWith(t,e){return r({...t,...e})}});var Ft=class t{#e;constructor(e){this.#e=r(e)}materialized(){return new t({...this.#e,node:mt.cloneWith(this.#e.node,{materialized:!0})})}ifExists(){return new t({...this.#e,node:mt.cloneWith(this.#e.node,{ifExists:!0})})}cascade(){return new t({...this.#e,node:mt.cloneWith(this.#e.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};s(Ft,"don't await DropViewBuilder instances directly. To execute the query you need to call `execute`");var Cr=r({is(t){return t.kind==="CreateTypeNode"},create(t){return r({kind:"CreateTypeNode",name:t})},cloneWithEnum(t,e){return r({...t,enum:Ke.create(e.map(i=>k.createImmediate(i)))})}});var Qt=class t{#e;constructor(e){this.#e=r(e)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}asEnum(e){return new t({...this.#e,node:Cr.cloneWithEnum(this.#e.node,e)})}$call(e){return e(this)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};s(Qt,"don't await CreateTypeBuilder instances directly. To execute the query you need to call `execute`");var Tr=r({is(t){return t.kind==="DropTypeNode"},create(t){return r({kind:"DropTypeNode",name:t})},cloneWith(t,e){return r({...t,...e})}});var $t=class t{#e;constructor(e){this.#e=r(e)}ifExists(){return new t({...this.#e,node:Tr.cloneWith(this.#e.node,{ifExists:!0})})}$call(e){return e(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile(),this.#e.queryId)}};s($t,"don't await DropTypeBuilder instances directly. To execute the query you need to call `execute`");function gi(t){let e=".";if(t.includes(e)){let i=t.split(e).map(Hn);if(i.length===2)return M.createWithSchema(i[0],i[1]);throw new Error(`invalid schemable identifier ${t}`)}else return M.create(t)}function Hn(t){return t.trim()}var vr=class t{#e;constructor(e){this.#e=e}createTable(e){return new Rt({queryId:h(),executor:this.#e,node:P.create(g(e))})}dropTable(e){return new Bt({queryId:h(),executor:this.#e,node:ft.create(g(e))})}createIndex(e){return new qt({queryId:h(),executor:this.#e,node:H.create(e)})}dropIndex(e){return new Lt({queryId:h(),executor:this.#e,node:ye.create(e)})}createSchema(e){return new _t({queryId:h(),executor:this.#e,node:Gt.create(e)})}dropSchema(e){return new Pt({queryId:h(),executor:this.#e,node:ht.create(e)})}alterTable(e){return new Wt({queryId:h(),executor:this.#e,node:l.create(g(e))})}createView(e){return new Mt({queryId:h(),executor:this.#e,node:se.create(e)})}dropView(e){return new Ft({queryId:h(),executor:this.#e,node:mt.create(e)})}createType(e){return new Qt({queryId:h(),executor:this.#e,node:Cr.create(gi(e))})}dropType(e){return new $t({queryId:h(),executor:this.#e,node:Tr.create(gi(e))})}withPlugin(e){return new t(this.#e.withPlugin(e))}withoutPlugins(){return new t(this.#e.withoutPlugins())}withSchema(e){return new t(this.#e.withPluginAtFront(new G(e)))}};var Ir=class{ref(e){return new Yt(e)}};var Sr=class{#e;constructor(e){this.#e=e}async provideConnection(e){let i=await this.#e.acquireConnection();try{return await e(i)}finally{await this.#e.releaseConnection(i)}}};var Er=class t extends Xe{#e;#t;#r;constructor(e,i,n,o=[]){super(o),this.#e=e,this.#t=i,this.#r=n}get adapter(){return this.#t}compileQuery(e){return this.#e.compileQuery(e)}provideConnection(e){return this.#r.provideConnection(e)}withPlugins(e){return new t(this.#e,this.#t,this.#r,[...this.plugins,...e])}withPlugin(e){return new t(this.#e,this.#t,this.#r,[...this.plugins,e])}withPluginAtFront(e){return new t(this.#e,this.#t,this.#r,[e,...this.plugins])}withConnectionProvider(e){return new t(this.#e,this.#t,e,[...this.plugins])}withoutPlugins(){return new t(this.#e,this.#t,this.#r,[])}};function bi(){return typeof performance<"u"&&x(performance.now)?performance.now():Date.now()}var kr=class{#e;#t;#r;#n;#i;#s=new WeakSet;constructor(e,i){this.#n=!1,this.#e=e,this.#t=i}async init(){if(this.#i)throw new Error("driver has already been destroyed");this.#r||(this.#r=this.#e.init().then(()=>{this.#n=!0}).catch(e=>(this.#r=void 0,Promise.reject(e)))),await this.#r}async acquireConnection(){if(this.#i)throw new Error("driver has already been destroyed");this.#n||await this.init();let e=await this.#e.acquireConnection();return this.#s.has(e)||(this.#o()&&this.#a(e),this.#s.add(e)),e}async releaseConnection(e){await this.#e.releaseConnection(e)}beginTransaction(e,i){return this.#e.beginTransaction(e,i)}commitTransaction(e){return this.#e.commitTransaction(e)}rollbackTransaction(e){return this.#e.rollbackTransaction(e)}async destroy(){this.#r&&(await this.#r,this.#i||(this.#i=this.#e.destroy().catch(e=>(this.#i=void 0,Promise.reject(e)))),await this.#i)}#o(){return this.#t.isLevelEnabled("query")||this.#t.isLevelEnabled("error")}#a(e){let i=e.executeQuery;e.executeQuery=async n=>{let o,a=bi();try{return await i.call(e,n)}catch(p){throw o=p,await this.#u(p,n,a),p}finally{o||await this.#c(n,a)}}}async#u(e,i,n){await this.#t.error(()=>({level:"error",error:e,query:i,queryDurationMillis:this.#d(n)}))}async#c(e,i){await this.#t.query(()=>({level:"query",query:e,queryDurationMillis:this.#d(i)}))}#d(e){return bi()-e}};var Yn=()=>{},Ut=class{#e;#t;constructor(e){this.#e=e}async provideConnection(e){for(;this.#t;)await this.#t.catch(Yn);return this.#t=this.#r(e).finally(()=>{this.#t=void 0}),this.#t}async#r(e){return await e(this.#e)}};var yn=["read uncommitted","read committed","repeatable read","serializable","snapshot"];var Hx=r(["query","error"]),Ar=class{#e;#t;constructor(e){x(e)?(this.#t=e,this.#e=r({query:!0,error:!0})):(this.#t=Zn,this.#e=r({query:e.includes("query"),error:e.includes("error")}))}isLevelEnabled(e){return this.#e[e]}async query(e){this.#e.query&&await this.#t(e())}async error(e){this.#e.error&&await this.#t(e())}};function Zn(t){t.level==="query"?(console.log(`kysely:query: ${t.query.sql}`),console.log(`kysely:query: duration: ${t.queryDurationMillis.toFixed(1)}ms`)):t.level==="error"&&(t.error instanceof Error?console.error(`kysely:error: ${t.error.stack??t.error.message}`):console.error(`kysely:error: ${JSON.stringify({error:t.error,query:t.query.sql,queryDurationMillis:t.queryDurationMillis})}`))}function Nn(t){return E(t)&&x(t.compile)}var Dr=class t extends Ye{#e;constructor(e){let i,n;if(Xn(e))i={executor:e.executor},n={...e};else{let o=e.dialect,a=o.createDriver(),p=o.createQueryCompiler(),S=o.createAdapter(),A=new Ar(e.log??[]),Fe=new kr(a,A),Pr=new Sr(Fe),Jt=new Er(p,S,Pr,e.plugins??[]);i={executor:Jt},n={config:e,executor:Jt,dialect:o,driver:Fe}}super(i),this.#e=r(n)}get schema(){return new vr(this.#e.executor)}get dynamic(){return new Ir}get introspection(){return this.#e.dialect.createIntrospector(this.withoutPlugins())}case(e){return new tt({node:J.create($(e)?void 0:Q(e))})}get fn(){return Nr()}transaction(){return new qr({...this.#e})}connection(){return new Wr({...this.#e})}withPlugin(e){return new t({...this.#e,executor:this.#e.executor.withPlugin(e)})}withoutPlugins(){return new t({...this.#e,executor:this.#e.executor.withoutPlugins()})}withSchema(e){return new t({...this.#e,executor:this.#e.executor.withPluginAtFront(new G(e))})}withTables(){return new t({...this.#e})}async destroy(){await this.#e.driver.destroy()}get isTransaction(){return!1}getExecutor(){return this.#e.executor}executeQuery(e,i=h()){let n=Nn(e)?e.compile():e;return this.getExecutor().executeQuery(n,i)}},Oi=class t extends Dr{#e;constructor(e){super(e),this.#e=e}get isTransaction(){return!0}transaction(){throw new Error("calling the transaction method for a Transaction is not supported")}connection(){throw new Error("calling the connection method for a Transaction is not supported")}async destroy(){throw new Error("calling the destroy method for a Transaction is not supported")}withPlugin(e){return new t({...this.#e,executor:this.#e.executor.withPlugin(e)})}withoutPlugins(){return new t({...this.#e,executor:this.#e.executor.withoutPlugins()})}withSchema(e){return new t({...this.#e,executor:this.#e.executor.withPluginAtFront(new G(e))})}withTables(){return new t({...this.#e})}};function Xn(t){return E(t)&&E(t.config)&&E(t.driver)&&E(t.executor)&&E(t.dialect)}var Wr=class{#e;constructor(e){this.#e=r(e)}async execute(e){return this.#e.executor.provideConnection(async i=>{let n=this.#e.executor.withConnectionProvider(new Ut(i)),o=new Dr({...this.#e,executor:n});return await e(o)})}};s(Wr,"don't await ConnectionBuilder instances directly. To execute the query you need to call the `execute` method");var qr=class t{#e;constructor(e){this.#e=r(e)}setIsolationLevel(e){return new t({...this.#e,isolationLevel:e})}async execute(e){let{isolationLevel:i,...n}=this.#e,o={isolationLevel:i};return eo(o),this.#e.executor.provideConnection(async a=>{let p=this.#e.executor.withConnectionProvider(new Ut(a)),S=new Oi({...n,executor:p});try{await this.#e.driver.beginTransaction(a,o);let A=await e(S);return await this.#e.driver.commitTransaction(a),A}catch(A){throw await this.#e.driver.rollbackTransaction(a),A}})}};s(qr,"don't await TransactionBuilder instances directly. To execute the transaction you need to call the `execute` method");function eo(t){if(t.isolationLevel&&!yn.includes(t.isolationLevel))throw new Error(`invalid transaction isolation level ${t.isolationLevel}`)}var _r=class t{#e;constructor(e){this.#e=r(e)}get expressionType(){}get isRawBuilder(){return!0}as(e){return new Rr(this,e)}$castTo(){return new t({...this.#e})}withPlugin(e){return new t({...this.#e,plugins:this.#e.plugins!==void 0?r([...this.#e.plugins,e]):r([e])})}toOperationNode(){return this.#r(this.#t())}compile(e){return this.#n(this.#t(e))}async execute(e){let i=this.#t(e);return i.executeQuery(this.#n(i),this.#e.queryId)}#t(e){let i=e!==void 0?e.getExecutor():et;return this.#e.plugins!==void 0?i.withPlugins(this.#e.plugins):i}#r(e){return e.transformQuery(this.#e.rawNode,this.#e.queryId)}#n(e){return e.compileQuery(this.#r(e),this.#e.queryId)}};function fe(t){return new _r(t)}s(_r,"don't await RawBuilder instances directly. To execute the query you need to call `execute`");var Rr=class{#e;#t;constructor(e,i){this.#e=e,this.#t=i}get expression(){return this.#e}get alias(){return this.#t}get rawBuilder(){return this.#e}toOperationNode(){return q.create(this.#e.toOperationNode(),I(this.#t)?this.#t.toOperationNode():u.create(this.#t))}};s(Rr,"don't await AliasedRawBuilder instances directly. AliasedRawBuilder should never be executed directly since it's always a part of another query.");var ae=Object.assign((t,...e)=>fe({queryId:h(),rawNode:v.create(t,e?.map(T)??[])}),{ref(t){return fe({queryId:h(),rawNode:v.createWithChild(U(t))})},val(t){return fe({queryId:h(),rawNode:v.createWithChild(T(t))})},value(t){return this.val(t)},table(t){return fe({queryId:h(),rawNode:v.createWithChild(g(t))})},id(...t){let e=new Array(t.length+1).fill(".");return e[0]="",e[e.length-1]="",fe({queryId:h(),rawNode:v.create(e,t.map(u.create))})},lit(t){return fe({queryId:h(),rawNode:v.createWithChild(k.createImmediate(t))})},literal(t){return this.lit(t)},raw(t){return fe({queryId:h(),rawNode:v.createWithSql(t)})},join(t,e=ae`, `){let i=new Array(2*t.length-1),n=e.toOperationNode();for(let o=0;o<t.length;++o)i[2*o]=T(t[o]),o!==t.length-1&&(i[2*o+1]=n);return fe({queryId:h(),rawNode:v.createWithChildren(i)})}});var Kw=r({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked",Distinct:"distinct"}),jw=r({ForKeyShare:1,ForNoKeyUpdate:1,ForUpdate:1,ForShare:1,NoWait:2,SkipLocked:2,Distinct:0}),Gw=r({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral"});var Vt=r({raw(t,e=[]){return r({sql:t,query:v.createWithSql(t),parameters:r(e)})}});var hg=r({__noMigrations__:!0});var Mg=BigInt("3853314791062309107");function pt(t,e){if(to(t)&&e.stack){let i=e.stack.split(`
`).slice(1).join(`
`);return t.stack+=`
${i}`,t}return t}function to(t){return E(t)&&C(t.stack)}var ro=Symbol();function io(t){return E(t)&&"insertId"in t&&"affectedRows"in t}var xn=class{#e;constructor(e){this.#e=e}async executeQuery(e){try{let i=await this.#t(e);if(io(i)){let{insertId:n,affectedRows:o,changedRows:a}=i,p=o!=null?BigInt(o):void 0,S=a!=null?BigInt(a):void 0;return{insertId:n!=null&&n.toString()!=="0"?BigInt(n):void 0,numUpdatedOrDeletedRows:p,numAffectedRows:p,numChangedRows:S,rows:[]}}else if(Array.isArray(i))return{rows:i};return{rows:[]}}catch(i){throw pt(i,new Error)}}#t(e){return new Promise((i,n)=>{this.#e.query(e.sql,e.parameters,(o,a)=>{o?n(o):i(a)})})}async*streamQuery(e,i){let n=this.#e.query(e.sql,e.parameters).stream({objectMode:!0});try{for await(let o of n)yield{rows:[o]}}catch(o){if(o&&typeof o=="object"&&"code"in o&&o.code==="ERR_STREAM_PREMATURE_CLOSE")return;throw o}}[ro](){this.#e.release()}};var tb=60*60;var no=Symbol();var wn=class{#e;#t;constructor(e,i){this.#e=e,this.#t=i}async executeQuery(e){try{let i=await this.#e.query(e.sql,[...e.parameters]);if(i.command==="INSERT"||i.command==="UPDATE"||i.command==="DELETE"){let n=BigInt(i.rowCount);return{numUpdatedOrDeletedRows:n,numAffectedRows:n,rows:i.rows??[]}}return{rows:i.rows??[]}}catch(i){throw pt(i,new Error)}}async*streamQuery(e,i){if(!this.#t.cursor)throw new Error("'cursor' is not present in your postgres dialect config. It's required to make streaming work in postgres.");if(!Number.isInteger(i)||i<=0)throw new Error("chunkSize must be a positive integer");let n=this.#e.query(new this.#t.cursor(e.sql,e.parameters.slice()));try{for(;;){let o=await n.read(i);if(o.length===0)break;yield{rows:o}}}finally{await n.close()}}[no](){this.#e.release()}};var oo=Symbol(),so=Symbol();var gn=class{#e;#t;constructor(e,i){this.#e=e,this.#t=i}async beginTransaction(e){let{isolationLevel:i}=e;await new Promise((n,o)=>this.#e.beginTransaction(a=>{a?o(a):n(void 0)},i?pr(8):void 0,i?this.#r(i):void 0))}async commitTransaction(){await new Promise((e,i)=>this.#e.commitTransaction(n=>{n?i(n):e(void 0)}))}async executeQuery(e){try{let i=new ve,n=new zt(this.#t,e,i);this.#e.execSql(n.request);let{rowCount:o,rows:a}=await i.promise;return{numAffectedRows:o!==void 0?BigInt(o):void 0,rows:a}}catch(i){throw pt(i,new Error)}}async rollbackTransaction(){await new Promise((e,i)=>this.#e.rollbackTransaction(n=>{n?i(n):e(void 0)}))}async*streamQuery(e,i){if(!Number.isInteger(i)||i<=0)throw new Error("chunkSize must be a positive integer");let n=new zt(this.#t,e);this.#e.execSql(n.request);try{for(;;){let o=await n.readChunk(i);if(o.length===0||(yield{rows:o},o.length<i))break}}finally{this.#e.cancel()}}async validate(){try{let e=new ve,i=new zt(this.#t,Vt.raw("select 1"),e);return this.#e.execSql(i.request),await e.promise,!0}catch{return!1}}#r(e){let{ISOLATION_LEVEL:i}=this.#t,o={"read committed":i.READ_COMMITTED,"read uncommitted":i.READ_UNCOMMITTED,"repeatable read":i.REPEATABLE_READ,serializable:i.SERIALIZABLE,snapshot:i.SNAPSHOT}[e];if(o===void 0)throw new Error(`Unknown isolation level: ${e}`);return o}[oo](){return new Promise((e,i)=>{this.#e.reset(n=>{n?i(n):e(void 0)})})}[so](){return new Promise(e=>{this.#e.once("end",()=>{e(void 0)}),this.#e.close()})}},zt=class{#e;#t;#r;#n;#i;#s;constructor(e,i,n){this.#n=!1,this.#t=[],this.#r=e;let{parameters:o,sql:a}=i;this.#e=new this.#r.Request(a,(p,S)=>{p?(this.#i=p instanceof AggregateError?p.errors:p,n?.reject(this.#i)):this.#s=S}),this.#o(o),this.#a(n)}get request(){return this.#e}readChunk(e){return new Promise((i,n)=>{let o=setInterval(()=>{this.#i?(clearInterval(o),n(this.#i)):(this.#n||this.#t.length>=e)&&(clearInterval(o),i(this.#t.splice(0,e)))},0)})}#o(e){for(let i=0;i<e.length;i++){let n=e[i];this.#e.addParameter(String(i+1),this.#u(n),n)}}#a(e){let i=n=>{let o={};for(let a of n)o[a.metadata.colName]=a.value;this.#t.push(o)};this.#e.on("row",i),this.#e.once("requestCompleted",()=>{this.#n=!0,this.#e.off("row",i),e?.resolve({rowCount:this.#s,rows:this.#t})})}#u(e){return Ae(e)||$(e)||C(e)?this.#r.TYPES.NVarChar:Fr(e)||$e(e)&&e%1===0?e<-2147483648||e>2147483647?this.#r.TYPES.BigInt:this.#r.TYPES.Int:$e(e)?this.#r.TYPES.Float:ke(e)?this.#r.TYPES.Bit:Mr(e)?this.#r.TYPES.DateTime:Di(e)?this.#r.TYPES.VarBinary:this.#r.TYPES.NVarChar}};var NO=r({is(t){return t.kind==="ListNode"},create(t){return r({kind:"ListNode",items:r(t)})}});var{Deno:On}=globalThis,iI=typeof On?.noColor=="boolean"?On.noColor:!1;var nI=new RegExp(["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TXZcf-nq-uy=><~]))"].join("|"),"g");var $I=Intl.DateTimeFormat().resolvedOptions().timeZone;var UI={numeric:new Intl.DateTimeFormat("en-gb",{weekday:"long",month:"numeric",year:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZone:"Africa/Johannesburg"}),twoDigit:new Intl.DateTimeFormat("en-gb",{weekday:"long",month:"2-digit",year:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"Africa/Johannesburg"})};var VI=new Intl.DateTimeFormat("en-gb",{month:"long",day:"numeric",timeZone:"Africa/Johannesburg"}),zI=new Intl.DateTimeFormat("en-gb",{hour:"numeric",minute:"numeric",timeZone:"Africa/Johannesburg"});var Cn=[["\xBC",.25],["\xBD",.5],["1",1],["2",2],["3",3],["4",4],["5",5],["6",6],["7",7],["8",8],["9",9],["10",10]],Tn={ac:"before meals",am:"morning",bd:"2 times daily",nocte:"every night",od:"once a day",pm:"afternoon or evening",q15:"every 15 minutes",q30:"every 30 minutes",q1h:"every hour",q2h:"every 2 hours",q4h:"every 4 hours",q6h:"every 6 hours",q8h:"every 8 hours",qd:"every day",qid:"4 times a day",qod:"alternate days",qs:"sufficient enough quantity",mane:"morning",qmane:"every morning",qn:"every night",stat:"immediately, now",tds:"3 times a day",q24h:"every 24 hours",q30h:"every 30 hours",q48h:"every 48 hours",q72h:"every 72 hours",hs:"at bedtime  ",qhs:"daily at bedtime",qw:"once a week",bw:"twice a week",tw:"three times a week",qm:"once a month",bm:"twice a month",tm:"three times a month",prn:"when necessary"};function lo({name:t,value:e}){let[i,n]=ue(e?.drug||null),[o,a]=ue(e?.medication_id||null),[p,S]=ue(e?.manufactured_medication_id??null),[A,Fe]=ue(e?.strength??null),[Pr,Jt]=ue(e?.intake_frequency??null),[Ii,Si]=ue(e?.dosage??null),[vn,In]=ue(e?.route??null),[ho,fo]=ue(e?[e.drug]:[]),f=i?.medications.find(y=>y.medication_id===o),Sn=f?.manufacturers.find(y=>y.manufactured_medication_id===p)?.strength_numerators||f?.strength_numerators,lt=f?.strength_denominator_unit,Ei=f?.strength_denominator_is_units,En=lt&&(Ei?lt:lt==="SUPPOSITORY"?"SUPPOSITORIES":lt+"S");return Kt(()=>{i&&(o||i.medications.length===1&&a(i.medications[0].medication_id))},[i]),Kt(()=>{f&&(A||f.strength_numerators.length===1&&Fe(f.strength_numerators[0]))},[f]),Kt(()=>{f&&A&&(Ii||Si(f.strength_denominator))},[f,A]),w("div",{className:"w-full justify-normal",children:[w(jt,{className:"w-full justify-normal",children:[w(Ai,{name:t,selectedDrug:i,setSelectedDrug:n,clearSelected:()=>{n(null),a(null),Fe(null),Si(null),Jt(null)}}),w(Qe,{name:`${t}.medication_id`,required:!0,label:"Form",disabled:!i,onChange:y=>y.currentTarget.value&&a(Number(y.currentTarget.value)),children:[w("option",{value:"",children:"Select Form"}),i&&i.medications.map(y=>w("option",{value:y.medication_id,selected:o===y.medication_id,children:y.form_route}))]}),f&&f.routes.length>1&&w(Qe,{name:`${t}.route`,required:!0,label:"Route",disabled:!i,onChange:y=>y.currentTarget.value&&In(y.currentTarget.value),children:[w("option",{value:"",children:"Select Form"}),f.routes.map(y=>w("option",{value:y,selected:vn===y,children:y}))]}),f&&f.routes.length===1&&w("input",{name:`${t}.route`,type:"hidden",value:f.routes[0]}),w("input",{type:"hidden",className:"hidden",name:`${t}.manufactured_medication_id`,value:p||""}),w(Qe,{name:`${t}.strength`,required:!0,label:"Strength",disabled:!f,onChange:y=>y.currentTarget.value&&Fe(Number(y.currentTarget.value)),children:[w("option",{value:"",children:"Select Strength"}),f&&Sn?.map(y=>w("option",{value:y,selected:A===y,children:[y,f.strength_numerator_unit,"/",f.strength_denominator===1?"":f.strength_denominator,f.strength_denominator_unit]}))]})]}),w(jt,{className:"w-full justify-normal",children:[w(Qe,{name:`${t}.dosage`,label:"Dosage",disabled:!(f&&A),children:[w("option",{value:"",children:"Select Dosage"}),f&&A&&Cn.map(([y,Ee])=>w("option",{value:Ee*f.strength_denominator,selected:Ii===Ee*f.strength_denominator,children:[f.strength_denominator===1?y:Ee*f.strength_denominator,Ei?"":" ",Ee>1?En:lt," ","(",A*Ee,f?.strength_numerator_unit,")"]}))]}),w(Qe,{name:`${t}.intake_frequency`,required:!0,label:"Frequency",disabled:!i,children:[w("option",{value:"",children:"Select Intake"}),i&&Object.entries(Tn).map(([y,Ee])=>w("option",{value:y,selected:Pr===y,children:Ee}))]}),w(Br,{name:`${t}.start_date`,label:"Start Date",required:!0,value:e?.start_date}),w(Br,{name:`${t}.end_date`,label:"End Date",value:e?.end_date})]}),w(jt,{children:w(ki,{name:`${t}.special_instructions`,className:"w-full",label:"Special Instructions",value:e?.special_instructions})})]})}export{lo as a};
